----------------------------------------
-- File: 'enclavesturrettactic.ai'
-- Edited by Thudmeizer				@ 30.07.2023

class 'EnclavesTurretTactic' (BaseTactic)

EnclavesTurret = {}

function EnclavesTurretTactic:__init( base_ai ) super( base_ai )

	self:SetName("Enclaves Turret Tactic")

	self.Addon = math.random( 0, 1 )	  -- Choose either to leave turret as plasma cannon or choose either missile launcher or burst cannon addons
	self.Upgrade = math.random( 0, 1 )	  -- Choose either missile launcher or burst cannon
end

function EnclavesTurretTactic:AutoBuildTurretAddOn( addonSlot, iID )
	local buildChannelLP = build_manager:GetBuildChannelFromID(iID)
	if (buildChannelLP ~= nil) then
		local addOnID = buildChannelLP:GetItemIDAt(BuildChannelAI.PQ_AddOn, addonSlot)
		if (buildChannelLP:IsBuilding() == 0 and buildChannelLP:CanAddToQueue(BuildChannelAI.PQ_AddOn, addOnID) == BuildChannelAI.CANBUILD_Ok) then
			buildChannelLP:BuildAddOn(addOnID)
		end
	end
end

function EnclavesTurretTactic:InitAbilities()
--[[
	-- Init ability ID's
	if (EnclavesTurret.hkmissiles_id == nil) then
		EnclavesTurret.hkmissiles_id = cpu_manager.stats:GetAbilityID( "enclaves_hk_missiles" )
	end
]]
end

function EnclavesTurretTactic:DoAbilities()
--[[
	local hkChance = math.random(1,100)

	-- Check if we can launch HK missiles
	if (self.base_ai:CanDoAbility(EnclavesTurret.hkmissiles_id)) then
		if ( (cpu_manager.terrain_analyzer:HasThreat( self.base_ai:GetPosition(), 35 ) and hkChance > 25) or (cpu_manager.terrain_analyzer:HasThreat( self.base_ai:GetPosition(), 55 ) and hkChance > 75) ) then
		
			-- Launch HK Missiles at Vehicles, Buildings or Monsters
			Ability.DoAbilityTarget(self.base_ai, EnclavesTurret.hkmissiles_id, Ability.Filters.CloseVehicleEnemy, 2)
    			Ability.DoAbilityTargetEntity(self.base_ai, EnclavesTurret.hkmissiles_id, Ability.EntityFilters.CloseBaseEntityEnemy, 2)
			Ability.DoAbilityTarget(self.base_ai, EnclavesTurret.hkmissiles_id, Ability.Filters.CloseMonsterEnemy, 4)
		end
	end
]]
	if self.Addon == 0 then
		-- Choose to remain plasma cannon and not build any addons
		return
	else
   		if (cpu_manager:GetTierLevel() >= 2) then 
			local iRequisition = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Requisition )
			local iPower = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Power )
			if (iRequisition >= 100 and iPower >= 150) then
				self:AutoBuildTurretAddOn(self.Upgrade, self.base_ai:GetEntity():GetID())	-- Build either missile launcher or burst cannon
			end
		end
	end
end

