----------------------------------------
-- File: 'stealthteamtactic.ai'
-- Created by Arkhan		@ 21.03.2008
-- Edited by Thudmeizer		@ 09.09.2022

class 'EnclavesStealthTeamTactic' (EnclavesInfantryTactic)

EnclavesStealthTeam = {}

function EnclavesStealthTeamTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Enclaves Stealth Team Tactic")
end

-- Don't attack until tier 2
function EnclavesStealthTeamTactic:IsAttacker()	
	return (cpu_manager:GetTierLevel() >= 2)
end

function EnclavesStealthTeamTactic:InitAbilities()

	-- Init ability ID's
	if (EnclavesStealthTeam.iEMPGrenadeID == nil) then
		EnclavesStealthTeam.iEMPGrenadeID = cpu_manager.stats:GetAbilityID( "enclaves_emp_grenade" )	
	end
end

function EnclavesStealthTeamTactic:DoAbilities()
	
	-- Check if we can use EMP grenade
	Ability.DoAbilityTarget(self.squad_ai, EnclavesStealthTeam.iEMPGrenadeID, Ability.Filters.CloseVehicleEnemy, 1)
	
	-- Call basic DoAbilities methods
	InfantryTactic.DoAbilities(self)
end

function EnclavesStealthTeamTactic:Upgrade()

	-- If I am broken, don't upgrade!
	if (self:IsAffectedByMorale() and self.squad_ai:IsBroken()) then
		return
	end

	-- Force upgrade to fusion cannon
	if (not self.squad_ai:IsReinforcing() and self.squad_ai:HasUpgradableTrooper() and
		self.squad_ai:GetHealthPercentage() > 0.5 and cpu_manager:GetTierLevel() >= 2) then
		local class_type = cpu_manager:GetFirstEnemyPlayer():GetMajorityClassType()
		self.squad_ai:DoBestUpgrade( class_type )
	end
end

function EnclavesStealthTeamTactic:Reinforce()

	-- Reinforce only in tier 2
	if (cpu_manager:GetTierLevel() >= 2) then
		InfantryTactic.Reinforce(self)
	end
end
