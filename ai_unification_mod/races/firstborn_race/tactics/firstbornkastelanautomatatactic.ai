----------------------------------------
-- File: 'firstbornkastelanautomatatactic.ai'
-- Edited by Thudmeizer @ 17.10.2023

class 'FirstbornKastelanAutomataTactic' (FirstbornInfantryTactic)

FirstbornKastelanAutomata = {}

function FirstbornKastelanAutomataTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Firstborn Kastelan Automata Tactic")
end

function FirstbornKastelanAutomataTactic:InitAbilities()

	-- Init ability ID's
	if (FirstbornKastelanAutomata.shield_id == nil) then
		FirstbornKastelanAutomata.shield_id = cpu_manager.stats:GetAbilityID( "firstborn_kastelan_shield" )
	end

	if (FirstbornKastelanAutomata.selfdestruct_id == nil) then
		FirstbornKastelanAutomata.selfdestruct_id = cpu_manager.stats:GetAbilityID( "firstborn_self_destruct_automata" )
	end
end

function FirstbornKastelanAutomataTactic:DoAbilities()
	
	-- Use Personal Shield if attacking and low on health
	if self.squad_ai:IsAttacking() then

		if (self.squad_ai:WasRecentlyHurt() and self.squad_ai:GetHealthPercentage() < 0.4) then

			if self.squad_ai:CanDoAbility(FirstbornKastelanAutomata.shield_id) then
				self.squad_ai:DoSpecialAbility(FirstbornKastelanAutomata.shield_id)
			end
		end
	end

	-- Initiate Self Destruct if all hope is lost and we can take as many nearby enemies with us
	if (self.squad_ai:WasRecentlyHurt() and self.squad_ai:GetHealthPercentage() < 0.2) then
		if not (self.squad_ai:IsUsingAbility(FirstbornKastelanAutomata.shield_id)) then
			Ability.DoAbilityArea( self.squad_ai, FirstbornKastelanAutomata.selfdestruct_id, Ability.Filters.CloseEnemy, 20, 10 ) 
		end
	end

	-- Do basic abilities
	FirstbornInfantryTactic.DoAbilities(self)
end

