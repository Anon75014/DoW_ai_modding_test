----------------------------------------
-- File: 'Praetorian_MarauderTactic.ai'
-- Edited by fuggles	@ 05.09.2016
-- Edited by Thudmeizer	@ 07.11.2022

class 'Praetorian_MarauderTactic' (Praetorian_VehicleTactic)

Praetorian_Marauder = {}

function Praetorian_MarauderTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Praetorian_Marauder Tactic")
end

function Praetorian_MarauderTactic:InitAbilities()

	-- Init ability ID's
	if (Praetorian_Marauder.smoke_id == nil) then
		Praetorian_Marauder.smoke_id = cpu_manager.stats:GetAbilityID( "praetorian_smoke_bombs" )
	end

	if (Praetorian_Marauder.krak_id == nil) then
		Praetorian_Marauder.krak_id = cpu_manager.stats:GetAbilityID( "praetorian_krak_bombs" )
	end

	if (Praetorian_Marauder.incendiary_id == nil) then
		Praetorian_Marauder.incendiary_id = cpu_manager.stats:GetAbilityID( "praetorian_incendiary_bombs" )
	end
end

function Praetorian_MarauderTactic:DoAbilities()

	-- Check if we can deploy smoke
	if (self.squad_ai:CanDoAbility(Praetorian_Marauder.smoke_id)) then
	
		-- Search a squad
		local iRange = self.squad_ai:GetAbilityRange(Praetorian_Marauder.smoke_id)
		local oUnit = Ability.Filters.CloseHurt(self.squad_ai:GetPosition(), iRange, 1)
		if (oUnit ~= nil and oUnit:IsInCombat() and cpu_manager:GetUnitStrength(oUnit) > 150) then
			self.squad_ai:DoSpecialAbilitySquad(Praetorian_Marauder.smoke_id, oUnit:GetSquad())
		end
	end

	-- Check if we're in close combat - Krak
	local oEnemySquad = Ability.Filters.CloseVehicleEnemy(self.squad_ai:GetPosition(), 0, 1)
	if (oEnemySquad ~= nil) then
	
		-- Check if we can drop Krak Bombs
		if (self.squad_ai:CanDoAbility(Praetorian_Marauder.krak_id)) then
			self.squad_ai:DoSpecialAbility(Praetorian_Marauder.krak_id) 
		end
	end

	-- Check if we're in close combat - Incendiary
	oEnemySquad = Ability.Filters.CloseInfantryEnemy(self.squad_ai:GetPosition(), 0, 5)
	if (oEnemySquad ~= nil and not oEnemySquad:IsBroken()) then
	
		-- Check if we can drop Incendiary Bombs
		if (self.squad_ai:CanDoAbility(Praetorian_Marauder.incendiary_id)) then
			self.squad_ai:DoSpecialAbility(Praetorian_Marauder.incendiary_id) 
		end
	end
end