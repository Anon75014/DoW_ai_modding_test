----------------------------------
-- File: 'jetbiketactic.ai'
-- Edited by Gambit @31.03.2022

class 'JetbikeTactic' (EldarVehicleTactic)

Jetbikes = {}

function JetbikeTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Windraiders Tactic")
end


function JetbikeTactic:CanOnlyDecap()
	return true
end


function JetbikeTactic:InitAbilities()
	-- Init ability ID's
	if Jetbikes.embolden_id == nil then
		Jetbikes.embolden_id = cpu_manager.stats:GetAbilityID("eldar_embolden")
		Jetbikes.entangle_id = cpu_manager.stats:GetAbilityID("eldar_entanglement")
	end
end


function JetbikeTactic:DoAbilities()

	-- Embolden if low morale
	if self.squad_ai:CanDoAbility(Jetbikes.embolden_id) and self.squad_ai:GetMoralePercentage() < 0.6 then
		self.squad_ai:DoSpecialAbility(Jetbikes.embolden_id)
	end

	-- Warlock entanglement
	if self.squad_ai:CanDoAbility( Jetbikes.entangle_id ) then
		local range = self.squad_ai:GetAbilityRange(Jetbikes.entangle_id)
		local squad_pos = self.squad_ai:GetPosition()
		local target = nil

		melee = function(squad)
		 	local is_cc = false    
			if squad:GetMeleeStance() == SquadAI.MSTANCE_Assault then
				is_cc = true   
			end
			return is_cc and squad:GetNumTroopers() >= 4
		end

		target = cpu_manager:FindClosestEnemy( squad_pos, range, melee )
		
		if target ~= nil then
			if self.squad_ai:DoSpecialAbilitySquad(Jetbikes.entangle_id, target:GetSquad()) then
				return
			end
		end
	end

	-- New code to unstuck units with pathing issues, that can jump.
	-- Call it with [true], only for multi-membered squads.
	self:SolveStuckCase(true)
end
