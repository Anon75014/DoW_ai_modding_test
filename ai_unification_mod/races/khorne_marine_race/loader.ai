----------------------------------------
-- File: 'khorneloader.ai'
-- Edited by Thudmeizer @ 18.03.2024

class 'khorne_marine_race'

-- Constructor
function khorne_marine_race:__init()

end

-- Returns the name of the race
function khorne_marine_race:GetRaceName()
	return "khorne_marine_race"
end

-- This function is called if witch hunters are the race being played
function khorne_marine_race:LoadRace( eDifficulty )

	-- Import strategies
	import( 'Races/khorne_marine_race/Strategies/kBuildBaseStrategy.ai' )

	-- Import strategy info
	import( "Races/khorne_marine_race/Strategies/kStrategyInfo.ai" )
	
	-- Import tactics
	import( 'Races/khorne_marine_race/Tactics/kInfantryTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kVehicleTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kSlaveTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kcultTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kKBTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kMTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kChosenTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kBloodWolfTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kPossessedTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kTerminatorTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kRampagersTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kLordTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kLordTerminatorTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kDarkApostleTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kSurgeonTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kWarpsmithTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kCultLeaderTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kCrullTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kSvaneTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kZhuforTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kKharnTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kDaemonPrinceTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kDaemonLordTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kWOKTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kDefilerTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kKnightTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kKnightRampagerTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kSicaranTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kMeatCarrierTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kBloodThirsterTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kHeldrakeTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kLotaraTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kLpTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kTempleTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kBaseDeepTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kHqDeepTactic.ai' )
	import( 'Races/khorne_marine_race/Tactics/kResearchKtgmTactic.ai' )

	-- Last Standing / Kill Team
	import( 'Races/khorne_marine_race/Tactics/kKharnktgmTactic.ai' )

 	-- GAMBIT: New Method of returning a squad or base Tactic (from the CreateTactic function). Indexes.
	-- Here follows a Global List with all the squad names as indexes, and their Tactics as values
	-- The name of the Global List must be unique for each race.
    	KH_Race_Squad_Tactic =
    	{
        -- Insert here SQUAD_NAME or BASE_NAME and the TACTIC NAME (with the comma at the end!)
        -- If a squad must NOT have a Tactic attached to it AT ALL, use "NONE" (with quotes, case sensitive).
        -- Suggestion: Better put all in alphabetical order (sorted by squad names) for easier reference

        khm_squad_will_of_khorne = kWOKTactic,
        khm_squad_slave = kSlaveTactic,
        khm_squad_techmarine = kSlaveTactic,
        khm_squad_kasrkin = kBCVTactic,
        khm_squad_marine_bolter = kTOKTactic,
        khm_squad_marine_teeth = kTOKTactic,
        khm_squad_raptor = kTOKTactic,
        khm_squad_khorne_berserker = kKBTactic,
        khm_squad_khorne_berserker_broken = kKBTactic, 
        khm_squad_chosen_berzerkers = kChosenTactic,
        khm_squad_chosen_heavy = kChosenTactic,
        khm_squad_chosen_range = kChosenTactic, 
        khm_squad_blood_wolf = kBloodWolfTactic,
        khm_squad_rampager = kRampagersTactic,
        khm_squad_possessed_marine = kPossessedTactic,
        khm_squad_khorne_terminator = kTerminatorTactic,
        khm_squad_khorne_terminator_assault = kTerminatorTactic,
        khm_squad_cult_leader = kCultLeaderTactic,
        khm_squad_surgeon = kSurgeonTactic,
        khm_squad_daemon_lord_khorne = kDaemonLordTactic,
        khm_squad_warpsmith = kWarpsmithTactic,
        khm_squad_dark_apostle = kApostleTactic,
        khm_squad_hero_lotara = kLotaraTactic,
        khm_squad_lord_khorne = kLordTactic,
        khm_squad_lord_khorne_terminator = kLordTerminatorTactic,
        khm_squad_hero_crull = kCrullTactic,
        khm_squad_hero_kharn = kKharnTactic,
        khm_squad_hero_kharn_ktgm = kKharnktgmTactic,
        khm_squad_hero_svane = kSvaneTactic,
        khm_squad_hero_zhufor = kZhuforTactic,
        khm_squad_daemon_prince_khorne = kDaemonPrinceTactic,
        khm_squad_bloodthirster = kBloodThirsterTactic,
	khm_squad_banelord = kBloodThirsterTactic,
        khm_squad_cult_vehicles_meat_carrier = kMeatCarrierTactic,
        khm_squad_defiler_blood = kDefilerTactic,
        khm_squad_sicaran = kSicaranTactic,
        khm_squad_heldrake = kHeldrakeTactic,
        khm_squad_knight_range = kKnightTactic,
        khm_squad_knight_melee = kKnightRampagerTactic,
	}

    	KH_Race_Base_Tactic =
	{
        khm_hq = khqdeepTactic,
        khm_listening_post = klpTactic,
        khm_temple = khTempleTactic,
	khm_machine_pit = DeepTactic,
        khm_sacrificial_circle = DeepTactic,
        khm_greater_sacrificial_circle = DeepTactic,
        khm_research_ktgm = khResearchKtgmTactic,
	}
	return true
end

-- This function is called even if witch hunters are not the race being played
function khorne_marine_race:LoadGlobalInfo()

	-- Import info files
	import( 'Races/khorne_marine_race/Info/kunitstats.ai' )

	-- Add Khorne unit stats
	table.insert(UnitStats,kUnitStats)
	return true
end

-- Creates build base strategy
function khorne_marine_race:CreateBuildBaseStrategy()
	return kBuildBaseStrategy(BuildBaseStrategyInfo)
end

-- Creates a special tactic for units
-- GAMBIT: Updated version, with no IFs at all, much faster and reliable. CPU utilization nigh zero
function khorne_marine_race:CreateTactic(oSquadAI)

    	-- Get unit name, and see if there is an attached tactic to it
    	local sUnitName = oSquadAI:GetSquadName()    
	if sUnitName ~= nil and KH_Race_Squad_Tactic[sUnitName] ~= nil then
		if KH_Race_Squad_Tactic[sUnitName] == "NONE" then
            		-- The squad must have NO tactic. Return nil.
            		return nil
        	else
            		return KH_Race_Squad_Tactic[sUnitName](oSquadAI)
        	end
    	end

	if (oSquadAI:IsEngineer()) then
		return nil
	end

	-- Get class
	local eClass = oSquadAI:GetStats():GetClass()

	-- Check if there is a special tactic for the unit available
	local bVehicle = (eClass == UnitStatsAI.UC_VehicleLow or eClass == UnitStatsAI.UC_VehicleMed or eClass == UnitStatsAI.UC_VehicleHigh)
	local bAirPlane = (eClass == UnitStatsAI.UC_AirLow or eClass == UnitStatsAI.UC_AirMed or eClass == UnitStatsAI.UC_AirHigh)

	if (bVehicle or bAirPlane) then
		return kVehicleTactic(oSquadAI)
	end
	return kInfantryTactic(oSquadAI)
end

-- Creates a special tactic for buildings
-- GAMBIT: Updated version, with no IFs at all, much faster and reliable. CPU utilization nigh zero
function khorne_marine_race:CreateBaseTactic(oBuilding)

	-- Get building name
	local sBuildingName = oBuilding:GetBaseName()
	if sBuildingName ~= nil and KH_Race_Base_Tactic[sBuildingName] ~= nil then
		if KH_Race_Base_Tactic[sBuildingName] == "NONE" then
            		-- The building must have NO tactic. Return nil.
            		return nil
        	else
            		return KH_Race_Base_Tactic[sBuildingName](oBuilding)
        	end
    	end
	return nil
end

-- Returns a specific information
function khorne_marine_race:GetInfo(sType)
	if (sType == "TurretPower") then
		return 400
	elseif (sType == "SupportAllyFactor") then
		return 4 / 4
	elseif (sType == "AttackModifier") then
		return 5
	elseif (sType == "CriticalRangeIncreasePerTier") then
		return 10
	elseif (sType == "MinArmyStrengthPerTier") then
		return 750
	elseif (sType == "AttackRatio") then
		return 4 / 5
	elseif (sType == "RetreatRatio") then
		return 2 / 5
	elseif (sType == "InvisibleBuildings") then
		return false
	elseif (sType == "HarassingLeader") then
		self.g_iHarassingLeader = math.random(1, 5)
		if (g_iHarassingLeader == 1) then
            return "khm_squad_lord_khorne"
        elseif (g_iHarassingLeader == 2) then
            return "khm_squad_surgeon"
        elseif (g_iHarassingLeader == 3) then
            return "khm_squad_cult_leader"
        elseif (g_iHarassingLeader == 4) then
            return "khm_squad_daemon_lord_khorne"
        elseif (g_iHarassingLeader == 5) then
            return "khm_squad_bloodletter_hero"
        end
	elseif (sType == "AutoConstructBuildings") then
		return false
	end
	return nil
end

-- Returns the building type and threat
function khorne_marine_race:GetBuildingType(sBuildingName)
	if (sBuildingName == "khm_hq") then
		return "HQ", 0
	elseif (sBuildingName == "khm_plasma_generator") then
		return "Generator", 0
	elseif (sBuildingName == "khm_thermo_plasma_generator") then
		return "BiggerGenerator", 0
	elseif (sBuildingName == "khm_machine_pit") then
		return "VehicleBuilding", 0
	elseif (sBuildingName == "khm_armoury") then
		return "Armoury", 0
	elseif (sBuildingName == "khm_listening_post") then
		return "ListeningPost", 0
	elseif (sBuildingName == "khm_turret") then
		return "Turret", 300
	elseif (sBuildingName == "khm_razor_mine") then
		return "Mine", 100
	end
	return nil, 0
end