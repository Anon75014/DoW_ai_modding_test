----------------------------------------
-- File: 'kapostletactic.ai'
-- Created by I_Chample
-- Edited by Thudmeizer  @ 09.03.2023

class 'kApostleTactic' (kInfantryTactic)

kApostle = {}

function kApostleTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("k Apostle Tactic")
end

function kApostleTactic:IsAttacker()
	return self:IsCommanderAttacker()
end

function kApostleTactic:IsDefender()
	return self:IsCommanderDefender()
end

function kApostleTactic:InitAbilities()

	if (kApostle.wrathful_entreaty_id == nil) then
		kApostle.wrathful_entreaty_id = cpu_manager.stats:GetAbilityID( "khm_dark_apostle_wrathful_entreaty" )	
	end

	if (kApostle.soultearer_portent_id == nil) then
		kApostle.soultearer_portent_id = cpu_manager.stats:GetAbilityID( "khm_dark_apostle_soultearer_portent" )	
	end

	if (kApostle.litany_of_despair_id == nil) then
		kApostle.litany_of_despair_id = cpu_manager.stats:GetAbilityID( "khm_dark_apostle_litany_of_despair" )	
	end

	if (kApostle.benediction_of_darkness_id == nil) then
		kApostle.benediction_of_darkness_id = cpu_manager.stats:GetAbilityID( "khm_dark_apostle_benediction_of_darkness" )	
	end

	if (kApostle.warp_sight_plea_id == nil) then
		kApostle.warp_sight_plea_id = cpu_manager.stats:GetAbilityID( "khm_dark_apostle_warp_sight_plea" )	
	end

	if (kApostle.dark_pray_id == nil) then
		kApostle.dark_pray_id = cpu_manager.stats:GetAbilityID( "khm_dark_pray" )	
	end
end

function kApostleTactic:DoAbilities()

	Ability.DoAbility( self.squad_ai, kApostle.wrathful_entreaty_id, Ability.Filters.IsInCombat )
	Ability.DoAbility( self.squad_ai, kApostle.soultearer_portent_id, Ability.Filters.IsInCombat )
	Ability.DoAbility( self.squad_ai, kApostle.litany_of_despair_id, Ability.Filters.IsInCombat )
	Ability.DoAbility( self.squad_ai, kApostle.benediction_of_darkness_id, Ability.Filters.IsInCombat )
	Ability.DoAbility( self.squad_ai, kApostle.warp_sight_plea_id, Ability.Filters.IsInCombat )

	if (self.squad_ai:WasRecentlyHurt() and self.squad_ai:GetHealthPercentage() < 0.4) then
		if self.squad_ai:CanDoAbility(kApostle.dark_pray_id) then
			self.squad_ai:DoSpecialAbility(kApostle.dark_pray_id)
		end
	end
end

function kApostleTactic:Update()

	if (self:IsComplete()) then
		return
	end

	if (not InfantryTactic.Update( self )) then
		return
	end

	-- Check if we are in serious trouble
	self:EmergencyRetreat()
end
