----------------------------------------
-- File: 'kvehicletactic.ai'
-- Edited by Thudmeizer  @ 09.03.2023

class 'kVehicleTactic' (VehicleTactic)

function kVehicleTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("kVehicleTactic")

	local sSquadName = squad_ai:GetSquadName()
	if sSquadName == "khm_squad_dreadnought_khorne" or
		sSquadName == "khm_squad_dreadnought_khorne_range" or
		sSquadName == "khm_squad_dreadnought_beast" then
			self.m_iDeepStrikeBlueprintID = cpu_manager.stats:GetBuildingID( "khm_machine_pit" )
	end
end

function kVehicleTactic:DoAbilities()

	if (self.squad_ai:IsInCombat() and not self.squad_ai:IsCapturing() and not self.squad_ai:IsBroken()) then
		if (not self:IsMoving()) then
			local machines_rage_id = cpu_manager.stats:GetAbilityID( "khm_machines_rage" )
			if (self.squad_ai:CanDoAbility( machines_rage_id )) then
				self.squad_ai:DoSpecialAbility( machines_rage_id )
			end
		end		
	end

	if (self.squad_ai:IsInCombat() and not self.squad_ai:IsCapturing() and not self.squad_ai:IsBroken()) then
		if (not self:IsMoving()) then
			local banelord_shield_id = cpu_manager.stats:GetAbilityID( "khm_banelord_shield" )
			if (self.squad_ai:CanDoAbility( banelord_shield_id )) then
				self.squad_ai:DoSpecialAbility( banelord_shield_id )
			end
		end		
	end

	VehicleTactic.DoAbilities(self)
end

-- Check if the vehicle should dance away in melee
function kVehicleTactic:CheckVehicleDance(sName)

	if (sName == "khm_squad_possessed_tank" or
		sName == "khm_squad_cult_vehicles_meat_carrier" or
		sName == "khm_squad_dreadnought_beast" or
		sName == "khm_squad_dreadnought_khorne" or
		sName == "khm_squad_dreadnought_khorne_range" or
		sName == "khm_squad_defiler_blood" or
		sName == "khm_squad_defiler_blood_improved" or
		sName == "khm_squad_doomblaster" or
		sName == "khm_squad_heldrake" or
		sName == "khm_squad_sicaran" or
		sName == "khm_squad_kytan" or
		sName == "khm_squad_knight_melee" or
		sName == "khm_squad_knight_range" or
		sName == "khm_squad_lord_of_skulls" or
		sName == "khm_squad_banelord") then
		return true
	end
	return false
end