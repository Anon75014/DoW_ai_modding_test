----------------------------------------
-- File: 'kKnighttactic.ai'
-- Created by I_Chample
-- Edited by Thudmeizer  @ 22.05.2020

class 'kKnightTactic' (kVehicleTactic)

kKnight = {}

function kKnightTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Chaos Knight Tactic")
end

function kKnightTactic:AutoBuildAddOn( addonSlot )
	for e in self.squad_ai:GetEntities() do
		local buildChannelkKnight = build_manager:GetBuildChannelFromID(e:GetID())
		if (buildChannelkKnight ~= nil) then
			local addOnID = buildChannelkKnight:GetItemIDAt(BuildChannelAI.PQ_AddOn, addonSlot)
			if (buildChannelkKnight:IsBuilding() == 0 and buildChannelkKnight:CanAddToQueue(BuildChannelAI.PQ_AddOn, addOnID) == BuildChannelAI.CANBUILD_Ok) then			
				buildChannelkKnight:BuildAddOn(addOnID)
				return
			end
		end
	end
	return
end

function kKnightTactic:InitAbilities()

	if (kKnight.ion_shield_id == nil) then
		kKnight.ion_shield_id = cpu_manager.stats:GetAbilityID( "khm_knight_ion_shield" )
	end
end

function kKnightTactic:DoAbilities()

	if (self.squad_ai:WasRecentlyHurt() and not self.squad_ai:IsInStateMove() and not self.squad_ai:IsInStateAttackMove()) then
		if (self.squad_ai:CanDoAbility(kKnight.ion_shield_id)) then
			self.squad_ai:DoSpecialAbility(kKnight.ion_shield_id)
		end	  
	end
	kVehicleTactic.DoAbilities(self)
end


function kKnightTactic:Upgrade()
--[[
self:AutoBuildAddOn(0)	-- khm_knight_chaingun_addon
self:AutoBuildAddOn(1)	-- khm_knight_thermal_cannon_addon
self:AutoBuildAddOn(2)	-- khm_knight_las_destructor_addon
self:AutoBuildAddOn(3)	-- khm_knight_quad_autocannon_addon
self:AutoBuildAddOn(4)	-- khm_knight_missile_launcher_addon
]]

	local standard_wargear_addons = math.random( 0,2 )
	local heavy_wargear_addons = math.random( 0,1 )

	-- Randomize between the Gatling, Thermal, or Laser Cannons
	if (standard_wargear_addons == 0) then
		self:AutoBuildAddOn(0)
	elseif (standard_wargear_addons == 1) then
		self:AutoBuildAddOn(1)
	elseif (standard_wargear_addons == 2) then
		self:AutoBuildAddOn(2)
	end

	-- Randomize between either the Autocannon or Missile Launcher
	if (heavy_wargear_addons == 0) then
		self:AutoBuildAddOn(3)
	elseif (heavy_wargear_addons == 1) then
		self:AutoBuildAddOn(4)
	end
end