----------------------------------------
-- File: 'interceptorsptactic.ai'
-- Edited by Thudmeizer @ 11.03.2024

class 'InterceptorSPTactic' (DaemonhuntInfantryGKTactic)

InterceptorSP = {}

function InterceptorSPTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Interceptors Campaign Tactic")
	self.m_iTransportable = 1
end

function InterceptorSPTactic:InitAbilities()

	if (InterceptorSP.warp_quake == nil) then
	    InterceptorSP.warp_quake = cpu_manager.stats:GetAbilityID( "inquisition_warp_quake" )	
	end

	if (InterceptorSP.melta_bombs == nil) then
	    InterceptorSP.melta_bombs = cpu_manager.stats:GetAbilityID( "inquisition_melta_bombs_interceptors" )	
	end
end

function InterceptorSPTactic:DoAbilities()
-- The following, is for making it targeted... But visually is awful
--self.squad_ai:DoSpecialAbilitySquad(InterceptorSP.warp_quake, self.squad_ai:GetSquad())

	-- Disable jumping for nearby enemy squads
	if self.squad_ai:CanDoAbility(InterceptorSP.warp_quake) and self.squad_ai:IsInCombat() then
		if not self.squad_ai:IsBroken() and self.squad_ai:GetNumTroopers() > 4 and self.squad_ai:GetHealthPercentage() > 0.6 then
			local iPos = self.squad_ai:GetPosition()
			local oSquad = cpu_manager.cpu_player:FindFirstInfantryEnemy(iPos, 20, 1)
			if oSquad ~= nil then
				if oSquad:CanJump() then
					self.squad_ai:DoSpecialAbility(InterceptorSP.warp_quake)
					return
				end
			end
			oSquad = cpu_manager.cpu_player:FindFirstCommanderEnemy(iPos, 20, 1)
			if oSquad ~= nil then
				if oSquad:CanJump() then
					self.squad_ai:DoSpecialAbility(InterceptorSP.warp_quake)
					return
				end
			end
			local isDaemon = function(oSquad, iCount)
				local oStats = oSquad:GetStats()
				if oStats == nil then return false end
				local oClass = oStats:GetClass()
				return oClass == UnitStatsAI.UC_MonsterHigh or oClass == UnitStatsAI.UC_MonsterMed
			end
			oSquad = cpu_manager:GetClosestSquad(iPos, 20, isDaemon, 1)
			if oSquad ~= nil then
				if oSquad:CanJump() then
					self.squad_ai:DoSpecialAbility(InterceptorSP.warp_quake)
					return
				end
			end
		end
	end

	if self.squad_ai:CanDoAbility(InterceptorSP.melta_bombs) then 
		Ability.DoAbilityTarget( self.squad_ai, InterceptorSP.melta_bombs, Ability.Filters.CloseVehicleEnemy, 1 )
		Ability.DoAbilityTargetEntity( self.squad_ai, InterceptorSP.melta_bombs, Ability.EntityFilters.CloseBaseEntityEnemy, 1)
	end
end
