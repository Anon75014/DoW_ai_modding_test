----------------------------------------
-- File: 'bodyguardsptactic.ai'
-- Edited by Thudmeizer @ 11.03.2024

class 'BodyGuardSPTactic' (DaemonhuntInfantryTactic)

BodyGuardSP = {}

function BodyGuardSPTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("BodyGuard Campaign Tactic")
end

function BodyGuardSPTactic:InitAbilities()

	if (BodyGuardSP.frag_id == nil) then
	    BodyGuardSP.frag_id = cpu_manager.stats:GetAbilityID( "inquisition_frag_grenades_bodyguards_advance" )	
	end

	if (BodyGuardSP.crack_id == nil) then
	    BodyGuardSP.crack_id = cpu_manager.stats:GetAbilityID( "inquisition_crack_grenades_bodyguards_advance" )	
	end
end

function BodyGuardSPTactic:DoAbilities()
	
	if self.squad_ai:IsInCombat() then
		Ability.DoAbilityTarget( self.squad_ai, BodyGuardSP.frag_id, Ability.Filters.CloseSquadEnemy, 3 )
		Ability.DoAbilityTarget( self.squad_ai, BodyGuardSP.frag_id, Ability.Filters.CloseCommanderEnemy, 1 )
		Ability.DoAbilityTarget( self.squad_ai, BodyGuardSP.frag_id, Ability.Filters.CloseMonsterEnemy, 3 )

		Ability.DoAbilityTarget( self.squad_ai, BodyGuardSP.crack_id, Ability.Filters.CloseVehicleEnemy, 1 )
		Ability.DoAbilityTargetEntity( self.squad_ai, BodyGuardSP.crack_id, Ability.EntityFilters.CloseBaseEntityEnemy, 1)
	end
end

function BodyGuardSPTactic:Upgrade()

 	-- If I am broken, don't upgrade!
	if (self:IsAffectedByMorale() and self.squad_ai:IsBroken()) then
		return
	end

	-- If there are no resources available, don't upgrade!
	if (not Tactic.Options.can_reinforce) then
		return
	end

	if (not self.squad_ai:IsReinforcing() and cpu_manager:GetTierLevel() >= 2) then
	  
		-- Try for upgrade if we've a leader and more than 6 troopers
		if self.squad_ai:HasUpgradableTrooper() and (self.squad_ai:GetLeaderCount(0) == 1 or self.squad_ai:GetLeaderCount(1) == 1) then
			local class_type = cpu_manager:FindClosestEnemyPlayer():GetMajorityClassType()
			self.squad_ai:DoBestUpgrade( class_type )
		end
	end
end
