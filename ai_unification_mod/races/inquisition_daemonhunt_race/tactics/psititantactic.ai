----------------------------------------
-- File: 'psititantactic.ai'
-- Edited by Gambit		@ 17.09.2021

class 'PsiTitanTactic' (DaemonhuntVehicleTactic)

PsiTitan = {}

function PsiTitanTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Psi-Titan Tactic")
end


function PsiTitanTactic:InitAbilities()

	-- Init ability ID's
	if PsiTitan.quickening_id == nil then
		PsiTitan.quickening_id = cpu_manager.stats:GetAbilityID( "inquisition_psi_titan_quickening" )
		PsiTitan.death_pulse_id = cpu_manager.stats:GetAbilityID( "inquisition_psi_titan_death_pulse" )
		PsiTitan.necrotechica_id = cpu_manager.stats:GetAbilityID( "inquisition_psi_titan_necrotechica" )
	end
end


function PsiTitanTactic:DoAbilities()

	-- Check if I can use machine spirit while stationary
	-- if (self.squad_ai:WasRecentlyHurt() and not self.squad_ai:IsInStateMove() and not self.squad_ai:IsInStateAttackMove()) then

	if self.squad_ai:CanDoAbility(PsiTitan.necrotechica_id) and self.squad_ai:GetHealthPercentage() < 0.6 then
		self.squad_ai:DoSpecialAbility(PsiTitan.necrotechica_id)
	end

	if self.squad_ai:IsInCombat() then
		if self.squad_ai:CanDoAbility(PsiTitan.quickening_id) and self.squad_ai:IsInStateMove() then
			if Ability.DoAbilityArea(self.squad_ai, PsiTitan.quickening_id, Ability.Filters.CloseSquadEnemy, 10, 4)
			or Ability.DoAbilityArea(self.squad_ai, PsiTitan.quickening_id, Ability.Filters.CloseMonsterEnemy, 10, 4) then
				return
			end
		end
		
		if self.squad_ai:CanDoAbility(PsiTitan.death_pulse_id) then
			local iPos = self.squad_ai:GetPosition()
			if Ability.Filters.CloseInfantryEnemy(iPos, 15, 6) ~= nil
			or Ability.Filters.CloseMonsterEnemy(iPos, 15, 6) ~= nil then
				self.squad_ai:DoSpecialAbility(PsiTitan.death_pulse_id)
			end
		end
	end
end
