----------------------------------------
-- File: 'dhcrowetactic.ai'
-- Created by Gambit @ 11.06.2021

class 'DHCroweTactic' (DaemonhuntInfantryGKTactic)

DHCrowe = {}

function DHCroweTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Castellan Garran Crowe Tactic")
	self.m_iTransportable = 1
end


function DHCroweTactic:InitAbilities()

	if DHCrowe.psyk_out_id == nil then
	    DHCrowe.psyk_out_id = cpu_manager.stats:GetAbilityID( "inquisition_crowe_psykout_grenades" )	
	end
end


function DHCroweTactic:DoAbilities()

	if self.squad_ai:IsInCombat() then
		if self.squad_ai:CanDoAbility(DHCrowe.psyk_out_id) then
			if Ability.DoAbilityTarget( self.squad_ai, DHCrowe.psyk_out_id, Ability.Filters.CloseCommanderEnemy, 1 )
			or Ability.DoAbilityTarget( self.squad_ai, DHCrowe.psyk_out_id, Ability.Filters.CloseMonsterEnemy, 1 )
			then
				return
			end
		end
	end
end


function DHCroweTactic:Update()

	if self:IsComplete() then
		return
	end

	-- State machine
	if not InfantryTactic.Update(self) then
		return
	end

	if self.squad_ai:GetMeleeStance() == SquadAI.MSTANCE_Assault then
		if self.squad_ai:IsInCombat() or self.squad_ai:WasRecentlyHurt() then
			if self:TryAttachSquad(false, true, 50, 150, self.m_fCommanderAttachHealth) == nil then
				self:TryAttachSquadMelee()
			end
		end
	end
end
