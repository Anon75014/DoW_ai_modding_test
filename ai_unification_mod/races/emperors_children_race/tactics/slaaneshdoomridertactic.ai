----------------------------------------
-- File: 'slaaneshdoomridertactic.ai'
-- Edited by Thudmeizer	@ 25.04.2010

class 'SlaaneshDoomriderTactic' (EmperorsChildrenInfantryTactic)

SlaaneshDoomrider = {}

function SlaaneshDoomriderTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Slaanesh Doomrider Tactic")
end

function SlaaneshDoomriderTactic:InitAbilities()

	-- Init ability ID's
	if SlaaneshDoomrider.cocaine_id == nil then
		SlaaneshDoomrider.cocaine_id = cpu_manager.stats:GetAbilityID( "emperors_children_cocaine" )	
	end

	if SlaaneshDoomrider.frag_id == nil then
		SlaaneshDoomrider.frag_id = cpu_manager.stats:GetAbilityID( "emperors_children_frag_grenades" )	
	end
end

function SlaaneshDoomriderTactic:DoAbilities()

	-- Check if I can use in-combat abilities 
	if self.squad_ai:IsInCombat() then

		-- Use Cocaine, baby!!
		if self.squad_ai:CanDoAbility(SlaaneshDoomrider.cocaine_id) and self.squad_ai:WasRecentlyHurt()
		and self.squad_ai:GetHealthPercentage() < 0.25 then
			self.squad_ai:DoSpecialAbility(SlaaneshDoomrider.cocaine_id)
		end

		-- Frag the bitches!!
		if self.squad_ai:CanDoAbility(SlaaneshDoomrider.frag_id) then
            if Ability.DoAbilityTarget( self.squad_ai, SlaaneshDoomrider.frag_id, Ability.Filters.CloseSquadEnemy, 1 )
            or Ability.DoAbilityTarget( self.squad_ai, SlaaneshDoomrider.frag_id, Ability.Filters.CloseCommanderEnemy, 1 )
            or Ability.DoAbilityTarget( self.squad_ai, SlaaneshDoomrider.frag_id, Ability.Filters.CloseMonsterEnemy, 1 ) then
				return
			end
		end
	end
end

function SlaaneshDoomriderTactic:Update()

	if (self:IsComplete()) then
		return
	end
	
	-- State machine
	if (not InfantryTactic.Update( self )) then
		return
	end
	
    -- Set unit on melee stance
	self.squad_ai:DoSetMeleeStance(SquadAI.MSTANCE_Assault)
end