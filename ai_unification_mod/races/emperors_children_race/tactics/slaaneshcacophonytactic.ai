----------------------------------------
-- File: 'slaaneshcacophonytactic.ai'
-- Edited by Gambit	@ 27.07.2018

class 'SlaaneshCacophonyTactic' (EmperorsChildrenInfantryTactic)

SlaaneshCacophony = {}

function SlaaneshCacophonyTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Slaanesh Cacophony Tactic")
	self.doomsirenCast = g_iGMT
end

function SlaaneshCacophonyTactic:InitAbilities()

	-- Init ability ID's
	if (SlaaneshCacophony.doomsiren_id == nil) then
		SlaaneshCacophony.doomsiren_id = cpu_manager.stats:GetAbilityID( "emperors_children_doom_siren" )
		SlaaneshCacophony.solo_id = cpu_manager.stats:GetAbilityID( "emperors_children_soloist_solo" )
	end
end

function SlaaneshCacophonyTactic:DoAbilities()

	if (self.squad_ai:IsInCombat()) then
		if g_iGMT > self.doomsirenCast + 8 and self.squad_ai:CanDoAbility(SlaaneshCacophony.doomsiren_id) then
			Ability.DoAbilityArea(self.squad_ai, SlaaneshCacophony.doomsiren_id, Ability.Filters.CloseEnemy, 10, 4 )
			self.doomsirenCast = g_iGMT
			return
		end
	end

	if self.squad_ai:CanDoAbility(SlaaneshCacophony.solo_id) then
		local req = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Requisition )
		local pow = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Power )
		if req > 650 and pow > 650 then
			self.squad_ai:DoSpecialAbility(SlaaneshCacophony.solo_id)
		end
	end
end

function SlaaneshCacophonyTactic:Reinforce()

	if not self.squad_ai:IsReinforcing() then
		if self.squad_ai:GetLeaderCount(0) == 0 and self.squad_ai:CanReinforce( true, 0 ) then
			self.squad_ai:DoReinforce( true, 0 )
		elseif self.squad_ai:GetLeaderCount(1) == 0 and self.squad_ai:CanReinforce( true, 1 ) then
			self.squad_ai:DoReinforce( true, 1 )
		elseif self.squad_ai:GetLeaderCount(2) == 0 and self.squad_ai:CanReinforce( true, 2 ) then
			self.squad_ai:DoReinforce( true, 2 )
		elseif self.squad_ai:GetLeaderCount(3) == 0 and self.squad_ai:CanReinforce( true, 3 ) then
			self.squad_ai:DoReinforce( true, 3 )
		elseif self.squad_ai:CanReinforce( false, 0 ) then
			self.squad_ai:DoReinforce( false, 0 )
		end 
	end
end
