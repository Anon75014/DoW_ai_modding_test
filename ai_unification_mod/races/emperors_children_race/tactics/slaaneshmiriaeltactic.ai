----------------------------------------
-- File: 'slaaneshmiriaeltactic.ai'
-- Edited by Gambit @ 24.07.2018

class 'SlaaneshMiriaelTactic' (EmperorsChildrenInfantryTactic)

SlaaneshMiriael = {}

function SlaaneshMiriaelTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Slaanesh Miriael Sabathiel Tactic")
end


function SlaaneshMiriaelTactic:InitAbilities()

	-- Init ability ID's
	if (SlaaneshMiriael.airstrike_id == nil) then
		SlaaneshMiriael.airstrike_id = cpu_manager.stats:GetAbilityID( "emperors_children_airstrike_mimi" )
		SlaaneshMiriael.alure_id = cpu_manager.stats:GetAbilityID( "emperors_children_allure_miri" )
		SlaaneshMiriael.siren_id = cpu_manager.stats:GetAbilityID( "emperors_children_doom_siren" )
		SlaaneshMiriael.rosarius_id = cpu_manager.stats:GetAbilityID( "emperors_children_miri_rosarius_wargear" )
		SlaaneshMiriael.plasma_id = cpu_manager.stats:GetAbilityID( "emperors_children_charged_plasma_shot_miri" )
		SlaaneshMiriael.raptors_id = cpu_manager.stats:GetAbilityID( "emperors_children_call_raptors_ability" )
	end
end


function SlaaneshMiriaelTactic:DoAbilities()

	-- Check if I can use in-combat abilities 
	if self.squad_ai:IsInCombat() then
		-- First, see if we can possess to Avatar state
		if self.squad_ai:CanPossess() and self.squad_ai:GetHealthPercentage() < 0.8 then
			self.squad_ai:DoPossess()
			return
		end
		if self.squad_ai:CanDoAbility(SlaaneshMiriael.rosarius_id) and self.squad_ai:WasRecentlyHurt()
		and self.squad_ai:GetHealthPercentage() < 0.25 then
			self.squad_ai:DoSpecialAbility(SlaaneshMiriael.rosarius_id)
			return
		end
		if self.squad_ai:CanDoAbility(SlaaneshMiriael.alure_id) then
            if Ability.DoAbilityTarget( self.squad_ai, SlaaneshMiriael.alure_id, Ability.Filters.CloseInfantryEnemy, 1 )
            or Ability.DoAbilityTarget( self.squad_ai, SlaaneshMiriael.alure_id, Ability.Filters.CloseCommanderEnemy, 1 )
            or Ability.DoAbilityTarget( self.squad_ai, SlaaneshMiriael.alure_id, Ability.Filters.CloseMonsterEnemy, 1 ) then
				return
			end
		end
		if self.squad_ai:CanDoAbility(SlaaneshMiriael.plasma_id) then
			if Ability.DoAbilityTarget( self.squad_ai, SlaaneshMiriael.plasma_id, Ability.Filters.CloseCommanderEnemy, 1 ) 
			or Ability.DoAbilityTarget( self.squad_ai, SlaaneshMiriael.plasma_id, Ability.Filters.CloseMonsterEnemy, 1 )
			or Ability.DoAbilityTarget( self.squad_ai, SlaaneshMiriael.plasma_id, Ability.Filters.CloseVehicleEnemy, 1 ) then
				return
			end
		end
		if self.squad_ai:CanDoAbility(SlaaneshMiriael.siren_id) then
			Ability.DoAbilityArea(self.squad_ai, SlaaneshMiriael.siren_id, Ability.Filters.CloseEnemy, 10, 4 )
		end
		if self.squad_ai:CanDoAbility(SlaaneshMiriael.airstrike_id) then
			Ability.DoAbilityArea( self.squad_ai, SlaaneshMiriael.airstrike_id, Ability.Filters.CloseEnemy, 10, 3 )
			return
		end
		if self.squad_ai:CanDoAbility(SlaaneshMiriael.raptors_id) and
		resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Requisition ) > 800 then
			self.squad_ai:DoSpecialAbility(SlaaneshMiriael.raptors_id)
		end
	end
end
