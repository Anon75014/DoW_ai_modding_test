----------------------------------------
-- File: 'slaaneshintonerluctactic.ai'
-- Edited by Gambit 	@ 27.09.2019
-- Edited by Thudmeizer @ 11.10.2023

class 'SlaaneshIntonerLucTactic' (EmperorsChildrenInfantryTactic)

SlaaneshIntoner = {}

function SlaaneshIntonerLucTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Slaanesh Intoner Tactic")
	self.m_iDeepStrikeBlueprintID = cpu_manager.stats:GetBuildingID("emperors_children_sacrificial_circle")
end

function SlaaneshIntonerLucTactic:InitAbilities()

	-- Init ability ID's
	if (SlaaneshIntoner.alure_id == nil) then
		SlaaneshIntoner.alure_id = cpu_manager.stats:GetAbilityID( "emperors_children_allure_intoner" )
		SlaaneshIntoner.light_id = cpu_manager.stats:GetAbilityID( "emperors_children_light_of_slaanesh" )
		SlaaneshIntoner.warp_spawn_id = cpu_manager.stats:GetAbilityID( "emperors_children_summon_chaos_spawn_ability" )
		SlaaneshIntoner.bodyguards_id = cpu_manager.stats:GetAbilityID( "emperors_children_summon_bodybuards_ability" )
		SlaaneshIntoner.doomsiren_id = cpu_manager.stats:GetAbilityID( "emperors_children_doom_siren_warp_talons" )
	end
end

function SlaaneshIntonerLucTactic:DoAbilities()

	-- Check if I can use in-combat abilities 
	if self.squad_ai:IsInCombat() then

		if self.squad_ai:CanDoAbility(SlaaneshIntoner.alure_id) then
			Ability.DoAbilityTarget( self.squad_ai, SlaaneshIntoner.alure_id, Ability.Filters.CloseInfantryEnemy, 1 )
		end

		if self.squad_ai:CanDoAbility(SlaaneshIntoner.bodyguards_id) and
		resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Requisition ) > 800 then
			local oSquad = Ability.Filters.CloseEnemy(self.squad_ai:GetPosition(), 8, 4)
			if oSquad ~= nil then
				self.squad_ai:DoSpecialAbilityPos(SlaaneshIntoner.bodyguards_id, oSquad:GetPosition())
				return
			end
		end
		
		if self.squad_ai:CanDoAbility(SlaaneshIntoner.doomsiren_id) then
			local oSquad = Ability.Filters.CloseInfantryEnemy(self.squad_ai:GetPosition(), 8, 4)
			if oSquad ~= nil then 
				self.squad_ai:DoSpecialAbility(SlaaneshIntoner.doomsiren_id)
				return
			end
		end
	end

	-- Cast Light Of Slaanesh independently
	if self.squad_ai:CanDoAbility(SlaaneshIntoner.light_id) and
	Ability.Filters.CloseHurt(self.squad_ai:GetPosition(), 30, 2) then
		self.squad_ai:DoSpecialAbilitySquad(SlaaneshIntoner.light_id, self.squad_ai:GetSquad())
	end
end

function SlaaneshIntonerLucTactic:CanOnlyDecap()
	return true
end
