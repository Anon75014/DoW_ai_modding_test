----------------------------------------
-- File: 'ecloader.ai'
-- Edited by Thudmeizer @ 25.02.2025

class 'emperors_children_race'

-- Constructor
function emperors_children_race:__init()

end

-- Returns the name of the race
function emperors_children_race:GetRaceName()
	return "emperors_children_race"
end

-- This function is called if ec are the race being played
function emperors_children_race:LoadRace( eDifficulty )
	
	-- Import strategies
	import( 'Races/emperors_children_race/Strategies/EmperorsChildrenBuildBaseStrategy.ai' )
	
	-- Import strategy info
	import( "Races/emperors_children_race/Strategies/EmperorsChildrenStrategyInfo.ai" )
	
	-- Import tactics
	import( 'Races/emperors_children_race/Tactics/EmperorsChildrenInfantryTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/EmperorsChildrenVehicleTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshSlaveTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshCultistTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshGlawAgentsTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshNoiseMarineTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshWarpTalonTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshDaemonetteTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshFallenSisterTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshPossessedTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshTerminatorTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshApothecaryTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshIconBearerTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshNunSquadTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshTechmarineTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshCacophonyTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshMasqueTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshHospitallerTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshIntonerLucTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshIntonerMiriTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshHeraldTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshLordTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshLordTermiTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshSorcererTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshMoritatTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshLuciusTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshMiriaelTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/Slaanesh2BTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshDaemonPrinceTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshDoomriderTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshFulgrimTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshQuestorTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshKnightTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshKeeperOfSecretsTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshPrincessTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshRhinoTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshJetBikeTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshHellTalonTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshWhirlwindTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshImmolatorTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshLandRaiderTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshRapierTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshGeneratorTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshTempleTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshSacrificialCircleTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshFallenPristineSanctuaryTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshGreaterSacrificialCircleTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshHQTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshThunderhawkTactic.ai' )
	
	-- Last Stand + Kill-Team Game Modes
	import( 'Races/emperors_children_race/Tactics/SlaaneshCacophony_ktgmTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshPrincess_ktgmTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshMiriael_ktgmTactic.ai' )
	import( 'Races/emperors_children_race/Tactics/SlaaneshResearchKtgmTactic.ai' )

 	-- GAMBIT: New Method of returning a squad or base Tactic (from the CreateTactic function). Indexes.
	-- Here follows a Global List with all the squad names as indexes, and their Tactics as values
	-- The name of the Global List must be unique for each race.
    	EC_Race_Squad_Tactic =
    	{
        -- Insert here SQUAD_NAME or BASE_NAME and the TACTIC NAME (with the comma at the end!)
        -- If a squad must NOT have a Tactic attached to it AT ALL, use "NONE" (with quotes, case sensitive).
        -- Suggestion: Better put all in alphabetical order (sorted by squad names) for easier reference

        emperors_children_squad_slave = SlaaneshSlaveTactic,
	emperors_children_squad_cultist = SlaaneshCultistTactic,
	emperors_children_squad_cultist_cult_sp_dxp3_prisoner = SlaaneshCultistTactic,
	emperors_children_squad_glaw_agents = SlaaneshGlawAgentsTactic,
	emperors_children_squad_glaw_agents_advance_sp = SlaaneshGlawAgentsTactic,
	emperors_children_squad_noise_marine = SlaaneshNoiseMarineTactic,
	emperors_children_squad_havoc = SlaaneshNoiseMarineTactic,
	emperors_children_squad_havoc_sp_dxp3_prisoner = SlaaneshNoiseMarineTactic,
	emperors_children_squad_noise_marine_chosen = SlaaneshNoiseMarineTactic,
	emperors_children_squad_noise_marine_chosen_advance_sp = SlaaneshNoiseMarineTactic,
	emperors_children_squad_noise_primaris = SlaaneshNoiseMarineTactic,
	emperors_children_squad_cultist_cult = SlaaneshNoiseMarineTactic,
	emperors_children_squad_noise_palatine = SlaaneshNoiseMarineTactic,
	emperors_children_squad_warp_talon = SlaaneshWarpTalonTactic,
	emperors_children_squad_raptor = SlaaneshWarpTalonTactic,
	emperors_children_squad_raptor_advance_sp = SlaaneshWarpTalonTactic,
	emperors_children_squad_raptor_sp_dxp3_prisoner = SlaaneshWarpTalonTactic,
	emperors_children_squad_noise_primaris_suppressor = SlaaneshWarpTalonTactic,
	emperors_children_squad_daemonette = SlaaneshDaemonetteTactic,
	emperors_children_squad_daemonette_alpha = SlaaneshDaemonetteTactic,
	emperors_children_squad_daemonette_advance_sp = SlaaneshDaemonetteTactic,
	emperors_children_squad_hate_angel = SlaaneshDaemonetteTactic,
	emperors_children_squad_seeker = SlaaneshDaemonetteTactic,
	emperors_children_squad_fallen_sister = SlaaneshFallenSisterTactic,
	emperors_children_squad_fallen_retributor = SlaaneshFallenSisterTactic,
	emperors_children_squad_fallen_retributor_advance_sp = SlaaneshFallenSisterTactic,
	emperors_children_squad_fallen_seraphim = SlaaneshFallenSisterTactic,
	emperors_children_squad_possessed_marine = SlaaneshPossessedTactic,
	emperors_children_squad_obliterator = SlaaneshPossessedTactic,
	emperors_children_squad_noise_bezerker = SlaaneshPossessedTactic,
	emperors_children_squad_terminator = SlaaneshTerminatorTactic,
	emperors_children_squad_apothecary = SlaaneshApothecaryTactic,
	emperors_children_squad_icon_bearer =  SlaaneshIconBearerTactic,
	emperors_children_squad_flag_bearer =  SlaaneshIconBearerTactic,
	emperors_children_squad_nun = SlaaneshNunSquadTactic,
	emperors_children_squad_techmarine = SlaaneshTechmarineTactic,
	emperors_children_squad_warpsmith = SlaaneshTechmarineTactic,
	emperors_children_squad_kakophoni = SlaaneshCacophonyTactic,
	emperors_children_squad_masque = SlaaneshMasqueTactic,
	emperors_children_squad_masque_advance_sp = SlaaneshMasqueTactic,
	emperors_children_squad_fallen_hospitaller = SlaaneshHospitallerTactic, 
	emperors_children_squad_fallen_hospitaller_advance_sp = SlaaneshHospitallerTactic, 
	emperors_children_squad_intoner_lucius = SlaaneshIntonerLucTactic,
	emperors_children_squad_intoner_miriael = SlaaneshIntonerMiriTactic,
	emperors_children_squad_intoner_miriael_advance_sp = SlaaneshIntonerMiriTactic,
	emperors_children_squad_slaanesh_herald = SlaaneshHeraldTactic,
	emperors_children_squad_lord = SlaaneshLordTactic,
	emperors_children_squad_lord_advance_sp_wg = SlaaneshLordTactic,
	emperors_children_squad_lord_terminator = SlaaneshLordTermiTactic,
	emperors_children_squad_lord_terminator_wg = SlaaneshLordTermiTactic,
	emperors_children_squad_sorcerer = SlaaneshSorcererTactic,
	emperors_children_squad_priestress = SlaaneshSorcererTactic,
	emperors_children_squad_noise_moritat = SlaaneshMoritatTactic,
	emperors_children_squad_lucius = SlaaneshLuciusTactic,
	emperors_children_squad_miriel = SlaaneshMiriaelTactic,
	emperors_children_squad_miriel_advance_sp = SlaaneshMiriaelTactic,
	emperors_children_squad_2b = Slaanesh2BTactic,
	emperors_children_squad_2b_surv = Slaanesh2BTactic,
	emperors_children_squad_daemon_prince = SlaaneshDaemonPrinceTactic,
	emperors_children_squad_daemon_prince_wg = SlaaneshDaemonPrinceTactic,
	emperors_children_squad_doomrider = SlaaneshDoomriderTactic,
	emperors_children_squad_primarch_fulgrim = SlaaneshFulgrimTactic,
	emperors_children_squad_primarch_fulgrim_snake = SlaaneshFulgrimTactic,
	emperors_children_squad_questor = SlaaneshQuestorTactic,
	emperors_children_squad_subjugator = SlaaneshQuestorTactic,
	emperors_children_squad_knight = SlaaneshKnightTactic,
	emperors_children_squad_keeper_of_secrets = SlaaneshKeeperOfSecretsTactic,
	emperors_children_squad_princess_slaanesh = SlaaneshPrincessTactic,
	emperors_children_squad_princess_slaanesh_advance_sp = SlaaneshPrincessTactic,
	emperors_children_squad_rhino = SlaaneshRhinoTactic,
	emperors_children_squad_rhino_sp_dxp3 = SlaaneshRhinoTactic,
	emperors_children_squad_razorback = SlaaneshRhinoTactic,
	emperors_children_squad_hell_talon = SlaaneshHellTalonTactic,
	emperors_children_squad_whirlwind = SlaaneshWhirlwindTactic,
	emperors_children_squad_whirlwind_advance_sp = SlaaneshWhirlwindTactic,
	emperors_children_squad_immolator = SlaaneshImmolatorTactic,
	emperors_children_squad_predator = SlaaneshImmolatorTactic,
	emperors_children_squad_vindicator = SlaaneshImmolatorTactic,
	emperors_children_squad_jetbike_marine = SlaaneshJetBikeTactic,
	emperors_children_squad_jetbike_sister = SlaaneshJetBikeTactic,
	emperors_children_squad_land_raider = SlaaneshLandRaiderTactic,
	emperors_children_squad_land_gifter = SlaaneshLandRaiderTactic,
	emperors_children_squad_land_rapier = SlaaneshRapierTactic,
	emperors_children_squad_sonic_thunderhawk = SlaaneshThunderhawkTactic,
	emperors_children_squad_sonic_thunderhawk_entrenched = SlaaneshThunderhawkTactic,

	-- Last Stand + Kill-Team Game Modes
	emperors_children_squad_kakophoni_ktgm = SlaaneshCacophony_ktgmTactic,
	emperors_children_squad_princess_slaanesh_ktgm = SlaaneshPrincess_ktgmTactic,

	-- Last Stand + Kill-Team + Single Player Game Modes
	emperors_children_squad_miriel_ktgm = SlaaneshMiriael_ktgmTactic,
	}

    	EC_Race_Base_Tactic =
	{
        emperors_children_temple = SlaaneshTempleTactic,
        emperors_children_sacrificial_circle = SlaaneshSacrificialCircleTactic,
        emperors_children_fallen_pristine_sanctuary = SlaaneshFallenPristineSanctuaryTactic,
        emperors_children_greater_sacrificial_circle = SlaaneshGreaterSacrificialCircleTactic,
        emperors_children_hq = SlaaneshHQTactic,
        emperors_children_research_ktgm = SlaaneshResearchKtgmTactic,
	}
	return true
end

-- This function is called even if this is not the race being played
function emperors_children_race:LoadGlobalInfo()
		
	-- Import info files
	import( 'Races/emperors_children_race/Info/emperorschildrenunitstats.ai' )
	
	-- Add unit stats
	table.insert(UnitStats, EmperorsChildrenUnitStats)
	return true
end

-- Creates build base strategy
function emperors_children_race:CreateBuildBaseStrategy()
	return EmperorsChildrenBuildBaseStrategy(BuildBaseStrategyInfo)
end

-- Creates a special tactic for a marine units
-- GAMBIT: Updated version, with no IFs at all, much faster and reliable. CPU utilization nigh zero
function emperors_children_race:CreateTactic(oSquadAI)

    	-- Get unit name, and see if there is an attached tactic to it
    	local sUnitName = oSquadAI:GetSquadName()    
	if sUnitName ~= nil and EC_Race_Squad_Tactic[sUnitName] ~= nil then
		if EC_Race_Squad_Tactic[sUnitName] == "NONE" then
            		-- The squad must have NO tactic. Return nil.
            		return nil
        	else
            		return EC_Race_Squad_Tactic[sUnitName](oSquadAI)
        	end
    	end

	-- Get class
	local eClass = oSquadAI:GetStats():GetClass()

	-- Check if there is a special tactic for the unit available
	local bVehicle = (eClass == UnitStatsAI.UC_VehicleLow or eClass == UnitStatsAI.UC_VehicleMed or eClass == UnitStatsAI.UC_VehicleHigh)
	local bAirPlane = (eClass == UnitStatsAI.UC_AirLow or eClass == UnitStatsAI.UC_AirMed or eClass == UnitStatsAI.UC_AirHigh)

	if (bVehicle or bAirPlane) then
		return EmperorsChildrenVehicleTactic(oSquadAI)
	end
	return EmperorsChildrenInfantryTactic(oSquadAI)
end

-- Creates a special tactic for buildings
-- GAMBIT: Updated version, with no IFs at all, much faster and reliable. CPU utilization nigh zero
function emperors_children_race:CreateBaseTactic(oBuilding)

	-- Get building name
	local sBuildingName = oBuilding:GetBaseName()
	if sBuildingName ~= nil and EC_Race_Base_Tactic[sBuildingName] ~= nil then
		if EC_Race_Base_Tactic[sBuildingName] == "NONE" then
            		-- The building must have NO tactic. Return nil.
            		return nil
        	else
            		return EC_Race_Base_Tactic[sBuildingName](oBuilding)
        	end
    	end
	return nil
end

-- Returns a specific information
function emperors_children_race:GetInfo(sType)
	-- Check info type
	if (sType == "TurretPower") then
		return 400
	elseif (sType == "SupportAllyFactor") then
		return 8 / 4
	elseif (sType == "AttackModifier") then
		return 10
	elseif (sType == "CriticalRangeIncreasePerTier") then
		return 10
	elseif (sType == "MinArmyStrengthPerTier") then
		return 750
	elseif (sType == "AttackRatio") then
		return 4 / 5
	elseif (sType == "RetreatRatio") then
		return 3 / 5
	elseif (sType == "InvisibleBuildings") then
		return false
	elseif (sType == "HarassingLeader") then
		return "emperors_children_squad_lord"
	elseif (sType == "AutoConstructBuildings") then
		return false
	end
	return nil
end

-- Returns the building type and threat
function emperors_children_race:GetBuildingType(sBuildingName)

	-- Return race specific object string
	if (sBuildingName == "emperors_children_hq") then
		return "HQ", 0

	elseif (sBuildingName == "emperors_children_plasma_generator") then
		return "Generator", 0

	elseif (sBuildingName == "emperors_children_thermo_plasma_generator") then
		return "BiggerGenerator", 0

	elseif (sBuildingName == "emperors_children_machine_pit") then
		return "VehicleBuilding", 0

	elseif (sBuildingName == "emperors_children_armoury") then
		return "Armoury", 0

	elseif (sBuildingName == "emperors_children_listening_post") then
		return "ListeningPost", 0

	elseif (sBuildingName == "emperors_children_turret_bolter") then
		return "Turret", 300

	elseif (sBuildingName == "emperors_children_mine_field") then
		return "Mine", 100
	end
	return nil, 0
end
