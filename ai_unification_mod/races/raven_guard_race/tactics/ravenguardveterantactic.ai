----------------------------------------
-- File: 'RavenGuardVeterantactic.ai'
-- Edited by Thudmeizer @ 02.04.2023

class 'RavenGuardVeteranTactic' (RavenGuardSpaceMarineInfantryTactic)

RavenGuardVeteran = {}

function RavenGuardVeteranTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Raven Guard Veteran Tactic")
end

function RavenGuardVeteranTactic:DoAbilities()
	
	-- Call standard method
	RavenGuardSpaceMarineInfantryTactic.DoAbilities(self)
end

function RavenGuardVeteranTactic:Reinforce()

	-- Check if we are reinforcing
	if (not self.squad_ai:IsReinforcing()) then

		-- try for different types of squad members
		local sergeantIndex = 0
		local apothecaryIndex = 1

		local numSergeants = self.squad_ai:GetLeaderCount( sergeantIndex )	
		local numApothecaries = self.squad_ai:GetLeaderCount( apothecaryIndex )

		-- Desired number of each leader type
		local desiredSergeants = math.random(0,1) 
		local desiredApothecaries = math.random(0,1)

		-- Desired order of reinforcing
		if (numSergeants < desiredSergeants) then
			if (self.squad_ai:CanReinforce( true, sergeantIndex )) then
				self.squad_ai:DoReinforce( true, sergeantIndex )
			end
		elseif (numApothecaries < desiredApothecaries) then
			if (self.squad_ai:CanReinforce( true, apothecaryIndex )) then
				self.squad_ai:DoReinforce( true, apothecaryIndex )
			end
		else
			if (self.squad_ai:CanReinforce( false, 0 )) then
				self.squad_ai:DoReinforce( false, 0 )
			end			
		end
	end
end

function RavenGuardVeteranTactic:Upgrade()

	-- Check if I can upgrade
	if (self.squad_ai:IsReinforcing() or not self.squad_ai:HasUpgradableTrooper()) then
		return
	end

	-- If I am broken, don't upgrade!
	if (self:IsAffectedByMorale() and self.squad_ai:IsBroken()) then
		return
	end
	
	-- Only upgrade if not reinforcing
	if (not self.squad_ai:IsUnderAttack() and self.squad_ai:GetNumTroopers() >= 3) then
	
		-- Figure out my enemy's favourite class
		local oEnemy = cpu_manager:FindClosestEnemyPlayer()
		if (oEnemy ~= nil) then
			self.squad_ai:DoBestUpgrade(oEnemy:GetMajorityClassType())
		end
	end
end