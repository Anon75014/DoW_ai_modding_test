----------------------------------------
-- File: 'krieghellhoundtactic.ai'
-- Edited by Arkhan		@ 09.11.2006
-- Edited by Thudmeizer		@ 20.05.2022

class 'KriegHellhoundTactic' (KriegVehicleTactic)

KriegHellhound = {}

function KriegHellhoundTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Krieg Hellhound Firewolf Tactic")
end

function KriegHellhoundTactic:AutoBuildAddOn(addonSlot)
	for e in self.squad_ai:GetEntities() do
		local buildChannel = build_manager:GetBuildChannelFromID(e:GetID())
		if buildChannel ~= nil then
			local addOnID = buildChannel:GetItemIDAt(BuildChannelAI.PQ_AddOn, addonSlot)
			if (buildChannel:IsBuilding() == 0 and buildChannel:CanAddToQueue(BuildChannelAI.PQ_AddOn, addOnID) == BuildChannelAI.CANBUILD_Ok) then
				buildChannel:BuildAddOn(addOnID)
				return
			end
		end
	end
	return
end

function KriegHellhoundTactic:InitAbilities()

	-- Init ability ID's
	if KriegHellhound.burn_id == nil then
		KriegHellhound.burn_id = cpu_manager.stats:GetAbilityID( "krieg_let_it_burn" )
	end
end

function KriegHellhoundTactic:DoAbilities()

	-- Try to use 'Let it Burn' (Krieg Hellhound)
	if self.squad_ai:CanDoAbility(KriegHellhound.burn_id) then
		Ability.DoAbilityTarget(self.squad_ai, KriegHellhound.burn_id, Ability.Filters.CloseEnemy, 6)
	end

	-- Call standard method
	KriegVehicleTactic.DoAbilities(self)
end

function KriegHellhoundTactic:Upgrade()

	-- Figure out my enemy's favourite class
	local enemy = cpu_manager:FindClosestEnemyPlayer()
	if (enemy == nil) then
		return
	end
	
	local class_type = enemy:GetMajorityClassType()

	-- Larkins hard counter upgrade for infantry
	if (class_type == UnitStatsAI.UC_LightInfantryLow) or 
		(class_type == UnitStatsAI.UC_LightInfantryMed) or 
		(class_type == UnitStatsAI.UC_LightInfantryHigh) or
		(class_type == UnitStatsAI.UC_HeavyInfantryMed) or
		(class_type == UnitStatsAI.UC_MonsterMed) then 
			self:AutoBuildAddOn(0) -- Chemical Cannon

	-- Larkins hard counter upgrade for Vehicles
	elseif (class_type == UnitStatsAI.UC_HeavyInfantryHigh) or
		(class_type == UnitStatsAI.UC_VehicleLow) or 
		(class_type == UnitStatsAI.UC_VehicleMed) or
		(class_type == UnitStatsAI.UC_VehicleHigh) or
		(class_type == UnitStatsAI.UC_MonsterHigh) then
			self:AutoBuildAddOn(1) -- Melta Cannon
	end

	-- Force check upgradable hardpoint
	if (self.squad_ai:HasUpgradableTrooper()) then
		local class_type = cpu_manager:FindClosestEnemyPlayer():GetMajorityClassType()
		self.squad_ai:DoBestUpgrade( class_type )
	end
end
