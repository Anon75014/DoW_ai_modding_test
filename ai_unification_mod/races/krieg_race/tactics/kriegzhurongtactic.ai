----------------------------------------
-- File: 'kriegZhurongtactic.ai'
-- Edited by Thudmeizer		@ 24.04.2025

class 'KriegZhurongTactic' (KriegVehicleTactic)

KriegZhurong = {}

function KriegZhurongTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Krieg Zhurong Tactic")
end

function KriegZhurongTactic:AutoBuildAddOn(addonSlot)
	for e in self.squad_ai:GetEntities() do
		local buildChannel = build_manager:GetBuildChannelFromID(e:GetID())
		if buildChannel ~= nil then
			local addOnID = buildChannel:GetItemIDAt(BuildChannelAI.PQ_AddOn, addonSlot)
			if (buildChannel:IsBuilding() == 0 and buildChannel:CanAddToQueue(BuildChannelAI.PQ_AddOn, addOnID) == BuildChannelAI.CANBUILD_Ok) then
				buildChannel:BuildAddOn(addOnID)
				return
			end
		end
	end
	return
end

function KriegZhurongTactic:Upgrade()

	-- Figure out my enemy's favourite class
	local enemy = cpu_manager:FindClosestEnemyPlayer()
	if (enemy == nil) then
		return
	end
	
	-- Choose to build the Dual Autocannons, Speaker Tower, Rad Cannon, or Rail Cannon Addons
	local addon_tank_ranged_weapons = math.random( 0,3 )
	self:AutoBuildAddOn(addon_tank_ranged_weapons)

	-- Force check upgradable hardpoint
	if (self.squad_ai:HasUpgradableTrooper()) then
		local class_type = cpu_manager:FindClosestEnemyPlayer():GetMajorityClassType()
		self.squad_ai:DoBestUpgrade( class_type )
	end
end
