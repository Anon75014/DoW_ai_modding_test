----------------------------------------
-- File: 'kriegchimeratactic.ai'
-- Edited by Arkhan		@ 23.11.2007
-- Edited by Thudmeizer		@ 25.02.2023

class 'KriegChimeraTactic' (KriegVehicleTactic)

function KriegChimeraTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Krieg Chimera Tactic")

	-- Vehicle is a light transport
	self.m_iTransportVehicle = 1
	self.m_iTransportSlots = 2
end

function KriegChimeraTactic:AutoBuildAddOn( addonSlot )
	for e in self.squad_ai:GetEntities() do
		local buildChannel = build_manager:GetBuildChannelFromID(e:GetID())
		if buildChannel ~= nil then
			local addOnID = buildChannel:GetItemIDAt(BuildChannelAI.PQ_AddOn, addonSlot)
			if (buildChannel:IsBuilding() == 0 and buildChannel:CanAddToQueue(BuildChannelAI.PQ_AddOn, addOnID) == BuildChannelAI.CANBUILD_Ok) then
				buildChannel:BuildAddOn(addOnID)
				return
			end
		end
	end
	return
end

function KriegChimeraTactic:Upgrade()

	local majorclass_type = cpu_manager:FindClosestEnemyPlayer():GetMajorityClassType()
	self.squad_ai:DoBestUpgrade( majorclass_type )

	-- Figure out my enemy's favourite class
	local enemy = cpu_manager:FindClosestEnemyPlayer()
	if (enemy == nil) then
		return
	end
	
	local class_type = enemy:GetMajorityClassType()

	-- Larkins hard counter upgrade for infantry and light vehicles
	if (class_type == UnitStatsAI.UC_LightInfantryLow) or 
		(class_type == UnitStatsAI.UC_LightInfantryMed) or 
		(class_type == UnitStatsAI.UC_LightInfantryHigh) or
		(class_type == UnitStatsAI.UC_HeavyInfantryMed) or
		(class_type == UnitStatsAI.UC_MonsterMed) or
		(class_type == UnitStatsAI.UC_VehicleLow) then 
			self:AutoBuildAddOn(0) -- Autocannon
	end
end
