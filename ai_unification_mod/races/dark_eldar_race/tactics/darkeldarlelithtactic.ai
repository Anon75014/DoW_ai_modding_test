------------------------------------
-- File: 'darkeldarlelithtactic.ai'
-- Edited by Gambit @ 13.02.2022

class 'DarkEldarLelithTactic' (DarkEldarInfantryTactic)

DarkEldarLelith = {}

function DarkEldarLelithTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Dark Eldar Lelith Hesperax Tactic")
end


function DarkEldarLelithTactic:IsAttacker()
	return self:IsCommanderAttacker()
end


function DarkEldarLelithTactic:IsDefender()
	return self:IsCommanderDefender()
end


function DarkEldarLelithTactic:InitAbilities()

	-- Init ability ID's
	if DarkEldarLelith.combat_boost_id == nil then
		DarkEldarLelith.combat_boost_id = cpu_manager.stats:GetAbilityID( "dark_eldar_lelith_natural_perfection" )
	end
end


function DarkEldarLelithTactic:DoAbilities()

	if self.squad_ai:IsInCombat() then

		-- Perform Natural Perfection combat ability
		if self.squad_ai:CanDoAbility(DarkEldarLelith.combat_boost_id) then
			if not (self.squad_ai:IsCapturing() or self.squad_ai:IsBroken()) then
				self.squad_ai:DoSpecialAbility(DarkEldarLelith.combat_boost_id)
			end
		end
	end
end


function DarkEldarLelithTactic:Update()

    if self:IsComplete() then
        return
    end

    -- State machine
    if not InfantryTactic.Update(self) then
        return
    end

	-- Always set Melee Stance
	self.squad_ai:DoSetDefaultMeleeStance()
	self.squad_ai:DoSetMeleeStance(SquadAI.MSTANCE_Assault)

	-- Check if we are in serious trouble
	self:EmergencyRetreat()

	-- Try to attach
	if self:TryAttachSquad(true, true, 50, 150, nil) == nil then
		if (self:TryAttachSquad(false, true, 50, nil, self.m_fCommanderAttachHealth) == nil) then
			self:TryAttachSquadMelee()
		end
	end
end
