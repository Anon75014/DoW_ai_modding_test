----------------------------------------
-- File: 'nightlordskratostactic.ai'
-- Edited by Thudmeizer	@ 23.01.2023

class 'NightLordsKratosTactic' (NightLordsVehicleTactic)

NightLordsKratos = {}

function NightLordsKratosTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Night Lords Kratos Tactic")

	self.timedDirectSpawnAbility = Timer( NightLordsKratosTactic.DoDirectSpawnAbility, self, 5 )
end

function NightLordsKratosTactic:InitAbilities()

	-- Init ability ID's
	if (NightLordsKratos.machine_id == nil) then
		NightLordsKratos.machine_id = cpu_manager.stats:GetAbilityID( "night_lords_stealth_machine_spirit" )
	end

	if (NightLordsKratos.smoke_id == nil) then
		NightLordsKratos.smoke_id = cpu_manager.stats:GetAbilityID( "night_lords_smoke_launchers" )	
	end
end

function NightLordsKratosTactic:DoAbilities()

	-- Check if we can launch smoke
	if (self.squad_ai:CanDoAbility(NightLordsKratos.smoke_id)) then
	
		-- Search a squad
		local iRange = self.squad_ai:GetAbilityRange(NightLordsKratos.smoke_id)
		local oUnit = Ability.Filters.CloseHurt(self.squad_ai:GetPosition(), iRange, 1)
		if (oUnit ~= nil and oUnit:IsInCombat() and cpu_manager:GetUnitStrength(oUnit) > 150) then
			self.squad_ai:DoSpecialAbilitySquad(NightLordsKratos.smoke_id, oUnit:GetSquad())
		end
	end

	-- Check if I can use machine spirit while stationary
	if (self.squad_ai:WasRecentlyHurt() and not self.squad_ai:IsInStateMove() and not self.squad_ai:IsInStateAttackMove()) then
		
		if (self.squad_ai:CanDoAbility(NightLordsKratos.machine_id)) then
			self.squad_ai:DoSpecialAbility(NightLordsKratos.machine_id)
		end	  
	end

	-- Try to spawn the Cyclops
	if (self.timedDirectSpawnAbility ~= nil) then
		self.timedDirectSpawnAbility:Call()
	else
		NightLordsKratosTactic.DoDirectSpawnAbility(self)
	end
	
	-- Do basic abilities
	NightLordsVehicleTactic.DoAbilities(self)
end

function NightLordsKratosTactic:DoDirectSpawnAbility()

	-- Spawn Cyclops in combat
	if (self.squad_ai:CanDirectSpawn()) then 
		self.squad_ai:DoDirectSpawn()
	end
end
