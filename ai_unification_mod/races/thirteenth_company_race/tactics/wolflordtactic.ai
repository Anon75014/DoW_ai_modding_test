----------------------------------------
-- File: 'wolflordtactic.ai'
-- Edited by Thudmeizer @ 20.05.2022

class 'WolfLordTactic' (ThirteenthcomInfantryTactic)

WolfLord = {}

function WolfLordTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Wolf Lord Tactic")

	self.timedDirectSpawnAbility = Timer( WolfLordTactic.DoDirectSpawnAbility, self, 5 )
end

-- WolfLord is allowed to retreat even directly after a jump
function WolfLordTactic:SetTarget( target, variant_type )

	self.variant_type = variant_type
	self.target = Vector3f(target)
	self.m_iMoveDelay = 0
	self.last_jump = 0
end

-- Assassinate win condition -- never attack
function WolfLordTactic:IsAttacker()
	return (not cpu_manager.assassinate and self:IsCommanderAttacker())
end

-- Assassinate win condition -- never defend
function WolfLordTactic:IsDefender()
	return (not cpu_manager.assassinate and self:IsCommanderDefender())
end

-- Assassinate win condition -- never jump into combat
function WolfLordTactic:JumpAttack()

	if (not cpu_manager.assassinate) then
		Tactic.JumpAttack(self)
	end
end

-- Arkhan 03.2006: Inherited method used by commanders which are able to jump with an attached squad
function WolfLordTactic:CanJumpAttached()
	return true
end

function WolfLordTactic:InitAbilities()

--[[
	if WolfLord.wolfstorm_id == nil then
	   WolfLord.wolfstorm_id = cpu_manager.stats:GetAbilityID( "thirteenthcom_wolf_storm" )	
	end
]]

	if WolfLord.battlecry_id == nil then
	   WolfLord.battlecry_id = cpu_manager.stats:GetAbilityID( "thirteenthcom_battlecry" )	
	end
end

function WolfLordTactic:DoAbilities()


	-- Try to spawn honor guards
	if (self.timedDirectSpawnAbility ~= nil) then
		self.timedDirectSpawnAbility:Call()
	else
		WolfLordTactic.DoDirectSpawnAbility(self)
	end

	-- Try to use battlecry
	Ability.DoAbilityArea( self.squad_ai, WolfLord.battlecry_id, Ability.Filters.CloseInCombat, 10, 1 )

end

function WolfLordTactic:DoDirectSpawnAbility()

	-- Spawn honor guards in combat
	if (self.squad_ai:CanDirectSpawn()) then 
		self.squad_ai:DoDirectSpawn()
	end
end

function WolfLordTactic:Update()

	if (self:IsComplete()) then
		return
	end
	
	-- State machine
	if (not InfantryTactic.Update( self )) then
		return
	end

	-- Check if we are in serious trouble
	self:EmergencyRetreat()
		
	-- Assassinate win condition -- never attach to a squad
	if (not cpu_manager.assassinate) then
		
		-- Attach to melee in tier3+
		if (cpu_manager:GetTierLevel() > 2) then
		
			if (self:TryAttachSquad(true, true, 50, 100, nil) ~= nil) then
				return
			end
		end

		if (self:TryAttachSquad(false, true, 50, 100, self.m_fCommanderAttachHealth) == nil) then
			self:TryAttachSquadMelee()
		end
	end
end

