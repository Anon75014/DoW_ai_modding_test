----------------------------------------
-- File: 'medusatactic.ai'
-- Edited by Thudmeizer		@ 27.08.2025

class 'MedusaTactic' (GuardVehicleTactic)

Medusa = {}

function MedusaTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Medusa Tactic")
	self.lastAddonTry = g_iGMT
end

function MedusaTactic:InitAbilities()

	-- Init ability ID's
	if (Medusa.reload_id == nil) then
		Medusa.reload_id = cpu_manager.stats:GetAbilityID("guard_rapid_reload_medusa")
	end
end

function MedusaTactic:AutoBuildAddOn( addonSlot )
	for e in self.squad_ai:GetEntities() do
		local buildChannel = build_manager:GetBuildChannelFromID(e:GetID())
		if buildChannel ~= nil then
			local addOnID = buildChannel:GetItemIDAt(BuildChannelAI.PQ_AddOn, addonSlot)
			if (buildChannel:IsBuilding() == 0 and buildChannel:CanAddToQueue(BuildChannelAI.PQ_AddOn, addOnID) == BuildChannelAI.CANBUILD_Ok) then
				buildChannel:BuildAddOn(addOnID)
				return
			end
		end
	end
	return
end

function MedusaTactic:DoAbilities()

	-- Try to use 'Rapid Reload' if we have enough health and are in combat
	if self.squad_ai:IsInCombat() then

		if (self.squad_ai:WasRecentlyHurt() and self.squad_ai:GetHealthPercentage() > 0.4) then
			if (self.squad_ai:CanDoAbility( Medusa.reload_id )) then
				self.squad_ai:DoSpecialAbility( Medusa.reload_id )
			end
		end
	end
	
	-- Call standard method
	GuardVehicleTactic.DoAbilities(self)

	-- Check to build an addon every 10+ secs
	if g_iGMT > self.lastAddonTry + 10 then
		self.lastAddonTry = g_iGMT
		self:AutoBuildAddOn(0)
	end
end
