----------------------------------------
-- File: 'malevolenttactic.ai'
-- Edited by Thudmeizer @ 28.11.2024

class 'MalevolentTactic' (GuardInfantryTactic)

Malevolent = {}

function MalevolentTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Marines Malevolent Squad Tactic")
end

function MalevolentTactic:InitAbilities()

	-- Init ability ID's
	if (Malevolent.frag_id == nil) then
		Malevolent.frag_id = cpu_manager.stats:GetAbilityID( "guard_mm_frag_grenades" )	
	end

	if (Malevolent.barrage_id == nil) then
		Malevolent.barrage_id = cpu_manager.stats:GetAbilityID( "guard_mm_whirlwind_barrage_missile" )	
	end
	
	if (Malevolent.demoralize_id == nil) then
		Malevolent.demoralize_id = cpu_manager.stats:GetAbilityID( "guard_mm_demoralize" )	
	end
end

function MalevolentTactic:DoAbilities()

	-- Try to use abilities
	if self.squad_ai:IsInCombat() then
		if self.squad_ai:CanDoAbility(Malevolent.frag_id) then
			Ability.DoAbilityTarget( self.squad_ai, Malevolent.frag_id, Ability.Filters.CloseInfantryEnemy, 4 )
			Ability.DoAbilityTarget( self.squad_ai, Malevolent.frag_id, Ability.Filters.CloseMonsterEnemy, 2 )
			Ability.DoAbilityTarget( self.squad_ai, Malevolent.frag_id, Ability.Filters.CloseCommanderEnemy, 1 )
		end
	else
		if self.squad_ai:CanDoAbility(Malevolent.barrage_id) then

			-- If we are dying, lower requisites for attacks
			if (self.squad_ai:WasRecentlyHurt() and self.squad_ai:GetHealthPercentage() < 0.4) then
				Ability.DoAbilityPos( self.squad_ai, Malevolent.barrage_id, Ability.Filters.CloseInfantryEnemy, 4 )
			else
				Ability.DoAbilityPos( self.squad_ai, Malevolent.barrage_id, Ability.Filters.CloseInfantryEnemy, 8 )
			end
		end
	end

	if self.squad_ai:CanDoAbility(Malevolent.demoralize_id) then

		-- If we are dying, lower requisites for attacks
		if (self.squad_ai:WasRecentlyHurt() and self.squad_ai:GetHealthPercentage() < 0.4) then
			Ability.DoAbilityTarget( self.squad_ai, Malevolent.demoralize_id, Ability.Filters.CloseInfantryEnemy, 4 )
			Ability.DoAbilityTarget( self.squad_ai, Malevolent.demoralize_id, Ability.Filters.CloseMonsterEnemy, 1 )
			Ability.DoAbilityTarget( self.squad_ai, Malevolent.demoralize_id, Ability.Filters.CloseCommanderEnemy, 1 )
		else
			Ability.DoAbilityTarget( self.squad_ai, Malevolent.demoralize_id, Ability.Filters.CloseInfantryEnemy, 8 )
			Ability.DoAbilityTarget( self.squad_ai, Malevolent.demoralize_id, Ability.Filters.CloseMonsterEnemy, 2 )
			Ability.DoAbilityTarget( self.squad_ai, Malevolent.demoralize_id, Ability.Filters.CloseCommanderEnemy, 1 )
		end
	end
end
