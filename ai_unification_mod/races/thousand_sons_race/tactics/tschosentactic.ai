----------------------------------------
-- File: 'tschosentactic.ai'
-- Created by Thudmeizer @ 14.07.2011

class 'TSChosenTactic' (TSInfantryTactic)

TSChosen = {}

function TSChosenTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("TS Chosen Tactic")

	self.warpLightningLastUse = 0
	self.twistingPathLastUse = 0
	self.telekinesisLastUse = 0
	self.wardingRaptoraLastUse = 0
	self.abilitySumUse = 0
end

function TSChosenTactic:InitAbilities()
	if TSChosen.twisting_id == nil then
		TSChosen.twisting_id = cpu_manager.stats:GetAbilityID( "thousand_sons_twisting_path" )	
		TSChosen.lightning_id = cpu_manager.stats:GetAbilityID( "thousand_sons_warp_lightning" )	
		TSChosen.telekinesis_id = cpu_manager.stats:GetAbilityID( "thousand_sons_telekinesis" )	
		TSChosen.raptora_id = cpu_manager.stats:GetAbilityID( "thousand_sons_warding_raptora" )	
	end
end

function TSChosenTactic:DoAbilities()
	if self.squad_ai:CanDoAbility(TSChosen.raptora_id) then
		local iRange = self.squad_ai:GetAbilityRange(TSChosen.raptora_id)
		local oUnit = Ability.Filters.CloseHurt(self.squad_ai:GetPosition(), iRange, 1)
		if oUnit ~= nil and oUnit:IsUnderAttack() and oUnit:WasRecentlyHurt() and oUnit:GetNumTroopers() > 4 then
			self.squad_ai:DoSpecialAbilityPos(TSChosen.raptora_id, oUnit:GetSquad():GetPosition())
			self.wardingRaptoraLastUse = 2*g_iGMT/3
		end
	end
	if self.squad_ai:CanDoAbility(TSChosen.lightning_id) then
		if Ability.DoAbilityTarget(self.squad_ai, TSChosen.lightning_id, Ability.Filters.CloseSquadEnemy, 1)
		or Ability.DoAbilityTarget(self.squad_ai, TSChosen.lightning_id, Ability.Filters.CloseMonsterEnemy, 1) then
			self.warpLightningLastUse = 2*g_iGMT/3 
		end
	end
	if self.squad_ai:CanDoAbility(TSChosen.twisting_id) then
		if Ability.DoAbilityTarget(self.squad_ai, TSChosen.twisting_id, Ability.Filters.CloseSquadEnemy, 1)
		or Ability.DoAbilityTarget(self.squad_ai, TSChosen.twisting_id, Ability.Filters.CloseCommanderEnemy, 1) then
			self.twistingPathLastUse = 2*g_iGMT/3 
		end
	end
	if self.squad_ai:CanDoAbility(TSChosen.telekinesis_id) then
		if Ability.DoAbilityTarget(self.squad_ai, TSChosen.telekinesis_id, Ability.Filters.CloseSquadEnemy, 1)
		or Ability.DoAbilityTarget(self.squad_ai, TSChosen.telekinesis_id, Ability.Filters.CloseMonsterEnemy, 1) then
			self.telekinesisLastUse = 2*g_iGMT/3 
		end
	end


	self.abilitySumUse = self.warpLightningLastUse+self.twistingPathLastUse+self.telekinesisLastUse+self.wardingRaptoraLastUse

	TSInfantryTactic.DoAbilities(self)
end
