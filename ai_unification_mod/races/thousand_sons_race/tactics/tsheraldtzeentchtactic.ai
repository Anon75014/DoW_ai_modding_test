----------------------------------------
-- File: 'tsheraldtzeentchtactic.ai'
-- Edited by Gambit 22.04.2022

class 'TSHeraldTzeentchTactic' (TSInfantryTactic)

TzeentchHerald = {}

function TSHeraldTzeentchTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("TS Herald of Tzeentch Tactic")
end


function TSHeraldTzeentchTactic:InitAbilities()
	if TzeentchHerald.gift == nil then
		TzeentchHerald.gift = cpu_manager.stats:GetAbilityID( "thousand_sons_gift_of_tzeentch" )
		TzeentchHerald.power = cpu_manager.stats:GetAbilityID( "thousand_sons_power_of_change" )
	end
end


function TSHeraldTzeentchTactic:DoAbilities()
	if self.squad_ai:IsInCombat() then
		if self.squad_ai:CanDoAbility(TzeentchHerald.power) then
			local oSquad = Ability.Filters.CloseHurt(self.squad_ai:GetPosition(), 20, 1)
			if oSquad ~= nil and oSquad:IsInCombat() then
				self.squad_ai:DoSpecialAbility(TzeentchHerald.power)
				return
			end
		end
		if self.squad_ai:CanDoAbility(TzeentchHerald.gift) then
			Ability.DoAbilityTarget( self.squad_ai, TzeentchHerald.gift, Ability.Filters.CloseSquadEnemy, 2 )
		end
	end
	InfantryTactic.DoAbilities(self)
end

	
function TSHeraldTzeentchTactic:Update()

	if self:IsComplete() then
		return
	end

	-- State machine
	if not InfantryTactic.Update(self) then
		return
	end

	-- Attach to squad
	self:TryAttachSquad( false, false, 60, 100, nil )

	-- Check if we are in serious trouble
	self:EmergencyRetreat()
end
 