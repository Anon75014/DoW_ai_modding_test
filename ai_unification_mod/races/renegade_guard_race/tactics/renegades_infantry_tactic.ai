----------------------------------------
-- File: 'renegades_infantry_tactic.ai'
-- Edited by Thudmeizer		@ 05.11.2025

class 'Renegades_Infantry_Tactic' (InfantryTactic)

function Renegades_Infantry_Tactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Renegade Guard Infantry Tactic")
	
	-- Almost all Renegade Guard infantry are able to enter transport vehicles and occupy bunkers except for Mutant Rocketeers
	local sSquadName = squad_ai:GetSquadName()
	if (sSquadName ~= "renegade_guard_squad_tekarn_rocketeer") then
		self.m_iTransportable = 1	-- Chimeras / Testudo / Vendetta / Stormlord
		self.m_bBunkerSquad = true

	-- Samurai can enter transports and deepstrike buildings
	elseif (sName == "renegade_guard_squad_tekarn_samurai") then
		self.m_iTransportable = 1	-- Chimeras 
		self.m_bBunkerSquad = true
	end
end

function Renegades_Infantry_Tactic:AddTargetAbilities()
end

function Renegades_Infantry_Tactic:AddCommanders()
	table.insert(self.commander, { "renegade_guard_squad_master_of_the_horde", true })
	table.insert(self.commander, { "renegade_guard_squad_mutant_overlord", true })
	table.insert(self.commander, { "renegade_guard_squad_mutant_overlord_advance_sp", true })
	table.insert(self.commander, { "renegade_guard_squad_mutant_overlord_ktgm", true })
	table.insert(self.commander, { "renegade_guard_squad_arch_heretic", false })
	table.insert(self.commander, { "renegade_guard_squad_arch_heretic_advance_sp", false })
	table.insert(self.commander, { "renegade_guard_squad_tekarn_boba", false })	
	table.insert(self.commander, { "renegade_guard_squad_tekarn_colonel", false })
	table.insert(self.commander, { "renegade_guard_squad_tekarn_balalaika", false })
	table.insert(self.commander, { "renegade_guard_squad_tekarn_samurai", false })
	table.insert(self.commander, { "renegade_guard_squad_tekarn_reporter", false })
	table.insert(self.commander, { "renegade_guard_squad_tekarn_kaga", false })
	table.insert(self.commander, { "renegade_guard_squad_yae", false })
	table.insert(self.commander, { "renegade_guard_squad_yae_no_seegs", false })
	table.insert(self.commander, { "renegade_guard_squad_herrscher", false })
	table.insert(self.commander, { "renegade_guard_squad_herrscher_advance_sp", false })
	table.insert(self.commander, { "renegade_guard_squad_herrscher_ktgm", false })
	table.insert(self.commander, { "renegade_guard_squad_tengu", false })
	table.insert(self.commander, { "renegade_guard_squad_heretek_magos", false })
end

function Renegades_Infantry_Tactic:DoAbilities()

	-- I might have these attached
	if (self.squad_ai:IsAttached()) then
	
		if (self.squad_ai:HasSquadAttached("renegade_guard_squad_arch_heretic")) or (self.squad_ai:HasSquadAttached("renegade_guard_squad_arch_heretic_advance_sp")) then
			Renegades_Arch_Heretic_Tactic.InitAbilities( self )
			Renegades_Arch_Heretic_Tactic.DoAbilities( self )
		elseif (self.squad_ai:HasSquadAttached("renegade_guard_squad_mutant_overlord")) or (self.squad_ai:HasSquadAttached("renegade_guard_squad_mutant_overlord_advance_sp")) or (self.squad_ai:HasSquadAttached("renegade_guard_squad_mutant_overlord_ktgm")) then
			Renegades_Mutant_Overlord_Tactic.InitAbilities( self )
			Renegades_Mutant_Overlord_Tactic.DoAbilities( self )
		elseif (self.squad_ai:HasSquadAttached("renegade_guard_squad_yae")) or (self.squad_ai:HasSquadAttached("renegade_guard_squad_yae_no_seegs")) then
			Renegades_Yae_Tactic.InitAbilities( self )
			Renegades_Yae_Tactic.DoAbilities( self )
		elseif (self.squad_ai:HasSquadAttached("renegade_guard_squad_psyker_coven")) or (self.squad_ai:HasSquadAttached("renegade_guard_squad_psyker_coven_nolimit")) then
			Renegades_Rogue_Psyker_Tactic.InitAbilities( self )
			Renegades_Rogue_Psyker_Tactic.DoAbilities( self )
		elseif (self.squad_ai:HasSquadAttached("renegade_guard_squad_tengu")) then
			Renegades_Tengu_Tactic.InitAbilities( self )
			Renegades_Tengu_Tactic.DoAbilities( self )
		elseif (self.squad_ai:HasSquadAttached("renegade_guard_squad_tekarn_kaga")) then
			Renegades_Kaga_Tactic.InitAbilities( self )
			Renegades_Kaga_Tactic.DoAbilities( self )
		elseif (self.squad_ai:HasSquadAttached("renegade_guard_squad_tekarn_balalaika")) then
			Renegades_Balalaika_Tactic.InitAbilities( self )
			Renegades_Balalaika_Tactic.DoAbilities( self )
		elseif (self.squad_ai:HasSquadAttached("renegade_guard_squad_herrscher")) or (self.squad_ai:HasSquadAttached("renegade_guard_squad_herrscher_advance_sp")) or (self.squad_ai:HasSquadAttached("renegade_guard_squad_herrscher_ktgm")) then
			Renegades_Herrscher_Tactic.InitAbilities( self )
			Renegades_Herrscher_Tactic.DoAbilities( self )
		elseif (self.squad_ai:HasSquadAttached("renegade_guard_squad_medic")) then
			Renegades_Medic_Tactic.InitAbilities( self )
			Renegades_Medic_Tactic.DoAbilities( self )
		elseif (self.squad_ai:HasSquadAttached("renegade_guard_squad_tekarn_reporter")) then
			Renegades_Reporter_Tactic.InitAbilities( self )
			Renegades_Reporter_Tactic.DoAbilities( self )
		end
	end
	
	-- Call basic DoAbilities methods
	InfantryTactic.DoAbilities(self)
end

function Renegades_Infantry_Tactic:CheckForDetach()

	-- Detach commander from broken/capturing. guards stay attached
	if ((self.squad_ai:IsBroken() or self.squad_ai:IsCapturing()) and
		(self.squad_ai:IsInCombat() or self.squad_ai:WasRecentlyHurt()) and
		not self.squad_ai:HasSquadAttached( "renegade_guard_squad_medic" )) then 
		self.squad_ai:DoDetachSquad()
		self.squad_ai:DoSetDefaultMeleeStance()
	end

	-- Call basic detach method
	InfantryTactic.CheckForDetach(self)
end
