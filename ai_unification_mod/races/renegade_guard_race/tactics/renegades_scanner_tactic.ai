----------------------------------------
-- File: 'RenegadeGuardScannertactic.ai'
-- Edited by Thudmeizer	@ 19.09.2024

class 'Renegades_Scanner_Tactic' (BaseTactic)

RenegadeGuardScanner = {}

function Renegades_Scanner_Tactic:__init( base_ai ) super( base_ai )

	self:SetName("Renegade Guard Scanner Tactic")
end

function Renegades_Scanner_Tactic:InitAbilities()

	-- Init ability ID's
	if (RenegadeGuardScanner.firestorm_id == nil) then
		RenegadeGuardScanner.firestorm_id = cpu_manager.stats:GetAbilityID("renegade_guard_firestorm")
	end
end

function Renegades_Scanner_Tactic:DoAbilities()

	-- Try to activate the protective firestorm barrier
	if (self.base_ai:CanDoAbility(RenegadeGuardScanner.firestorm_id)) then

		-- Check available resources before enabling firestorm
		local iReq = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Requisition )
		local iPow = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Power )
		if iReq > 250 and iPow > 250 then

			local range = self.base_ai:GetAbilityRange(RenegadeGuardScanner.firestorm_id)	
			local squad_filter = function( squad_ai )		
				return squad_ai:IsInCombat() and squad_ai:IsInStateAttackMove() and 
						squad_ai:GetNumTroopers() >= 4 and not squad_ai:IsBroken() and
						not squad_ai:IsCapturing()
			end	

   			local target_squad = cpu_manager:GetClosestSquad( self.base_ai:GetPosition(), 40, squad_filter )
			if (target_squad ~= nil) then
				self.base_ai:DoSpecialAbility(RenegadeGuardScanner.firestorm_id)
 			end
		end
	end
end