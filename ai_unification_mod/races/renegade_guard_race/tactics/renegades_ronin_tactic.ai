----------------------------------------
-- File: 'renegades_ronin_tactic.ai'
-- Edited by Thudmeizer @ 19.06.2023

class 'Renegades_Ronin_Tactic' (Renegades_Infantry_Tactic)

Ronin = {}

function Renegades_Ronin_Tactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Renegades Ronin Tactic")

	-- Squad is able to occupy bunkers
	self.m_bBunkerSquad = true
end

function Renegades_Ronin_Tactic:IsAttacker()
	return self:IsCommanderAttacker()
end

function Renegades_Ronin_Tactic:IsDefender()
	return self:IsCommanderDefender()
end

function Renegades_Ronin_Tactic:InitAbilities()

	-- Init ability ID's
	if (Ronin.smoke_id == nil) then
		Ronin.smoke_id = cpu_manager.stats:GetAbilityID( "renegade_guard_ninja_smoke" )
	end

	if (Ronin.aura_id == nil) then
		Ronin.aura_id = cpu_manager.stats:GetAbilityID( "renegade_guard_ninja_aura_dummy" )
	end

	if (Ronin.healing_id == nil) then
		Ronin.healing_id = cpu_manager.stats:GetAbilityID( "renegade_guard_ninja_healing_gourd" )
	end
end

function Renegades_Ronin_Tactic:DoAbilities()

	if self.squad_ai:IsInCombat() then
		-- Try to use Smoke
		if self.squad_ai:CanDoAbility(Ronin.smoke_id) then
			if Ability.DoAbilityArea(self.squad_ai, Ronin.smoke_id, Ability.Filters.CloseEnemy, 10, 1) then
				return
			end
		end

		-- Check if we can initiate The Shadows Die Twice against our struggling fighters
		if (self.squad_ai:CanDoAbility(Ronin.aura_id)) then

			if (self.squad_ai:WasRecentlyHurt() and self.squad_ai:GetHealthPercentage() < 0.3) then
	
				-- Search a squad
				local iRange = self.squad_ai:GetAbilityRange(Ronin.aura_id)
				local oUnit = Ability.Filters.CloseHurt(self.squad_ai:GetPosition(), iRange, 1)
				if (oUnit ~= nil and oUnit:IsInCombat() and cpu_manager:GetUnitStrength(oUnit) > 150) then
					self.squad_ai:DoSpecialAbilitySquad(Ronin.aura_id, oUnit:GetSquad())
				end
			end
		end
	end

	-- Activate Healing Tome if low on health
	if (self.squad_ai:WasRecentlyHurt() and self.squad_ai:GetHealthPercentage() < 0.5) then
		if self.squad_ai:CanDoAbility(Ronin.healing_id) then
			self.squad_ai:DoSpecialAbility(Ronin.healing_id)
		end
	end
end

