----------------------------------------
-- File: 'templargrimaldustactic.ai'
-- Edited by Gambit/Thudmeizer @ 27.02.2023

class 'TemplarGrimaldusTactic' (TemplarInfantryTactic)

function TemplarGrimaldusTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Chaplain Grimaldus Tactic")
	
	-- Randomize desired number of each servitor type
	local type = math.random(1,3)
	if type == 1 then
		-- Mixed
		self.G_desiredBoltr = 1; self.G_desiredMelta = 1; self.G_desiredMelee = 1
	elseif type == 2 then
		-- Melee
		self.G_desiredBoltr = 0; self.G_desiredMelta = 0; self.G_desiredMelee = 3
	else
		-- Ranged
		self.G_desiredBoltr = 2; self.G_desiredMelta = 1; self.G_desiredMelee = 0
	end
end

function TemplarGrimaldusTactic:InitAbilities()
end


function TemplarGrimaldusTactic:DoAbilities()
end

function TemplarGrimaldusTactic:Reinforce()

	-- Allow free reinforcing during harassing time
	if (g_iGMT > DefendChokePointPlan.HarassingTime * 60) then

		-- If there are no resources available, don't upgrade!
		if (not Tactic.Options.can_reinforce) then
			return
		end
	end

	if (not self.squad_ai:IsReinforcing()) then

		-- Always try for the actual leader first
		if (self.squad_ai:CanReinforce( false, 0 )) then
			self.squad_ai:DoReinforce( false, 0 )
			return
		end

		-- Try for different types of squad members
		local servitorBoltrIndex = 0
		local servitorMeltaIndex = 1
		local servitorMeleeIndex = 2
	
		-- Get current leader count
		local numBoltr = self.squad_ai:GetLeaderCount( servitorBoltrIndex )
		local numMelta = self.squad_ai:GetLeaderCount( servitorMeltaIndex)
		local numMelee = self.squad_ai:GetLeaderCount( servitorMeleeIndex )
	
		if (numMelta < self.G_desiredMelta) then
			if self.squad_ai:CanReinforce( true, servitorMeltaIndex ) then
				self.squad_ai:DoReinforce( true, servitorMeltaIndex )
			end
		elseif (numMelee < self.G_desiredMelee) then
			if self.squad_ai:CanReinforce( true, servitorMeleeIndex ) then
				self.squad_ai:DoReinforce( true, servitorMeleeIndex )
			end

		elseif (numBoltr < self.G_desiredBoltr) then
			if self.squad_ai:CanReinforce( true, servitorBoltrIndex ) then
				self.squad_ai:DoReinforce( true, servitorBoltrIndex )
			end
		end
	end
end

