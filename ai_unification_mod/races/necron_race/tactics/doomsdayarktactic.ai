----------------------------------------
-- File: 'doomsdayarktactic.ai'
-- Edited by Gambit @ 26.09.2023

class 'DoomsDayArkTactic' (NecronVehicleTactic)

DoomsDayArk = {}

function DoomsDayArkTactic:__init( squad_ai ) super( squad_ai )
	
	self:SetName("Dooms Day Ark Tactic")
end


function DoomsDayArkTactic:InitAbilities()

	if DoomsDayArk.high_power_id == nil then
		DoomsDayArk.high_power_id = cpu_manager.stats:GetAbilityID( "necron_high_power_doomsday_ark" )
	end
end


function DoomsDayArkTactic:DoAbilities()

	if self.squad_ai:IsInCombat() and self.squad_ai:CanDoAbility(DoomsDayArk.high_power_id) then
		if self.squad_ai:IsAttacking() and self.squad_ai:GetHealthPercentage() > 0.45 then
			-- We do not want it enabled, if enemies are REALLY close
			if not cpu_manager.terrain_analyzer:HasThreat(self.squad_ai:GetPosition(), 14) then
				self.squad_ai:DoStop()
				self.squad_ai:DoSpecialAbility(DoomsDayArk.high_power_id)
			end
		end
	end

	-- New code to unstuck units with pathing issues, that can jump.
	-- Call it with [true], only for multi-membered squads.
	self:SolveStuckCase(false)
end
