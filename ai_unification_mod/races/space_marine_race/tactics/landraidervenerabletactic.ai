----------------------------------------
-- File: 'landraidervenerabletactic.ai'
-- Edited by Thudmeizer         @ 13.03.2025

class 'LandRaiderVenerableTactic' (SpaceMarineVehicleTactic)

LandRaiderVenerable = {}

function LandRaiderVenerableTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Land Raider Venerable Tactic")
	
	-- Vehicle is a heavy transport
	self.m_iTransportVehicle = 2
	self.m_iTransportSlots = 2
end

function LandRaiderVenerableTactic:InitAbilities()

	-- Init ability ID's
	if (LandRaiderVenerable.spirit_id == nil) then
		LandRaiderVenerable.spirit_id = cpu_manager.stats:GetAbilityID( "marines_machine_spirit" )
	end

	if (LandRaiderVenerable.smoke_id == nil) then
		LandRaiderVenerable.smoke_id = cpu_manager.stats:GetAbilityID( "marines_smoke_launchers" )
	end

	if (LandRaiderVenerable.missile_id == nil) then
		LandRaiderVenerable.missile_id = cpu_manager.stats:GetAbilityID( "marines_hk_phobos" )
	end
end

function LandRaiderVenerableTactic:DoAbilities()

	-- Check if I can use machine spirit while stationary
	if (self.squad_ai:WasRecentlyHurt() and not self.squad_ai:IsInStateMove() and not self.squad_ai:IsInStateAttackMove()) then
		
		if (self.squad_ai:CanDoAbility(LandRaiderVenerable.spirit_id)) then
			self.squad_ai:DoSpecialAbility(LandRaiderVenerable.spirit_id)
		end	  
	end

	-- Check if we can launch smoke
	if (self.squad_ai:CanDoAbility(LandRaiderVenerable.smoke_id)) then
	
		-- Search a squad
		local iRange = self.squad_ai:GetAbilityRange(LandRaiderVenerable.smoke_id)
		local oUnit = Ability.Filters.CloseHurt(self.squad_ai:GetPosition(), iRange, 1)
		if (oUnit ~= nil and oUnit:IsInCombat() and cpu_manager:GetUnitStrength(oUnit) > 150) then
			self.squad_ai:DoSpecialAbilitySquad(LandRaiderVenerable.smoke_id, oUnit:GetSquad())
		end
	end

	local hkChance = math.random(1,100)

	-- Check if we are attacking and not in home base
	if (self.squad_ai:IsAttacking() and self.squad_ai:CanDoAbility(LandRaiderVenerable.missile_id)) then
		if ( (cpu_manager.terrain_analyzer:HasThreat( self.squad_ai:GetPosition(), 35 ) and hkChance > 25)
		or (cpu_manager.terrain_analyzer:HasThreat( self.squad_ai:GetPosition(), 55 ) and hkChance > 75) ) then
		
		-- Launch HK Missiles at either Vehicles or Buildings
		Ability.DoAbilityTarget(self.squad_ai, LandRaiderVenerable.missile_id, Ability.Filters.CloseVehicleEnemy, 1)
    		Ability.DoAbilityTargetEntity( self.squad_ai, LandRaiderVenerable.missile_id, Ability.EntityFilters.CloseBaseEntityEnemy, 2)
		end
	end
	
	-- Do basic abilities
	SpaceMarineVehicleTactic.DoAbilities(self)
end