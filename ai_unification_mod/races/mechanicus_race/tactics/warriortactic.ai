----------------------------------------
-- File: 'WarriorTactic.ai'
-- Created by Warboss-rus	@ 13.12.2010
-- Edited by fuggles 		@ 07/01/2014
-- Edited by Thudmeizer		@ 01/12/2015

class 'WarriorTactic' (MechVehicleTactic)

AdMechWarrior = {}

function WarriorTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Warrior Tactic")
end


function WarriorTactic:InitAbilities()
	if (AdMechWarrior.iRestoreID == nil) then
		AdMechWarrior.iRestoreID = cpu_manager.stats:GetAbilityID( "mechanicus_reload_warrior" )
		AdMechWarrior.iRestore2ID = cpu_manager.stats:GetAbilityID( "mechanicus_reload_nomorale" )
	end
end


function WarriorTactic:DoAbilities()
	if (self.squad_ai:CanDoAbility(AdMechWarrior.iRestoreID) and self.squad_ai:IsBroken()) then
		self.squad_ai:DoSpecialAbility(AdMechWarrior.iRestoreID)
	end

	if (self.squad_ai:CanDoAbility(AdMechWarrior.iRestore2ID) and self.squad_ai:IsInCombat()) then
		if (self.squad_ai:GetHealthPercentage() < 0.4 or self.squad_ai:WasRecentlyHurt()) then
			self.squad_ai:DoSpecialAbility(AdMechWarrior.iRestore2ID)
		end
	end
end

function WarriorTactic:CanOnlyDecap()
	return true
end

function WarriorTactic:GoToNextPost()

	-- Try to reach a save position if HQ is attacked
	self.m_bBusy = false
	local vEngineerPos = self.squad_ai:GetPosition()
	local vBasePos = cpu_manager:FindClosestFriendlyBaseOrStrategicPoint(vEngineerPos, cpu_manager.start_pos, true, true)
	if (vBasePos ~= nil) then
		self:ValidMove(vBasePos)
		self.m_iValidRange = 35
		return
	end

	-- Return to home base
	if (distance_sqr(cpu_manager.start_pos, vEngineerPos) > sqr(35)) then
		aitrace("WarriorTactic: Return to home base")
		self:ValidMove(cpu_manager.start_pos)
		return
	end
end
