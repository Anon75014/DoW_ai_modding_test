----------------------------------------
-- File: 'PraetorianTactic.ai'
-- Edited by Thudmeizer @ 26.10.2008


class 'PraetorianTactic' (MechInfantryTactic)

AdMechPraetorian = {}

function PraetorianTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Praetorian Tactic")
	
	Praetorian_Restore_TMR = g_iGMT
	self.praetorianCompositionType = math.random(1, 4)
end


function PraetorianTactic:InitAbilities()
	if (AdMechPraetorian.iRestoreID == nil) then
		AdMechPraetorian.iRestoreID = cpu_manager.stats:GetAbilityID( "mechanicus_reload_praetorian" )
	end
end


function PraetorianTactic:DoAbilities()

	if self.squad_ai:IsBroken() then
		if (self.squad_ai:CanDoAbility(AdMechPraetorian.iRestoreID)) then -- and g_iGMT > Praetorian_Restore_TMR + 220) then
			self.squad_ai:DoSpecialAbility(AdMechPraetorian.iRestoreID)
			Praetorian_Restore_TMR = g_iGMT
		end
	end

	MechInfantryTactic.DoAbilities( self )
end



function PraetorianTactic:Reinforce()

	-- Allow free reinforcing during harassing time
	if (g_iGMT > DefendChokePointPlan.HarassingTime * 60) then

		-- If there are no ressources available, don't upgrade!
		if (not Tactic.Options.can_reinforce) then
			return
		end
	end

	if (not self.squad_ai:IsReinforcing()) then

		-- Always try for the actual leader first
		if (self.squad_ai:CanReinforce( false, 0 )) then
			self.squad_ai:DoReinforce( false, 0 )
			return
		end

		-- Try for different types of squad members
		local meleeIndex = 0
		local rangeIndex = 1
		local shieldIndex = 2
		local sniperIndex = 3
	
		-- Get current leader count
		local nummelee = self.squad_ai:GetLeaderCount( meleeIndex )
		local numrange = self.squad_ai:GetLeaderCount( rangeIndex)
		local numshield = self.squad_ai:GetLeaderCount( shieldIndex )
		local numsniper = self.squad_ai:GetLeaderCount( sniperIndex )

		-- Desired number of each leader type, normal mixed composition (50% chance)
		local desiredmelee = 1
		local desiredrange = 2
		local desiredshield = 2
		local desiredsniper = 1
		
		if self.praetorianCompositionType == 1 then
		-- Desired number of each leader type, melee composition (25% chance)
			desiredmelee = 3
			desiredrange = 0
			desiredshield = 3
			desiredsniper = 0
		elseif self.praetorianCompositionType == 2 then
			-- Desired number of each leader type, ranged composition (25% chance)
			desiredmelee = 0
			desiredrange = 3
			desiredshield = 0
			desiredsniper = 3
		end

		-- Desired order of reinforcing
		if (numshield < desiredshield) then
			if self.squad_ai:CanReinforce( true, shieldIndex ) then
				self.squad_ai:DoReinforce( true, shieldIndex )
			end
		elseif (numrange < desiredrange) then
			if self.squad_ai:CanReinforce( true, rangeIndex ) then
				self.squad_ai:DoReinforce( true, rangeIndex )
			end
		elseif (numsniper < desiredsniper) then
			if self.squad_ai:CanReinforce( true, sniperIndex ) then
				self.squad_ai:DoReinforce( true, sniperIndex )
			end
		elseif (nummelee < desiredmelee) then
			if self.squad_ai:CanReinforce( true, meleeIndex ) then
				self.squad_ai:DoReinforce( true, meleeIndex )
			end
		end
	end
end

