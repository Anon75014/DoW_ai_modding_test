----------------------------------------
-- File: 'tankhuntertactic.ai'
-- Edited by Thudmeizer        @ 17.03.2018

class 'TankHunterTactic' (ImperialFistsInfantryTactic)

TankHunter = {}

function TankHunterTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Imperial Fists Tank Hunter Tactic")
end

function TankHunterTactic:InitAbilities()

	-- Init ability ID's
	if (TankHunter.tankhunter_id == nil) then
		TankHunter.tankhunter_id = cpu_manager.stats:GetAbilityID( "imperial_fists_tank_hunters" )    
	end
end

function TankHunterTactic:DoAbilities()

	if (self.squad_ai:IsAttacking() and self.squad_ai:CanDoAbility( TankHunter.tankhunter_id )) then
		local iPower = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Power )
		if iPower > 150 then
			local iPos = self.squad_ai:GetPosition()
			-- Search a vehicle or building but only when attacking
			local oVehicle = Ability.Filters.CloseVehicleEnemy(iPos, 45, 1)
			if oVehicle ~= nil then
				-- Enable Tank Hunters in radius against vehicles!
				self.squad_ai:DoSpecialAbility(TankHunter.tankhunter_id)
			else
				local oBuilding = Ability.EntityFilters.CloseBaseEntityEnemy(iPos, 45, 1)
				if (oBuilding ~= nil) then
					-- Enable Tank Hunters in radius against buildings!
					self.squad_ai:DoSpecialAbilityEntity(TankHunter.tankhunter_id, oBuilding)
				end
			end
		end
	end

	-- Call standard method
	ImperialFistsInfantryTactic.DoAbilities(self)
end

function TankHunterTactic:Upgrade()

	-- If there are no resources available, don't upgrade!
	if (not Tactic.Options.can_reinforce) then
		return
	end
  
	local class_type = cpu_manager:FindClosestEnemyPlayer():GetMajorityClassType()
	self.squad_ai:DoBestUpgrade( class_type )
end
