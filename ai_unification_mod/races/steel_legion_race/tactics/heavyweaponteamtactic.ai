----------------------------------------
-- File: 'heavyweaponteamtactic.ai'
-- Edited by Thudmeizer   @ 31.05.2024

class 'HeavyWeaponTeamTactic' (SteelLegionInfantryTactic)

function HeavyWeaponTeamTactic:__init( squad_ai ) super( squad_ai )

	   self:SetName("Heavy Weapon Team Tactic")
end

function HeavyWeaponTeamTactic:Update()

	--state machine
   	if not InfantryTactic.Update( self ) then
	  	return
  	 end
   
   	-- If I'm in ranged combat
   	local squad_pos = self.squad_ai:GetPosition()
   	if self.squad_ai:IsInCombat() and Ability.Filters.CloseEnemy( squad_pos, 15, 1 ) == nil and not self:IsInSubState() then

		local attachable_filter = function( squad_ai )

		return self.squad_ai:CanAttachTo( squad_ai ) and squad_ai:IsRanged() and 
				not squad_ai:IsBroken() and not squad_ai:IsCapturing() and
				not self:IsInSubState() 
		end
	   
	  	-- Find close by squads
	  	local attach_to = cpu_manager:GetClosestSquad( squad_pos, 20, attachable_filter )
	  	if attach_to ~= nil then
			self:DoMoveAttach( attach_to ) 

		end	  
	end
end

