----------------------------------------
-- File: 'LootaTactic.ai'
-- Edited by Thudmeizer   @ 26.10.2006

class 'LootaTactic' (OrkInfantryTactic)

Lootas = {}

function LootaTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Lootas Tactic")
end


function LootaTactic:InitAbilities()
	-- Init ability ID's
	if Lootas.mekaniak_id == nil then
		Lootas.mekaniak_id = cpu_manager.stats:GetAbilityID( "ork_spanner_mekaniak" )
	end
end


function LootaTactic:DoAbilities()
	if not (self.squad_ai:IsInCombat() or self.squad_ai:WasRecentlyHurt()) then
		if self.squad_ai:CanDoAbility(Lootas.mekaniak_id) then
			local oVehicleToRepair = self:GetDamagedVehicleWithin(16)
			if oVehicleToRepair ~= nil then
				self.squad_ai:DoSpecialAbilitySquad(Lootas.mekaniak_id, oVehicleToRepair:GetSquad())
			end
		end
	end
end


-- Called directly to find an ally repairable and damaged squad within range.
function LootaTactic:GetDamagedVehicleWithin(iRange)
local iSquadPosition = self.squad_ai:GetPosition()
for oPlayer in cpu_manager.stats:GetPlayerStats() do
	if not oPlayer:IsPlayerDead() then
		if not cpu_manager.player_stats:IsEnemy(oPlayer) then
			for oSquad in oPlayer:GetSquads() do
				if oSquad:IsValid() then
					if oSquad:CanBeRepaired() and oSquad:GetHealthPercentage() < 1.0 then
						if distance_sqr(oSquad:GetPosition(),iSquadPosition) < iRange*iRange then 
							return oSquad
						end
					end
				end
			end
		end
	end
end
return nil
end