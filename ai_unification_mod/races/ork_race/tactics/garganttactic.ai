----------------------------------------
-- File: 'garganttactic.ai'
-- Edited by Gambit		@ 18.00.2020
-- Edited by Thudmeizer		@ 22.09.2023

class 'GargantTactic' (OrkVehicleTactic)

Gargant = {}

function GargantTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Gargant Titan Tactic")

	self:InitAbilities()
	self.lastused_ability_mines = g_iGMT
	self.lastused_ability_mines_position = self.squad_ai:GetPosition()

	-- Vehicle is a medium transport
	self.m_iTransportVehicle = 1
	self.m_iTransportSlots = 3
end

function GargantTactic:InitAbilities()

	-- Init ability ID's
	if Gargant.mines_id == nil then
		Gargant.mines_id = cpu_manager.stats:GetAbilityID( "ork_gargant_laymines" )
		Gargant.charge_id = cpu_manager.stats:GetAbilityID( "ork_gargant_super_chargy" )
		Gargant.push_id = cpu_manager.stats:GetAbilityID( "ork_gargant_charge" )
	end
end

function GargantTactic:DoAbilities()

	-- Lay mines anywhere
	if self.squad_ai:CanDoAbility(Gargant.mines_id) then
		local current_time = g_iGMT
		local current_pos = self.squad_ai:GetPosition()
		local current_pow = resource_manager:GetResourceAmount():Get(ResourceAmount.RT_Power)
		local last_time = self.lastused_ability_mines
		local last_pos = self.lastused_ability_mines_position
		-- Check situation
		if current_pow > 200 and ((current_time - last_time > 40) or distance(current_pos,last_pos) > 18) then
			-- Use Lay Mines ability
			self.squad_ai:DoSpecialAbility(Gargant.mines_id)
			self.lastused_ability_mines = current_time
			self.lastused_ability_mines_position = current_pos
		end
	end

	if self.squad_ai:IsInCombat() then
		if self.squad_ai:CanDoAbility(Gargant.charge_id) and self.squad_ai:WasRecentlyHurt()
		and resource_manager:GetResourceAmount():Get(ResourceAmount.RT_Power) > 500 then
			self.squad_ai:DoSpecialAbility(Gargant.charge_id)
		end

		if self.squad_ai:CanDoAbility(Gargant.push_id) and self.squad_ai:IsInStateMove() then
			if Ability.DoAbilityArea(self.squad_ai, Gargant.push_id, Ability.Filters.CloseSquadEnemy, 10, 4)
			or Ability.DoAbilityArea(self.squad_ai, Gargant.push_id, Ability.Filters.CloseMonsterEnemy, 10, 4) then
				return
			end
		end
	end
end
