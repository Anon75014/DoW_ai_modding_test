--------------------------------------
-- File: 'stikkbommatactic.ai'
-- Edited by Gambit   @ 21.01.2022

class 'StikkBommaTactic' (OrkInfantryTactic)

StikkBommaz = {}

function StikkBommaTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Stikk Bommaz Tactic")
	self.m_iStikkBombsTime = g_iGMT
end


function StikkBommaTactic:InitAbilities()

	-- Init ability ID's
	if (StikkBommaz.stikkbombs_id == nil) then
		StikkBommaz.stikkbombs_id = cpu_manager.stats:GetAbilityID("ork_stikkbombs_stikkbommaz")
	end
end


function StikkBommaTactic:DoAbilities()

	-- Try to use stikk bomb ability, with an interval of 5 secs
	if self.squad_ai:IsInCombat() then
		if self.squad_ai:CanDoAbility(StikkBommaz.stikkbombs_id) and self.m_iStikkBombsTime > g_iGMT + 5 then
			if Ability.DoAbilityTarget(self.squad_ai, StikkBommaz.stikkbombs_id, Ability.Filters.CloseSquadEnemy, 6)
			or Ability.DoAbilityTarget(self.squad_ai, StikkBommaz.stikkbombs_id, Ability.Filters.CloseMonsterEnemy, 4)
			or Ability.DoAbilityTarget(self.squad_ai, StikkBommaz.stikkbombs_id, Ability.Filters.CloseCommanderEnemy, 1) then
				self.m_iStikkBombsTime = g_iGMT
				return
			end
		end
	end
end


function StikkBommaTactic:Reinforce()

	-- If I am broken, don't upgrade!
	if (self:IsAffectedByMorale() and self.squad_ai:IsBroken()) then
		return
	end
   
	-- If there are no resources available, don't upgrade!
	if (not Tactic.Options.can_reinforce) then
		return
	end
	
	-- Don't stack reinforces
    if (self.squad_ai:IsReinforcing()) then
    	return
    end
    
    -- Try to reinforce
    if (self.squad_ai:CanReinforce(true, 0)) then            
        self.squad_ai:DoReinforce(true, 0)
    elseif (self.squad_ai:CanReinforce(false, 0)) then
    
		-- Don't reinforce if we have ork recruitment or no leader
		local iRequisition = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Requisition )
		local bOrkRecruitment = cpu_manager.cpu_player:IsResearchComplete("ork_recruitment")
		if ((self.squad_ai:HasLeader() or self.squad_ai:GetNumTroopers() < 6) and 
			(not bOrkRecruitment or iRequisition > 600)) then
			self.squad_ai:DoReinforce(false, 0)
		end
    end
end
