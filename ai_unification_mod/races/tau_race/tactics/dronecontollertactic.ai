----------------------------------------
-- File: 'dronecontollertactic.ai'
-- Created by Gambit		@ 13.8.2021

class 'DroneContollerTactic' (TauInfantryTactic)

DroneContoller = {}

function DroneContollerTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Drone Contoller Tactic")
	G_Tau_ControllerPos = self.squad_ai:GetPosition()
	self.m_iStealthTime = g_iGMT
end


function DroneContollerTactic:IsAttacker()
	return not self.squad_ai:WasRecentlyHurt()
end


function DroneContollerTactic:InitAbilities()
	-- Init ability ID's
	if DroneContoller.sniper_drone_stealth_id == nil then
		DroneContoller.sniper_drone_stealth_id = cpu_manager.stats:GetAbilityID( "tau_drone_controller_sniper_drones_stealth_field" )	
	end
end


function DroneContollerTactic:DoAbilities()
	-- Update Position
	G_Tau_ControllerPos = self.squad_ai:GetPosition()

	-- Always try to launch Sniper Drones
	if self.squad_ai:CanDirectSpawn() then 
		self.squad_ai:DoDirectSpawn()
	end

	if self.squad_ai:IsUsingAbility(DroneContoller.sniper_drone_stealth_id) and g_iGMT > self.m_iStealthTime + 6 then
		-- Stop stealth if not under attack
		if not G_Tau_SniperDronesUnderAttack == true then
			self.squad_ai:DoSpecialAbility(DroneContoller.sniper_drone_stealth_id)
			self.m_iStealthTime = g_iGMT
		end
	elseif G_Tau_SniperDronesUnderAttack == true and g_iGMT > self.m_iStealthTime + 6 then
		-- Enable stealth, to prevent damage
		self.squad_ai:DoSpecialAbility(DroneContoller.sniper_drone_stealth_id)
		self.m_iStealthTime = g_iGMT
	end
end