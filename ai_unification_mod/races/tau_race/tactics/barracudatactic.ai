----------------------------------------
-- File: 'barracudatactic.ai'
-- Created by Gambit @ 19.09.2017

class 'BarracudaTactic' (TauVehicleTactic)

SunsharkBomber = {}
Tigershark = {}

function BarracudaTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Barracuda / Sunshark / Tigershark Tactics")

	-- Used for the stuck check code for the squads that can jump
	self.initialPosition = self.squad_ai:GetPosition()
end


function BarracudaTactic:InitAbilities()

	if SunsharkBomber.pulse_bomb_id == nil then
		SunsharkBomber.pulse_bomb_id = cpu_manager.stats:GetAbilityID( "tau_pulse_bomb_sunshark_bomber" )
	end
	if Tigershark.seeker_missiles_id == nil then
		Tigershark.seeker_missiles_id = cpu_manager.stats:GetAbilityID( "tau_tigerhark_seeker_missiles_barrage" )
	end
end


function BarracudaTactic:DoAbilities()

	if self.squad_ai:IsInCombat() then
		-- Try throwing the Pulse Bomb
		if self.squad_ai:CanDoAbility(SunsharkBomber.pulse_bomb_id) then
			local iPos = self.squad_ai:GetPosition()
			local oTarget = Ability.Filters.CloseInfantryEnemy(iPos, 30, 1)
			if oTarget ~= nil and oTarget:IsValid() and oTarget:GetNumTroopers() > 4 then
				self.squad_ai:DoSpecialAbilitySquad(SunsharkBomber.pulse_bomb_id, oTarget:GetSquad())
			else
				oTarget = Ability.Filters.CloseCommanderEnemy(iPos, 30, 1)
				if oTarget ~= nil and oTarget:IsValid() then
					self.squad_ai:DoSpecialAbilitySquad(SunsharkBomber.pulse_bomb_id, oTarget:GetSquad())
				end
			end
		elseif self.squad_ai:CanDoAbility(Tigershark.seeker_missiles_id) then
			if resource_manager:GetResourceAmount():Get(ResourceAmount.RT_Power) > 400 then
				if Ability.DoAbilityTarget(self.squad_ai, Tigershark.seeker_missiles_id, Ability.Filters.CloseVehicleEnemy, 1)
				or Ability.DoAbilityTarget(self.squad_ai, Tigershark.seeker_missiles_id, Ability.Filters.CloseEnemy, 1) then
					return
				end
			end
		end
	end
	
	-- New code to unstuck units with pathing issues, that can jump.
	-- Call it with [true], only for multi-membered squads.
	self:SolveStuckCase(false)
end
