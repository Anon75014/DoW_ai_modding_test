----------------------------------------
-- File: 'krootcstactic.ai'
-- Edited by Gambit @ 07.08.2021
-- Edited by Gambit @ 27.09.2023

class 'KrootCSTactic' (TauInfantryTactic)

KrootCommandSquad = {}

function KrootCSTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Kroot Command Squad Tactic")
end

function KrootCSTactic:IsAttacker()
	return self:IsCommanderAttacker()
end

function KrootCSTactic:IsDefender()
	return self:IsCommanderDefender()
end

function KrootCSTactic:InitAbilities()

	-- Init ability ID's
	if KrootCommandSquad.emp_id == nil then
		KrootCommandSquad.emp_id = cpu_manager.stats:GetAbilityID( "tau_emp_grenade_guevesaui" )
		KrootCommandSquad.thermal_id = cpu_manager.stats:GetAbilityID( "tau_cs_kroot_hero_thermal_detonator" )
	end
end

function KrootCSTactic:DoAbilities()

	if self.squad_ai:IsInCombat() then
		if self.squad_ai:CanDoAbility(KrootCommandSquad.emp_id) then
			Ability.DoAbilityTarget(self.squad_ai, KrootCommandSquad.emp_id, Ability.Filters.CloseVehicleEnemy, 1)
		end
	end
	if self.squad_ai:WasRecentlyHurt() or self.squad_ai:IsInCombat() or cpu_manager.terrain_analyzer:HasThreat(self.squad_ai:GetPosition(), 25) then
		if self.squad_ai:CanDoAbility(KrootCommandSquad.thermal_id) then
			Ability.DoAbilityTargetEntity(self.squad_ai, KrootCommandSquad.thermal_id, Ability.EntityFilters.CloseBaseEntityEnemy, 1)
		end
	end
end

function KrootCSTactic:Reinforce()

	if not self.squad_ai:IsReinforcing() then
		-- Always try for the actual leader first
		if self.squad_ai:CanReinforce( false, 0 ) then
			self.squad_ai:DoReinforce( false, 0 )
			return
		end
		-- Desired order of reinforcing
		if self.squad_ai:GetLeaderCount(0) < 1 then
			if self.squad_ai:CanReinforce( true, 0 ) then
				self.squad_ai:DoReinforce( true, 0 )
				return
			end
		end
		if self.squad_ai:GetLeaderCount(1) < 1 then
			if self.squad_ai:CanReinforce( true, 1 ) then
				self.squad_ai:DoReinforce( true, 1 )
				return
			end
		end
	end
end