----------------------------------------
-- File: 'darkangelsgrandmastertactic.ai'
-- Edited by Thudmeizer @ 06.06.2018

class 'DarkAngelsGrandMasterTactic' (DarkAngelsInfantryTactic)

DarkAngelsGrandMaster = {}

function DarkAngelsGrandMasterTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Dark Angels Grand Master Tactic")
end

-- Assassinate win condition -- never attack
function DarkAngelsGrandMasterTactic:IsAttacker()
	return (not cpu_manager.assassinate and self:IsCommanderAttacker())
end

-- Assassinate win condition -- never defend
function DarkAngelsGrandMasterTactic:IsDefender()
	return (not cpu_manager.assassinate and self:IsCommanderDefender())
end

function DarkAngelsGrandMasterTactic:InitAbilities()

end

function DarkAngelsGrandMasterTactic:DoAbilities()

    self:DoOrbitalBombardment()
end

function DarkAngelsGrandMasterTactic:CheckForBroken()

	if (self.squad_ai:IsBroken()) then
	
		-- Check if I can repair my morale
		local grandmasterrally_id = cpu_manager.stats:GetAbilityID( "darkangels_rally" )
		if (self.squad_ai:CanDoAbility( grandmasterrally_id )) then
			self.squad_ai:DoSpecialAbility( grandmasterrally_id )
		end
	end
	
	-- Call basic broken check method
	InfantryTactic.CheckForBroken(self)
end

function DarkAngelsGrandMasterTactic:Update()

	if (self:IsComplete()) then
		return
	end
	
	-- State machine
	if (not InfantryTactic.Update( self )) then
		return
	end
		
	-- Assassinate win condition -- never attach to a squad
	if (not cpu_manager.assassinate) then
		
		-- Attach to melee in tier3+
		if (cpu_manager:GetTierLevel() > 2) then
		
			if (self:TryAttachSquad(true, true, 50, 100, nil) ~= nil) then
				return
			end
		end
		if (self:TryAttachSquad(false, true, 50, 100, self.m_fCommanderAttachHealth) == nil) then
			self:TryAttachSquadMelee()
		end
	end
end