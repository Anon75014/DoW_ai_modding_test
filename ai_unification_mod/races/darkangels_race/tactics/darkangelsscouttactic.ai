----------------------------------------
-- File: 'darkangelsscouttactic.ai'
-- Edited by Thudmizer		@ 10.08.2008

class 'DarkAngelsScoutTactic' (DarkAngelsInfantryTactic)

function DarkAngelsScoutTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Dark Angels Scout Tactic")
end

function DarkAngelsScoutTactic:IsAttacker()
	return (cpu_manager:GetTierLevel() >= 2)
end

function DarkAngelsScoutTactic:Upgrade()

	-- If I am broken, don't upgrade!
	if (self:IsAffectedByMorale() and self.squad_ai:IsBroken()) then
		return
	end
	
	-- If there are no ressources available, don't upgrade!
	local iRequisition = resource_manager:GetResourceAmount():Get(ResourceAmount.RT_Requisition)
	if (iRequisition < 800 and not Tactic.Options.can_reinforce) then
		return
	end
   
	-- Only upgrade if not reinforcing
	if (not self.squad_ai:IsReinforcing() and cpu_manager:GetTierLevel() >= 2) then
	
		if (self.squad_ai:HasUpgradableTrooper() and self.squad_ai:GetNumTroopers() > 2) then
			local class_type = cpu_manager:FindClosestEnemyPlayer():GetMajorityClassType()
			self.squad_ai:DoBestUpgrade( class_type )
		end
	end
end

function DarkAngelsScoutTactic:Reinforce()

	-- If I am broken, don't upgrade/reinforce!
	if (self:IsAffectedByMorale() and self.squad_ai:IsBroken()) then
	   return
	end

	if (not Tactic.Options.can_reinforce) then
		return
	end
	
	-- Reinforce scout squad
	if (not self.squad_ai:IsReinforcing()) then
			
		if (self.squad_ai:CanReinforce( true, 0 )) then
			self.squad_ai:DoReinforce( true, 0 )
		elseif (self.squad_ai:CanReinforce( false, 0 )) then
			self.squad_ai:DoReinforce( false, 0 )
		end
	end
end

function DarkAngelsScoutTactic:Update()

	if (self:IsComplete()) then
		return
	end
	
	-- State machine
	if (not InfantryTactic.Update( self )) then
		return
	end
	
    -- Set unit on ranged stance in tier 3+
    if (cpu_manager:GetTierLevel() >= 2 and self.squad_ai:GetMeleeStance() ~= SquadAI.MSTANCE_Ranged) then
    	self.squad_ai:DoSetMeleeStance(SquadAI.MSTANCE_Ranged)
    end
end