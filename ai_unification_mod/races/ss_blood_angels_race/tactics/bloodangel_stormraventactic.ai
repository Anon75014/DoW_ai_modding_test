----------------------------------------
-- File: 'bloodangel_stormraventactic.ai'
-- Edited by Gambit @ 27.11.2022

class 'BloodAngelStormravenTactic' (BloodAngelsVehicleTactic)

function BloodAngelStormravenTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Blood Angel Stormraven Tactic")

	self.m_iLastEntrenchTimeSR = g_iGMT
end

function BloodAngelStormravenTactic:DoAbilities()

	-- Try to entrench
	self:DoEntrenchAbility()

	-- New code to unstuck units with pathing issues, that can jump.
	-- Call it with [true], only for multi-membered squads.
	self:SolveStuckCase(false)
end

function BloodAngelStormravenTactic:DoEntrenchAbility()

	if self.squad_ai:CanUnload() then
		self.squad_ai:DoUnload()
	end

	--[[ Don't entrench/retrench too fast after a retrench/entrench
	if (g_iGMT < self.m_iLastEntrenchTimeSR + 30) then
		return
	end

	-- Check if we can entrench, and there is a need to
	if not self.squad_ai:IsInCombat() then
		if (self.squad_ai:CanEntrench(true)) and (not cpu_manager.terrain_analyzer:HasThreat(self.target, 30)) then
			self.squad_ai:DoEntrench(true)
			self.m_iLastEntrenchTimeSR = g_iGMT
		end
	end]]

	-- Check if we must retrench
	if (self.squad_ai:CanEntrench(false)) then
		self.squad_ai:DoEntrench(false)
	end
end
