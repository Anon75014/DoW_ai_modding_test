----------------------------------------
-- File: 'daemonsBuildBaseStrategy.ai'
-- Created by Krronus	@ 5/1/11
-- Edited by CornCobMan	@ 03/06/2013
-- Edited by fuggles	@ 10/06/2013
-- Edited by Gambit 	@ 26/07/2013
-- Edited by Thudmeizer	@ 29.10.2025

class 'DaemonsBuildBaseStrategy' (BuildBaseStrategy)

daemonicGiftResearchSelector = math.random( 1, 100 )

function DaemonsBuildBaseStrategy:__init( baseinfo ) super( baseinfo )

	-- Add detector units (Best first, worst last)
	self:AddDetectorUnit("daemon_squad_lord")
	self:AddDetectorUnit("daemon_squad_lord_stature")
	self:AddDetectorUnit("daemon_squad_lord_khorne")
	self:AddDetectorUnit("daemon_squad_lord_stature_khorne")
	self:AddDetectorUnit("daemon_squad_lord_nurgle")
	self:AddDetectorUnit("daemon_squad_lord_stature_nurgle")
	self:AddDetectorUnit("daemon_squad_lord_slaanesh")
	self:AddDetectorUnit("daemon_squad_lord_stature_slaanesh")
	self:AddDetectorUnit("daemon_squad_lord_tzeentch")
	self:AddDetectorUnit("daemon_squad_lord_stature_tzeentch")
	self:AddDetectorUnit("daemon_squad_daemon_prince")
	self:AddDetectorUnit("daemon_squad_daemon_prince_khorne")
	self:AddDetectorUnit("daemon_squad_daemon_prince_slaanesh")
	self:AddDetectorUnit("daemon_squad_daemon_prince_nurgle")
	self:AddDetectorUnit("daemon_squad_daemon_prince_tzeentch")
	self:AddDetectorUnit("daemon_squad_hell_spawn")
	self:AddDetectorUnit("daemon_squad_soul_grinder")
	self:AddDetectorUnit("daemon_squad_lord_of_change")
	self:AddDetectorUnit("daemon_squad_flesh_hound")
	
	-- Choose one of two favoured army research patterns for the Daemons race, if not chosen already!
	if cpu_manager.cpu_player:IsResearchComplete("daemons_research_favored1") then
		g_iFavoredResearch = 1
	elseif cpu_manager.cpu_player:IsResearchComplete("daemons_research_favored2") then
		g_iFavoredResearch = 2
	else
		g_iFavoredResearch = math.random(1, 2)
	end

	CpuPrerequisites2.AddSpecialItem("0titan_building_enable", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("0titans_tier_ii_enable", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_dummy_greater_brass_scorpion", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_dummy_greater_death_wheel", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_dummy_lord_of_skulls", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_dummy_soul_grinder", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_research_gift_eyes_angron", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_ls_daemon_lord_wargear_upgrade_01", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_ls_daemon_lord_wargear_upgrade_02", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_ls_daemon_lord_wargear_upgrade_03", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_ls_daemon_lord_wargear_upgrade_04", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_ls_daemon_lord_wargear_upgrade_05", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_ls_daemon_lord_wargear_upgrade_06", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_ls_daemon_lord_wargear_upgrade_07", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_ls_daemon_lord_wargear_upgrade_08", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_ls_daemon_lord_wargear_upgrade_09", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("daemons_ls_daemon_lord_wargear_upgrade_10", CpuPrerequisites.BT_Research)
	CpuPrerequisites2.AddSpecialItem("addon_daemons_hell_fire", CpuPrerequisites.BT_AddOn)
	CpuPrerequisites2.AddSpecialItem("addon_daemons_hell_fire_2", CpuPrerequisites.BT_AddOn)
	CpuPrerequisites2.AddSpecialItem("daemon_squad_primarch_angron", CpuPrerequisites.BT_Squad)
	CpuPrerequisites2.AddSpecialItem("daemon_squad_greater_brass_scorpion", CpuPrerequisites.BT_Squad)
	CpuPrerequisites2.AddSpecialItem("daemon_squad_greater_brass_scorpion_alt", CpuPrerequisites.BT_Squad)
	CpuPrerequisites2.AddSpecialItem("daemon_squad_greater_death_wheel", CpuPrerequisites.BT_Squad)
	CpuPrerequisites2.AddSpecialItem("daemon_squad_lord_of_skulls", CpuPrerequisites.BT_Squad)
	CpuPrerequisites2.AddSpecialItem("daemon_squad_soul_grinder", CpuPrerequisites.BT_Squad)
	CpuPrerequisites2.AddSpecialItem("daemon_squad_daemon_prince_advance_sp", CpuPrerequisites.BT_Squad)
	CpuPrerequisites2.AddSpecialItem("daemon_squad_lord_advance_sp", CpuPrerequisites.BT_Squad)
	CpuPrerequisites2.AddSpecialItem("daemon_squad_fire_lord", CpuPrerequisites.BT_Squad)
	CpuPrerequisites2.AddSpecialItem("daemon_squad_lord_ktgm", CpuPrerequisites.BT_Squad)
	CpuPrerequisites2.AddSpecialItem("daemon_squad_daemon_prince_ktgm", CpuPrerequisites.BT_Squad)

	-- Choose one of five mark research patterns for the LS Chaos Daemons
	self.m_iLSMarkResearchPattern = math.random(1, 4)

    	-- The switch for the Commander LS/KTGM WarGear Researches
    	G_KTGM_Commander_WG_Choice_Made = false
end


function DaemonsBuildBaseStrategy:ChooseBuildProgram()

	-- Check build program count
	if (table.getn(self.info.BuildPrograms) ~= 5) then
		return BuildBaseStrategy.ChooseBuildProgram(self)
	end

	-- If a Mark has already been chosen (from a saved game, change players wincondition, etc.),
	-- continue with that Program and do not change, or the tech will be messed-up.
	if cpu_manager.cpu_player:IsResearchComplete("daemons_mark_khorne") then
		g_iHarassingLeader = 1
		self:SetSquadLimitsBasedOnStrategy(1)
		return 1
	elseif cpu_manager.cpu_player:IsResearchComplete("daemons_mark_slaanesh") then
		g_iHarassingLeader = 2
		self:SetSquadLimitsBasedOnStrategy(2)
		return 2
	elseif cpu_manager.cpu_player:IsResearchComplete("daemons_mark_tzeentch") then
		g_iHarassingLeader = 3
		self:SetSquadLimitsBasedOnStrategy(3)
		return 3
	elseif cpu_manager.cpu_player:IsResearchComplete("daemons_mark_nurgle") then
		g_iHarassingLeader = 4
		self:SetSquadLimitsBasedOnStrategy(4)
		return 4
	end

	-- If no strategy program has been chosen, chose one.

	-- Get map size and closest enemy distance
	local sMapSize, iClosestEnemyDistance = self:GetMapSize()
		
	-- Set probabilities of the strategies according to the map size
	local iBuildProgram1	-- Khorne
	local iBuildProgram2	-- Slaanesh
	local iBuildProgram3	-- Tzeentch
	local iBuildProgram4	-- Nurgle
	local iBuildProgram5	-- Undivided
	
	if (sMapSize == "small" or iClosestEnemyDistance <= 70 or cpu_manager.iPlayerCount == 2) then
	
		iBuildProgram1 = 27
		iBuildProgram2 = 28
		iBuildProgram3 = 27
		iBuildProgram4 = 28
		iBuildProgram5 = 40
		
	elseif (sMapSize == "large" and cpu_manager.iPlayerCount >= 6) then
	
		iBuildProgram1 = 31
		iBuildProgram2 = 31
		iBuildProgram3 = 31
		iBuildProgram4 = 32
		iBuildProgram5 = 25
	else
	
		iBuildProgram1 = 30
		iBuildProgram2 = 30
		iBuildProgram3 = 30
		iBuildProgram4 = 30
		iBuildProgram5 = 30
	end
	
	-- Modify probabilities according to the closest enemy player
	local oEnemy = cpu_manager:FindClosestEnemyPlayer(false)
	local sEnemy = oEnemy:GetPlayerRaceName()		

	-- If we got here, no program has been chosen, so go ahead and chose one!
	iBuildProgram2 = iBuildProgram1 + iBuildProgram2
	iBuildProgram3 = iBuildProgram2 + iBuildProgram3
	iBuildProgram4 = iBuildProgram3 + iBuildProgram4
	iBuildProgram5 = iBuildProgram4 + iBuildProgram5
	local iRandom = math.random(1, 150)
	if (iRandom <= iBuildProgram1) then
		g_iHarassingLeader = 1
		self:SetSquadLimitsBasedOnStrategy(1)
		return 1
	elseif (iRandom <= iBuildProgram2) then
		g_iHarassingLeader = 2
		self:SetSquadLimitsBasedOnStrategy(2)
		return 2
	elseif (iRandom <= iBuildProgram3) then
		g_iHarassingLeader = 3
		self:SetSquadLimitsBasedOnStrategy(3)
		return 3
	elseif (iRandom <= iBuildProgram4) then
		g_iHarassingLeader = 4
		self:SetSquadLimitsBasedOnStrategy(4)
		return 4
	elseif (iRandom <= iBuildProgram5) then
		g_iHarassingLeader = 5
		return 5
	end
	g_iHarassingLeader = math.random(1, 5)
	return g_iHarassingLeader
end

function DaemonsBuildBaseStrategy:SetSquadLimitsBasedOnStrategy(iStrategy)
	if iStrategy == 1 then
		-- Khorne
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_flesh_hound = math.random(4,6)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_bloodletters = math.random(5,8)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_bloodletter_iron = math.random(5,8)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_plague_bearers = math.random(1,2)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_fiends_advanced = 0
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_daemonettes = 0
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_screamers = math.random(1,2)
	elseif iStrategy == 2 then
		-- Slaanesh
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_flesh_hound = 0
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_bloodletters = 0
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_bloodletter_iron = 0
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_plague_bearers = math.random(1,2)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_fiends_advanced = math.random(4,6)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_daemonettes = math.random(3,5)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_screamers = math.random(1,2)
	elseif iStrategy == 3 then
		-- Tzeentch
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_bloodletters = math.random(1,2)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_bloodletter_iron = 0
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_nurgling = 0
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_plague_bearers = 0
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_fiends_advanced = 0
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_daemonettes = math.random(1,2)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_screamers = math.random(4,6)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_flamers = math.random(4,6)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_pink_horror_minions = 3
	elseif iStrategy == 4 then
		-- Nurgle
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_bloodletters = math.random(1,2)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_bloodletter_iron = 0
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_nurgling = math.random(4,6)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_plague_bearers = math.random(5,8)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_fiends_advanced = 0
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_daemonettes = math.random(1,2)
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_screamers = 0
		BuildBaseStrategyInfo.deamons_race.SquadLimits.standard.daemon_squad_flamers = 0
	end
end

function DaemonsBuildBaseStrategy:EvaluateSquadCap()

	--Check squad cap
	if (self:CheckSquadCap(300, 0)) then
	
		-- Check if a plan exists
		local iBuildingID = cpu_manager.stats:GetBuildingID("daemon_sacrificial_circle")
		if (self:PlanExists("Build Building Plan", iBuildingID)) then
			return
		end

		-- Check if any barracks are in production
		for oBuildChannel in build_manager:GetBuildChannelAIs() do
	
			-- Check building ID
			if (oBuildChannel:GetBlueprintID() == iBuildingID and not oBuildChannel:ConstructionDone()) then
				return
			end
		end
		
		-- Build a barracks
		local tBuildType = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Building
		tBuildType.name = "daemon_sacrificial_circle"
		if (self:TryBuild( tBuildType )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
	end
	
	-- Check support cap
	if (self:CheckSupportCap(150, 300)) then
	
		-- Check if a plan exists
		local iBuildingID = cpu_manager.stats:GetBuildingID("daemon_daemon_pit")
		if (self:PlanExists("Build Building Plan", iBuildingID)) then
			return
		end
		
		-- Check if any vehicle buildings are in production
		for oBuildChannel in build_manager:GetBuildChannelAIs() do
	
			-- Check building ID
			if (oBuildChannel:GetBlueprintID() == iBuildingID and not oBuildChannel:ConstructionDone()) then
				return
			end
		end
		
		-- Build a vehicle building
		local tBuildType = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Building
		tBuildType.name = "daemon_daemon_pit"
		if (self:TryBuild( tBuildType )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
	end  
end

function DaemonsBuildBaseStrategy:GetBuildingName( sType )

	-- Return race specific object string
	if (sType == "HQ") then
		return "daemon_hq"
		
	elseif (sType == "VehicleBuilding") then
		return "daemon_daemon_pit"
		
	elseif (sType == "ListeningPost") then
		return "daemon_listening_post"
		
	elseif (sType == "Generator") then
		return "daemon_icon"

	elseif (sType == "BiggerGenerator") then
		return "daemon_lab"

	elseif (sType == "Turret") then
		return "daemon_turret"

	elseif (sType == "Mine") then
		return "daemon_eye_of_terror"
	end
	
	return nil
end

function DaemonsBuildBaseStrategy:GetAddonBuilding( sType )
	
	if (sType == "addon_daemons_hell_fire") then
	return "daemon_hq"

	elseif (sType == "addon_daemons_hell_fire_2") then
	return "daemon_hq"

	elseif (sType == "addon_daemons_hq_1") then
	return "daemon_hq"

	elseif (sType == "addon_daemons_hq_2") then
	return "daemon_hq"

	elseif (sType == "addon_daemons_hq_3") then
	return "daemon_hq"

	elseif (sType == "addon_daemons_list_post_1") then
		return "daemon_listening_post"

	elseif (sType == "addon_daemons_list_post_2") then
		return "daemon_listening_post"

	elseif (sType == "addon_daemons_mark_khorne") then
		return "daemon_listening_post"	
		
	elseif (sType == "addon_daemons_mark_nurgle") then
		return "daemon_listening_post"	
		
	elseif (sType == "addon_daemons_mark_slaanesh") then
		return "daemon_listening_post"	
		
	elseif (sType == "addon_daemons_mark_tzeentch") then
		return "daemon_listening_post"	
		
	elseif (sType == "addon_daemons_turret") then
		return "daemon_turret"

	elseif (sType == "addon_daemons_turret") then
		return "daemon_turret_no_limit"
	end
	return nil
end

-- Arkhan 01.2006: Inherited method to check if an addon is a tier addon
function DaemonsBuildBaseStrategy:IsTierAddon( sName, iTargetTier )

	-- Check addon name and target tier
	if (sName == "addon_daemons_hq_1" and iTargetTier == 2) then
		return true
	elseif (sName == "addon_daemons_hq_2" and iTargetTier == 3) then
		return true
	elseif (sName == "addon_daemons_hq_3" and iTargetTier == 4) then
		return true
	end
	return false
end

-- Arkhan 11.2005: Returns the squad cap and support cap of the given squad
function DaemonsBuildBaseStrategy:GetUnitStats(sSquadName)

	if (sSquadName == "daemon_squad_flesh_hounds") then
		return 1, 0
	elseif (sSquadName == "daemon_squad_nurgling") then
		return 1, 0
	elseif (sSquadName == "daemon_squad_daemonettes") then
		return 2, 0
	elseif (sSquadName == "daemon_squad_fury") then
		return 2, 0
	elseif (sSquadName == "daemon_squad_horblu") then
		return 2, 0
	elseif (sSquadName == "daemon_squad_horblu_stature") then
		return 2, 0
	elseif (sSquadName == "daemon_squad_horror") then
		return 2, 0
	elseif (sSquadName == "daemon_squad_pink_horror") then
		return 2, 0
	elseif (sSquadName == "daemon_squad_pink_horror_minions") then
		return 2, 0
	elseif (sSquadName == "daemon_squad_plague_bearers") then
		return 2, 0
	elseif (sSquadName == "daemon_squad_screamers") then
		return 2, 0
	elseif (sSquadName == "daemon_squad_jugg") then
		return 2, 0
	elseif (sSquadName == "daemon_squad_daemonettes_greater") then
		return 3, 0
	elseif (sSquadName == "daemon_squad_bloodletter_iron") then
		return 3, 0
	elseif (sSquadName == "daemon_squad_fiends") then
		return 3, 0
	elseif (sSquadName == "daemon_squad_fiends_advanced") then
		return 3, 0
	elseif (sSquadName == "daemon_squad_flamers") then
		return 3, 0
	elseif (sSquadName == "daemon_squad_hate_angel") then
		return 3, 0
	elseif (sSquadName == "daemon_squad_mutilator") then
		return 3, 0
	elseif (sSquadName == "daemon_squad_obliterator") then
		return 3, 0
	elseif (sSquadName == "daemon_squad_bloodletter_elites") then
		return 4, 0
	elseif (sSquadName == "daemon_squad_juggernaut") then
		return 0, 1
	elseif (sSquadName == "daemon_squad_burning_chariot") then
		return 0, 1
	elseif (sSquadName == "daemon_squad_defiler_khorne") then
		return 0, 1
	elseif (sSquadName == "daemon_squad_defiler_nurgle") then
		return 0, 1	
	elseif (sSquadName == "daemon_squad_defiler_slaanesh") then
		return 0, 1	
	elseif (sSquadName == "daemon_squad_defiler_tzeentch") then
		return 0, 1
	elseif (sSquadName == "daemon_squad_warp_spawn") then
		return 0, 1
	elseif (sSquadName == "daemon_squad_blight_drones") then
		return 0, 1
	elseif (sSquadName == "daemon_squad_seeker") then
		return 0, 1
	elseif (sSquadName == "daemon_squad_daemon_prince") then
		return 0, 2
	elseif (sSquadName == "daemon_squad_bloodthirster") then
		return 0, 2
	elseif (sSquadName == "daemon_squad_guo") then
		return 0, 2
	elseif (sSquadName == "daemon_squad_keeper_of_secrets") then
		return 0, 2
	elseif (sSquadName == "daemon_squad_lord_of_change") then
		return 0, 2
	elseif (sSquadName == "daemon_squad_hell_spawn") then
		return 0, 3
	elseif (sSquadName == "daemon_squad_fire_lord") then
		return 0, 3
	elseif (sSquadName == "daemon_squad_soul_grinder") then
		return 0, 4
	elseif (sSquadName == "daemon_squad_greater_death_wheel") then
		return 0, 4
	elseif (sSquadName == "daemon_squad_lord_of_skulls") then
		return 0, 4
	elseif (sSquadName == "daemon_squad_greater_brass_scorpion") then
		return 0, 4
	elseif (sSquadName == "daemon_squad_greater_brass_scorpion_alt") then
		return 0, 4
	elseif (sSquadName == "daemon_squad_primarch_angron") then
		return 0, 6
	end
	
	return 0, 0
	
end

function DaemonsBuildBaseStrategy:UpdateTierLevel()

	-- Reset tier level
	self.tierLevel = 1
	
	-- Prepare
	local iHQAddon1ID = cpu_manager.stats:GetAddOnID("addon_daemons_hq_1")
	local iHQAddon2ID = cpu_manager.stats:GetAddOnID("addon_daemons_hq_2")
	local iHQAddon3ID = cpu_manager.stats:GetAddOnID("addon_daemons_hq_3")
	local oStats = cpu_manager.stats:GetPlayerStatsFromID( cpu_manager.player_id )
	
	-- Check HQ's for addons
	for oBase in oStats:GetBases() do
	
		-- Check for valid building
		if (oBase:IsValid() and not oBase:IsListeningPost()) then
			
			-- Check for HQ addon 3
			if (oBase:HasAddOn(iHQAddon3ID)) then
				self.tierLevel = 4
				return
			-- Check for HQ addon 2
			elseif (oBase:HasAddOn(iHQAddon2ID)) then
				self.tierLevel = 3
			
			-- Check for HQ addon 1
			elseif (oBase:HasAddOn(iHQAddon1ID)) then
				self.tierLevel = 2
			end
		end
	end
end


function DaemonsBuildBaseStrategy:BuildFlexible()

	-- Always test first to see if there is at least one existing HQ
	if self:GetBuildingCountByName(self:GetBuildingName("HQ")) < 1 then
     		self:BuildFirstHQ()
	end

	-- Always test first to see if there is at least one existing builder unit
	self:BuildFirstBuilder("daemon_squad_lost_soul")

	if (g_iFavoredResearch == 1) then	
		-- Favoured Army: Minions
		self:DynamicResearch("daemons_research_favored1", 1, 0, 0, 0, 0, nil, 0)
	else
		-- Favoured Army: Greater Daemons
		self:DynamicResearch("daemons_research_favored2", 1, 0, 0, 0, 0, nil, 0)
	end
	

	--[[      ****************   ALL DAEMONIC GIFTS (Researches)    ****************
	> Normal Researches in daemon_gift_circle. Limit 10 (plus the Army selection) <
	Research-------------------------Name------------------------------------------
T1	daemons_research_gift3			Demonic Soul (Minions Only)					
T1	daemons_research_gift11			Daemonic Will (Greater Daemons Only)			
T1	daemons_possessed_flight		Possessed Boots
T2	daemons_research_gift4			Rapid Mutation I - Furies
T2	daemons_research_gift6			Daemonic Fortitude
T2	daemons_research_gift12			Daemonic Hull
T2	daemons_research_gift13			Infernal Will - Lost souls
T2	daemons_research_wings			Possessed Wings
T2	daemons_lord_research_1			Stat upgrades for commanders
T3	daemons_research_gift1			Warp Flames
T3	daemons_research_gift5			Faster Summoning (Minions Only)
T3	daemons_research_gift8			Fear (Greater Daemons Only)
T3	daemons_research_gift10			Daemonic Resilience (Greater Daemons Only)
T3	daemons_research_gift14			Hatred -Lost Souls (Minions Only)
T3	daemons_research_gift21			Daemonic Obliterators
T3	daemons_lord_research_2			More stat upgrades for commanders
T4	daemons_research_gift7			Greater Daemonic Fortitude (Minions Only)
T4	*daemons_research_gift9			Portals
T4	daemons_research_gift17			Daemonic Infestation - Shadow Fiends (Minions Only)
T4	daemons_research_gift18			Rapid Mutation II - Furies
T4	daemons_research_gift19			Steel-Hearted (Greater Daemons Only)
T4	daemons_research_gift20			Protective Runes - Shadow Fiends (Greater Daemons Only)
	---------------------------------------------------------------------------------------
	> GREATER Researches in daemon_maledictum. NO Limit, ALL must be researched <
	Research--------------------Notes-----------------Description--------------------------
T3	daemons_wargear01			(Minions Only)		Hellsword I
T3	daemons_wargear03			(Minions Only)		Fear
T4	daemons_wargear02			(Minions Only)		Hellsword II
T4	daemons_wargear04			(Minions Only)		Flame
T4	daemons_wargear05			(Minions Only)		Armour
T4	daemons_research_gift25		(Minions Only)		Tzeentch's Precision - Shadow Fiends
T5	daemons_wargear11			(Minions Only)		Gaze of Murder
T5	daemons_research_gift23		(Minions Only)		Infernal Shroud ability - Shadow Fiends
T3	daemons_research_gift15		(Greater Daemons Only)	Stature Daemon Lord
T3	daemons_research_gift16		(Greater Daemons Only)	Stature Shadow Fiends
T4	daemons_research_gift24		(Greater Daemons Only)	Strange Voice ability - Shadow Fiends
T5	daemons_research_gift22		(Greater Daemons Only)	Shield Ability - Daemon Lord
T5	daemons_transform_research	Prince Transformation for ALL lords
	-------------------------------------------------------------------------------------]]



	if( cpu_manager.cpu_player:IsResearchComplete( "daemons_research_favored1" ) ) then
		
		if( daemonicGiftResearchSelector <= 25 ) then

			self:DynamicResearch("daemons_research_gift3", 1, 0, 75, 0, 0, nil, 0)   -- Dem Soul
			self:DynamicResearch("daemons_research_gift6", 2, 0, 250, 0, 0, nil, 0)  -- Daem Fort
			self:DynamicResearch("daemons_research_gift4", 2, 0, 300, 0, 0, nil, 0)  -- Furies I
			self:DynamicResearch("daemons_research_gift13", 2, 0, 320, 0, 0, nil, 0) -- Inf Will - LS
			self:DynamicResearch("daemons_lord_research_1", 2, 0, 275, 0, 0, nil, 0) -- Lord I
			self:DynamicResearch("daemons_research_gift5", 3, 0, 220, 0, 0, nil, 0)  -- Faster Summ
			self:DynamicResearch("daemons_research_gift21", 3, 0, 500, 0, 0, nil, 0) -- Oblit
			self:DynamicResearch("daemons_lord_research_2", 3, 0, 320, 0, 0, nil, 0) -- Lord II
			self:DynamicResearch("daemons_research_gift7", 4, 0, 350, 0, 0, nil, 0)  -- Greater Fort
			self:DynamicResearch("daemons_research_gift18", 4, 0, 325, 0, 0, nil, 0) -- Furies II
			self:DynamicResearch("daemons_wargear01", 3, 0, 145, 0, 0, nil, 0)     ---- DL Sword 1
			self:DynamicResearch("daemons_wargear03", 3, 0, 300, 0, 0, nil, 0)       -- DL Fear
			self:DynamicResearch("daemons_wargear02", 4, 0, 280, 0, 0, nil, 0)       -- DL Sword 2
			self:DynamicResearch("daemons_wargear04", 4, 0, 350, 0, 0, nil, 0)       -- DL Flame
			self:DynamicResearch("daemons_wargear05", 4, 0, 300, 0, 0, nil, 0)       -- DL Armour
			self:DynamicResearch("daemons_research_gift25", 4, 0, 235, 0, 0, nil, 0) -- SF Precision
			self:DynamicResearch("daemons_wargear11", 4, 0, 550, 0, 0, nil, 0)       -- DL Gaze
			self:DynamicResearch("daemons_research_gift23", 4, 0, 280, 0, 0, nil, 0) -- SF Shroud
			self:DynamicResearch("daemons_transform_research", 4, 0, 850, 0, 0, nil, 0)  -- Prince

		elseif( daemonicGiftResearchSelector <= 50 ) then
			
			self:DynamicResearch("daemons_research_gift3", 1, 0, 75, 0, 0, nil, 0)   -- Dem Soul
			self:DynamicResearch("daemons_lord_research_1", 2, 0, 275, 0, 0, nil, 0) -- Lord I
			self:DynamicResearch("daemons_research_gift6", 2, 0, 250, 0, 0, nil, 0)  -- Daem Fort
			self:DynamicResearch("daemons_research_gift12", 2, 0, 340, 0, 0, nil, 0) -- Daem Hull
			self:DynamicResearch("daemons_research_gift1", 3, 0, 280, 0, 0, nil, 0)  -- Warp Flames
			self:DynamicResearch("daemons_lord_research_2", 3, 0, 320, 0, 0, nil, 0) -- Lord II
			self:DynamicResearch("daemons_research_gift14", 3, 0, 225, 0, 0, nil, 0) -- Hatred - LS
			self:DynamicResearch("daemons_research_gift9", 4, 0, 230, 0, 0, nil, 0)  -- Portals
			self:DynamicResearch("daemons_research_gift7", 4, 0, 350, 0, 0, nil, 0)  -- Greater Fort
			self:DynamicResearch("daemons_research_gift17", 4, 0, 225, 0, 0, nil, 0) -- Daem Inf - SF
			self:DynamicResearch("daemons_wargear01", 3, 0, 145, 0, 0, nil, 0)     ---- DL Sword 1
			self:DynamicResearch("daemons_wargear03", 3, 0, 300, 0, 0, nil, 0)       -- DL Fear
			self:DynamicResearch("daemons_wargear02", 4, 0, 280, 0, 0, nil, 0)       -- DL Sword 2
			self:DynamicResearch("daemons_wargear04", 4, 0, 350, 0, 0, nil, 0)       -- DL Flame
			self:DynamicResearch("daemons_wargear05", 4, 0, 300, 0, 0, nil, 0)       -- DL Armour
			self:DynamicResearch("daemons_research_gift25", 4, 0, 235, 0, 0, nil, 0) -- SF Precision
			self:DynamicResearch("daemons_wargear11", 4, 0, 550, 0, 0, nil, 0)       -- DL Gaze
			self:DynamicResearch("daemons_research_gift23", 4, 0, 280, 0, 0, nil, 0) -- SF Shroud
			self:DynamicResearch("daemons_transform_research", 4, 0, 850, 0, 0, nil, 0)  -- Prince
			
		elseif( daemonicGiftResearchSelector <= 75 ) then
			
			self:DynamicResearch("daemons_possessed_flight", 1, 0, 50, 0, 0, nil, 0) -- Boots
			self:DynamicResearch("daemons_research_gift4", 2, 0, 300, 0, 0, nil, 0)  -- Furies I
			self:DynamicResearch("daemons_research_gift6", 2, 0, 250, 0, 0, nil, 0)  -- Daem Fort
			self:DynamicResearch("daemons_research_gift12", 2, 0, 340, 0, 0, nil, 0) -- Daem Hull
			self:DynamicResearch("daemons_lord_research_1", 2, 0, 275, 0, 0, nil, 0) -- Lord I
			self:DynamicResearch("daemons_research_gift5", 3, 0, 220, 0, 0, nil, 0)  -- Faster Summ
			self:DynamicResearch("daemons_research_gift1", 3, 0, 280, 0, 0, nil, 0)  -- Warp Flames
			self:DynamicResearch("daemons_research_gift21", 3, 0, 500, 0, 0, nil, 0) -- Oblit
			self:DynamicResearch("daemons_research_gift9", 4, 0, 230, 0, 0, nil, 0)  -- Portals
			self:DynamicResearch("daemons_research_gift18", 4, 0, 325, 0, 0, nil, 0) -- Furies II
			self:DynamicResearch("daemons_wargear01", 3, 0, 145, 0, 0, nil, 0)     ---- DL Sword 1
			self:DynamicResearch("daemons_wargear03", 3, 0, 300, 0, 0, nil, 0)       -- DL Fear
			self:DynamicResearch("daemons_wargear02", 4, 0, 280, 0, 0, nil, 0)       -- DL Sword 2
			self:DynamicResearch("daemons_wargear04", 4, 0, 350, 0, 0, nil, 0)       -- DL Flame
			self:DynamicResearch("daemons_wargear05", 4, 0, 300, 0, 0, nil, 0)       -- DL Armour
			self:DynamicResearch("daemons_research_gift25", 4, 0, 235, 0, 0, nil, 0) -- SF Precision
			self:DynamicResearch("daemons_wargear11", 4, 0, 550, 0, 0, nil, 0)       -- DL Gaze
			self:DynamicResearch("daemons_research_gift23", 4, 0, 280, 0, 0, nil, 0) -- SF Shroud
			self:DynamicResearch("daemons_transform_research", 4, 0, 850, 0, 0, nil, 0)  -- Prince

		else
			
			self:DynamicResearch("daemons_possessed_flight", 1, 0, 50, 0, 0, nil, 0) -- Boots
			self:DynamicResearch("daemons_research_gift13", 2, 0, 320, 0, 0, nil, 0) -- Inf Will - LS
			self:DynamicResearch("daemons_research_gift4", 2, 0, 300, 0, 0, nil, 0)  -- Furies I
			self:DynamicResearch("daemons_research_gift6", 2, 0, 250, 0, 0, nil, 0)  -- Daem Fort
			self:DynamicResearch("daemons_research_wings", 2, 0, 275, 0, 0, nil, 0)  -- Wings
			self:DynamicResearch("daemons_lord_research_1", 2, 0, 275, 0, 0, nil, 0) -- Lord I
			self:DynamicResearch("daemons_research_gift12", 2, 0, 340, 0, 0, nil, 0) -- Daem Hull
			self:DynamicResearch("daemons_research_gift14", 3, 0, 225, 0, 0, nil, 0) -- Hatred - LS
			self:DynamicResearch("daemons_research_gift9", 4, 0, 230, 0, 0, nil, 0)  -- Portals
			self:DynamicResearch("daemons_research_gift17", 4, 0, 225, 0, 0, nil, 0) -- Daem Inf - SF
			self:DynamicResearch("daemons_wargear01", 3, 0, 145, 0, 0, nil, 0)     ---- DL Sword 1
			self:DynamicResearch("daemons_wargear03", 3, 0, 300, 0, 0, nil, 0)       -- DL Fear
			self:DynamicResearch("daemons_wargear02", 4, 0, 280, 0, 0, nil, 0)       -- DL Sword 2
			self:DynamicResearch("daemons_wargear04", 4, 0, 350, 0, 0, nil, 0)       -- DL Flame
			self:DynamicResearch("daemons_wargear05", 4, 0, 300, 0, 0, nil, 0)       -- DL Armour
			self:DynamicResearch("daemons_research_gift25", 4, 0, 235, 0, 0, nil, 0) -- SF Precision
			self:DynamicResearch("daemons_wargear11", 4, 0, 550, 0, 0, nil, 0)       -- DL Gaze
			self:DynamicResearch("daemons_research_gift23", 4, 0, 280, 0, 0, nil, 0) -- SF Shroud
			self:DynamicResearch("daemons_transform_research", 4, 0, 850, 0, 0, nil, 0)  -- Prince

		end
		
	elseif( cpu_manager.cpu_player:IsResearchComplete( "daemons_research_favored2" ) ) then
		
		if( daemonicGiftResearchSelector <= 25 ) then

			self:DynamicResearch("daemons_research_gift11", 1, 0, 85, 0, 0, nil, 0)  -- Daem Will
			self:DynamicResearch("daemons_research_gift6", 2, 0, 250, 0, 0, nil, 0)  -- Daem Fort
			self:DynamicResearch("daemons_research_gift12", 2, 0, 340, 0, 0, nil, 0) -- Daem Hull
			self:DynamicResearch("daemons_research_gift13", 2, 0, 320, 0, 0, nil, 0) -- Inf Will - LS
			self:DynamicResearch("daemons_lord_research_1", 2, 0, 275, 0, 0, nil, 0) -- Lord I
			self:DynamicResearch("daemons_research_gift1", 3, 0, 280, 0, 0, nil, 0)  -- Warp Flames
			self:DynamicResearch("daemons_research_gift8", 3, 0, 280, 0, 0, nil, 0)  -- Fear
			self:DynamicResearch("daemons_lord_research_2", 3, 0, 320, 0, 0, nil, 0) -- Lord II
			self:DynamicResearch("daemons_research_gift19", 4, 0, 500, 0, 0, nil, 0) -- Steel heart
			self:DynamicResearch("daemons_research_gift20", 4, 0, 160, 0, 0, nil, 0) -- Prot Runes - SF
			self:DynamicResearch("daemons_research_gift15", 3, 0, 350, 0, 0, nil, 0) ---- DL Stature
			self:DynamicResearch("daemons_research_gift16", 3, 0, 350, 0, 0, nil, 0) -- SF Stature
			self:DynamicResearch("daemons_research_gift24", 4, 0, 280, 0, 0, nil, 0) -- SF Voice
			self:DynamicResearch("daemons_research_gift22", 4, 0, 225, 0, 0, nil, 0) -- DL Shield
			self:DynamicResearch("daemons_transform_research", 4, 0, 850, 0, 0, nil, 0)  -- Prince

		elseif( daemonicGiftResearchSelector <= 50 ) then

			self:DynamicResearch("daemons_research_gift11", 1, 0, 85, 0, 0, nil, 0)  -- Daem Will
			self:DynamicResearch("daemons_possessed_flight", 1, 0, 50, 0, 0, nil, 0) -- Boots
			self:DynamicResearch("daemons_research_gift4", 2, 0, 300, 0, 0, nil, 0)  -- Furies I
			self:DynamicResearch("daemons_research_gift6", 2, 0, 250, 0, 0, nil, 0)  -- Daem Fort
			self:DynamicResearch("daemons_research_gift13", 2, 0, 320, 0, 0, nil, 0) -- Inf Will - LS
			self:DynamicResearch("daemons_lord_research_1", 2, 0, 275, 0, 0, nil, 0) -- Lord I
			self:DynamicResearch("daemons_research_gift8", 3, 0, 280, 0, 0, nil, 0)  -- Fear
			self:DynamicResearch("daemons_research_gift10", 3, 0, 275, 0, 0, nil, 0) -- Daem Resil
			self:DynamicResearch("daemons_research_gift19", 4, 0, 500, 0, 0, nil, 0) -- Steel heart
			self:DynamicResearch("daemons_research_gift20", 4, 0, 160, 0, 0, nil, 0) -- Prot Runes - SF
			self:DynamicResearch("daemons_research_gift15", 3, 0, 350, 0, 0, nil, 0) ---- DL Stature
			self:DynamicResearch("daemons_research_gift16", 3, 0, 350, 0, 0, nil, 0) -- SF Stature
			self:DynamicResearch("daemons_research_gift24", 4, 0, 280, 0, 0, nil, 0) -- SF Voice
			self:DynamicResearch("daemons_research_gift22", 4, 0, 225, 0, 0, nil, 0) -- DL Shield
			self:DynamicResearch("daemons_transform_research", 4, 0, 850, 0, 0, nil, 0)  -- Prince

		elseif( daemonicGiftResearchSelector <= 75 ) then

			self:DynamicResearch("daemons_possessed_flight", 1, 0, 50, 0, 0, nil, 0) -- Boots
			self:DynamicResearch("daemons_research_gift4", 2, 0, 300, 0, 0, nil, 0)  -- Furies I
			self:DynamicResearch("daemons_research_gift6", 2, 0, 250, 0, 0, nil, 0)  -- Daem Fort
			self:DynamicResearch("daemons_research_gift12", 2, 0, 340, 0, 0, nil, 0) -- Daem Hull
			self:DynamicResearch("daemons_research_wings", 2, 0, 275, 0, 0, nil, 0)  -- Wings
			self:DynamicResearch("daemons_research_gift1", 3, 0, 280, 0, 0, nil, 0)  -- Warp Flames
			self:DynamicResearch("daemons_research_gift21", 3, 0, 500, 0, 0, nil, 0) -- Oblit
			self:DynamicResearch("daemons_research_gift19", 4, 0, 500, 0, 0, nil, 0) -- Steel heart
			self:DynamicResearch("daemons_research_gift20", 4, 0, 160, 0, 0, nil, 0) -- Prot Runes - SF
			self:DynamicResearch("daemons_research_gift18", 4, 0, 325, 0, 0, nil, 0) -- Furies II
			self:DynamicResearch("daemons_research_gift15", 3, 0, 350, 0, 0, nil, 0) ---- DL Stature
			self:DynamicResearch("daemons_research_gift16", 3, 0, 350, 0, 0, nil, 0) -- SF Stature
			self:DynamicResearch("daemons_research_gift24", 4, 0, 280, 0, 0, nil, 0) -- SF Voice
			self:DynamicResearch("daemons_research_gift22", 4, 0, 225, 0, 0, nil, 0) -- DL Shield
			self:DynamicResearch("daemons_transform_research", 4, 0, 850, 0, 0, nil, 0)  -- Prince

		else

			self:DynamicResearch("daemons_possessed_flight", 1, 0, 50, 0, 0, nil, 0) -- Boots
			self:DynamicResearch("daemons_research_wings", 2, 0, 275, 0, 0, nil, 0)  -- Wings
			self:DynamicResearch("daemons_research_gift6", 2, 0, 250, 0, 0, nil, 0)  -- Daem Fort
			self:DynamicResearch("daemons_research_gift12", 2, 0, 340, 0, 0, nil, 0) -- Daem Hull
			self:DynamicResearch("daemons_research_gift4", 2, 0, 300, 0, 0, nil, 0)  -- Furies I
			self:DynamicResearch("daemons_lord_research_1", 2, 0, 275, 0, 0, nil, 0) -- Lord I
			self:DynamicResearch("daemons_research_gift10", 3, 0, 275, 0, 0, nil, 0) -- Daem Resil
			self:DynamicResearch("daemons_research_gift21", 3, 0, 500, 0, 0, nil, 0) -- Oblit
			self:DynamicResearch("daemons_research_gift18", 4, 0, 325, 0, 0, nil, 0) -- Furies II
			self:DynamicResearch("daemons_research_gift20", 4, 0, 160, 0, 0, nil, 0) -- Prot Runes - SF
			self:DynamicResearch("daemons_research_gift15", 3, 0, 350, 0, 0, nil, 0) ---- DL Stature
			self:DynamicResearch("daemons_research_gift16", 3, 0, 350, 0, 0, nil, 0) -- SF Stature
			self:DynamicResearch("daemons_research_gift24", 4, 0, 280, 0, 0, nil, 0) -- SF Voice
			self:DynamicResearch("daemons_research_gift22", 4, 0, 225, 0, 0, nil, 0) -- DL Shield
			self:DynamicResearch("daemons_transform_research", 4, 0, 850, 0, 0, nil, 0) -- Prince
		end
		self:DynamicResearch("daemons_research_gift_eyes_angron", 4, 0, 380, 0, 0, nil, 0)  -- Eyes of Agony (Angron)

	end

	-- Daemons Hero Wargear
	local iHeroCommanderSquads = self:CountSquads("daemon_squad_lord_advance_sp")
	if iHeroCommanderSquads > 0 then
		self:DynamicResearch("daemons_wargear_upgrade_01", 1, 0, 145, 4, 2, nil, 0)
		self:DynamicResearch("daemons_wargear_upgrade_02", 1, 0, 200, 4, 2, nil, 0)
		self:DynamicResearch("daemons_wargear_upgrade_03", 1, 0, 300, 4, 2, nil, 0)
		self:DynamicResearch("daemons_wargear_upgrade_04", 2, 0, 350, 4, 2, nil, 0)
		self:DynamicResearch("daemons_wargear_upgrade_05", 2, 0, 300, 4, 2, nil, 0)
		self:DynamicResearch("daemons_wargear_upgrade_06_amulet", 2, 110, 0, 2, 0, nil, 0)
		self:DynamicResearch("daemons_wargear_upgrade_07_banner", 3, 160, 0, 2, 0, nil, 0)
		self:DynamicResearch("daemons_wargear_upgrade_08_aura", 3, 160, 0, 4, 2, nil, 0)
		self:DynamicResearch("daemons_wargear_upgrade_09_wings", 3, 160, 14, 4, 2, nil, 0)
		self:DynamicResearch("daemons_wargear_upgrade_10_ascension", 4, 235, 0, 2, 0, nil, 0)
	end

	-- Daemons Last Standing Hero Wargear
	local iHeroLSCommanderSquads = self:CountSquads("daemon_squad_lord_ktgm")
	if iHeroLSCommanderSquads > 0 then

		self:DynamicResearch("daemons_ls_daemon_lord_research_1", 1, 50, 50, 0, 0, nil, 0)
		self:DynamicResearch("daemons_ls_daemon_lord_research_2", 1, 75, 75, 0, 0, nil, 0)

		if (self.m_iLSMarkResearchPattern == 1) then
			self:DynamicResearch("daemons_ls_daemon_lord_mark_khorne", 1, 125, 125, 0, 0, nil, 0)

		elseif (self.m_iLSMarkResearchPattern == 2) then
			self:DynamicResearch("daemons_ls_daemon_lord_mark_nurgle", 1, 125, 125, 0, 0, nil, 0)

		elseif (self.m_iLSMarkResearchPattern == 3) then
			self:DynamicResearch("daemons_ls_daemon_lord_mark_slaanesh", 1, 125, 125, 0, 0, nil, 0)

		elseif (self.m_iLSMarkResearchPattern == 4) then
			self:DynamicResearch("daemons_ls_daemon_lord_mark_tzeentch", 1, 125, 125, 0, 0, nil, 0)
		end

		if not G_KTGM_Commander_WG_Choice_Made then
			 -- WARNING: Below, ALWAYS insert numbers <= of the total in each table!
           		 -- I used the actual total of each table, so that ALL will be randomly available
            		i_WG_Selection_number1 = 7	-- The number of researches to randomize, from the 1st table
            		i_WG_Selection_number2 = 10	-- The number of researches to randomize, from the 2nd table

            		i_WG_Selections1 = {
                	{"daemons_ls_daemon_lord_daemons_04", 1, 125, 125, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_daemons_05", 1, 125, 125, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_daemons_06", 1, 125, 125, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_daemons_07", 1, 125, 125, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_daemons_08", 1, 125, 125, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_daemons_gift2", 1, 125, 125, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_daemons_gift3", 1, 125, 125, 0, 0, nil, 0}}

            		i_WG_Selections2 = {
                	{"daemons_ls_daemon_lord_wargear_upgrade_01", 1, 100, 100, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_wargear_upgrade_02", 1, 100, 100, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_wargear_upgrade_03", 1, 150, 150, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_wargear_upgrade_04", 1, 150, 150, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_wargear_upgrade_05", 1, 100, 100, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_wargear_upgrade_06", 1, 150, 150, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_wargear_upgrade_07", 1, 150, 150, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_wargear_upgrade_08", 1, 150, 150, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_wargear_upgrade_09", 1, 100, 100, 0, 0, nil, 0},
                	{"daemons_ls_daemon_lord_wargear_upgrade_10", 1, 200, 200, 0, 0, nil, 0}}

            		-- The switch ensures we make the choice only ONCE
            		G_KTGM_Commander_WG_Choice_Made = true
            		i_WG_Rdm1 = {}          -- The random Selections from the 1st table
            		i_WG_Rdm2 = {}          -- The random Selections from the 2nd table

            		-- Populate the two random tables with the number of researches we need for each
            		for i = 1, i_WG_Selection_number1 do
                		local selection = math.random(1, table.getn(i_WG_Selections1))
                		table.insert(i_WG_Rdm1, i_WG_Selections1[selection])
                		table.remove(i_WG_Selections1, selection)
            		end

            		for i = 1, i_WG_Selection_number2 do
                		local selection = math.random(1, table.getn(i_WG_Selections2))
                		table.insert(i_WG_Rdm2, i_WG_Selections2[selection])
                		table.remove(i_WG_Selections2, selection)
            		end
		end

       		-- We are done. Perform the Researches
        	for i = 1, table.getn(i_WG_Rdm1) do
            		self:DynamicResearch(i_WG_Rdm1[i][1], 0, i_WG_Rdm1[i][3], i_WG_Rdm1[i][4], 0, 0, nil, 0)
        	end

    		for i = 1, table.getn(i_WG_Rdm2) do
       			self:DynamicResearch(i_WG_Rdm2[i][1], 0, i_WG_Rdm2[i][3], i_WG_Rdm2[i][4], 0, 0, nil, 0)
       		end
	end

	-- Force building ALL mark addons. The g_iHarassingLeader integer also denotes chosen strategy.
	-- sAddonName, iAddonCount, iMinTier, iRequisitionCost, iPowerCost, iMinSquadCap, iMinSupportCap, sSquadName, iSquadMinCount, bSingleTier
	if g_iHarassingLeader == 1 then
		self:DynamicAddon( "addon_daemons_mark_khorne", 100, 1, 0, 250, 10, 0, nil, nil, false)
	elseif g_iHarassingLeader == 2 then
		self:DynamicAddon( "addon_daemons_mark_slaanesh", 100, 1, 0, 250, 10, 0, nil, nil, false)
	elseif g_iHarassingLeader == 3 then
		self:DynamicAddon( "addon_daemons_mark_tzeentch", 100, 1, 0, 250, 10, 0, nil, nil, false)
	elseif g_iHarassingLeader == 4 then
		self:DynamicAddon( "addon_daemons_mark_nurgle", 100, 1, 0, 250, 10, 0, nil, nil, false)
	end

	-- Dynamic research item syntax: ResearchName, MinTier, RequisitionCost, PowerCost, MinSquadCap, MinSupportCap, SquadName, SquadMinCount
	local iArmyStrength = cpu_manager:GetArmyStrength()
	local iCommanderSquads	= self:CountSquads("daemon_squad_lord")+self:CountSquads("daemon_squad_lord_khorne")+self:CountSquads("daemon_squad_lord_nurgle")+
	self:CountSquads("daemon_squad_lord_slaanesh")+self:CountSquads("daemon_squad_lord_tzeentch")
	
	-- Compute resource researches
	self:DynamicResearch("daemons_requisition_research_1", 2, 100, 3, 0, 0, nil, 0)
	self:DynamicResearch("daemons_power_research_1", 2, 200, 0, 0, 0, nil, 0)
	self:DynamicResearch("daemons_requisition_research_2", 3, 175, 5, 0, 0, nil, 0)
	self:DynamicResearch("daemons_power_research_2", 3, 350, 0, 0, 0, nil, 0)
	--self:DynamicResearch("daemons_requisition_research_3", 4, 250, 8, 0, 0, nil, 0)
	--self:DynamicResearch("daemons_power_research_3", 4, 500, 0, 0, 0, nil, 0)
	
	-- Allow this structure for Easy/Standard to enforce power for tiering up.
	--self:DynamicBuild("daemon_sacrificial_circle", 10, 2, 1000, 0, 0, 0)
	
	-- Restrict dynamic builds to hard difficulty or higher
	if (CpuManager.AISettings.bMultiBuildings) then
	
		-- Dynamic buildings
		-- Item-Syntax: BuildingName, BuildingCount, MinTier, MinRequisition, MinPower, MinSquadCap, MinSupportCap
		self:DynamicBuild("daemon_icon", 4, 1, 75, 0, 0, 0)
		self:DynamicBuild("daemon_sacrificial_circle", 3, 1, 320, 0, 0, 0)
		self:DynamicBuild("daemon_daemon_pit", 3, 2, 225, 0, 0, 0)
		self:DynamicBuild("daemon_gift_circle", 1, 1, 450, 0, 0, 0)
		self:DynamicBuild("daemon_hq", 2, 3, 700, 300, 0, 0)
       		self:DynamicBuild("daemon_hq", 3, 4, 1000, 600, 0, 0)
		self:DynamicBuild("daemon_turret", 6, 1, 500, 0, 0, 0)
		self:DynamicBuild("daemon_doom_pit", 1, 3, 500, 0, 0, 0)
		self:DynamicBuild("daemon_maledictum", 1, 3, 0, 0, 0, 0)
	end

	-- Try to get extra Power / Requisition
	local iRequisition = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Requisition )
	local iPower = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Power )

	-- Build a Power Trader if needed
	if (iRequisition > 10000 and iRequisition > 2.5*iPower) then
		local tBuildType = CpuBuildType()
		local tBuildTypeMin = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		tBuildTypeMin.btype = CpuPrerequisites.BT_Squad
		if cpu_manager.cpu_player:IsResearchComplete( "daemons_power_research_2" ) then
			tBuildType.name = "daemon_squad_trade_power3"
		elseif cpu_manager.cpu_player:IsResearchComplete( "daemons_power_research_1" ) then
			tBuildType.name = "daemon_squad_trade_power2"
		else
			tBuildType.name = "daemon_squad_trade_power"
		end
		if cpu_manager.cpu_player:IsResearchComplete( "daemons_power_research_1" ) then
			tBuildTypeMin.name = "daemon_squad_trade_power2"
		else
			tBuildTypeMin.name = "daemon_squad_trade_power"
		end
		if (self:TryBuild( tBuildType ) and self:TryBuild( tBuildTypeMin )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildTypeMin.name)
			aitrace("BuildController: Dynamic build of "..tBuildTypeMin.name)
		end
	elseif (iRequisition > 7000 and iRequisition > 2.5*iPower) then
		local tBuildType = CpuBuildType()
		local tBuildTypeMin = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		tBuildTypeMin.btype = CpuPrerequisites.BT_Squad
		if cpu_manager.cpu_player:IsResearchComplete( "daemons_power_research_2" ) then
			tBuildType.name = "daemon_squad_trade_power3"
		elseif cpu_manager.cpu_player:IsResearchComplete( "daemons_power_research_1" ) then
			tBuildType.name = "daemon_squad_trade_power2"
		else
			tBuildType.name = "daemon_squad_trade_power"
		end
		if cpu_manager.cpu_player:IsResearchComplete( "daemons_power_research_1" ) then
			tBuildTypeMin.name = "daemon_squad_trade_power2"
		else
			tBuildTypeMin.name = "daemon_squad_trade_power"
		end
		if (self:TryBuild( tBuildType ) and self:TryBuild( tBuildTypeMin )) then
			aitrace("BuildController: Dynamic build of "..tBuildTypeMin.name)
			aitrace("BuildController: Dynamic build of "..tBuildTypeMin.name)
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
	elseif (iRequisition > 3000 and iRequisition > 2.5*iPower) then
		local tBuildType = CpuBuildType()
		local tBuildTypeMin = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		tBuildTypeMin.btype = CpuPrerequisites.BT_Squad
		if cpu_manager.cpu_player:IsResearchComplete( "daemons_power_research_2" ) then
			tBuildType.name = "daemon_squad_trade_power3"
		elseif cpu_manager.cpu_player:IsResearchComplete( "daemons_power_research_1" ) then
			tBuildType.name = "daemon_squad_trade_power2"
		else
			tBuildType.name = "daemon_squad_trade_power"
		end
		tBuildTypeMin.name = "daemon_squad_trade_power"
		if (self:TryBuild( tBuildType ) and self:TryBuild( tBuildTypeMin )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildTypeMin.name)
			aitrace("BuildController: Dynamic build of "..tBuildTypeMin.name)
		end
	elseif (iRequisition > 1000 and iRequisition > 2.5*iPower) then
		local tBuildType = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		if cpu_manager.cpu_player:IsResearchComplete( "daemons_power_research_1" ) then
			tBuildType.name = "daemon_squad_trade_power2"
		else
			tBuildType.name = "daemon_squad_trade_power"
		end
		if (self:TryBuild( tBuildType )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
	end

	-- Build a Requisition Trader if needed
	if (iPower > 10000 and iPower > iRequisition) then
		local tBuildType = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		if cpu_manager.cpu_player:IsResearchComplete( "daemons_requisition_research_2" ) then
			tBuildType.name = "daemon_squad_trade_requisition3"
		elseif cpu_manager.cpu_player:IsResearchComplete( "daemons_requisition_research_1" ) then
			tBuildType.name = "daemon_squad_trade_requisition2"
		else
			tBuildType.name = "daemon_squad_trade_requisition"
		end
		if (self:TryBuild( tBuildType )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
	elseif (iPower > 7000 and iPower > iRequisition) then
		local tBuildType = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		if cpu_manager.cpu_player:IsResearchComplete( "daemons_requisition_research_2" ) then
			tBuildType.name = "daemon_squad_trade_requisition3"
		elseif cpu_manager.cpu_player:IsResearchComplete( "daemons_requisition_research_1" ) then
			tBuildType.name = "daemon_squad_trade_requisition2"
		else
			tBuildType.name = "daemon_squad_trade_requisition"
		end
		if (self:TryBuild( tBuildType )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
	elseif (iPower > 3000 and iPower > iRequisition) then
		local tBuildType = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		if cpu_manager.cpu_player:IsResearchComplete( "daemons_requisition_research_1" ) then
			tBuildType.name = "daemon_squad_trade_requisition2"
		else
			tBuildType.name = "daemon_squad_trade_requisition"
		end
		if (self:TryBuild( tBuildType )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
	elseif (iPower > 1000 and iPower > iRequisition) then
		local tBuildType = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		if cpu_manager.cpu_player:IsResearchComplete( "daemons_requisition_research_1" ) then
			tBuildType.name = "daemon_squad_trade_requisition2"
		else
			tBuildType.name = "daemon_squad_trade_requisition"
		end
		if (self:TryBuild( tBuildType )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
	end

	if (self.tierLevel < 4) then

		-- Used from HQ and Sac Circle to immediately deep-strike units around HQ rather than out into battlefield (necessary sometimes for early game)
		for build_channel in build_manager:GetBuildChannelAIs() do
		
			if (build_channel:CanDeepStrike() and not build_channel:CanOnlyDeepStrikeToEntity() and 
				build_channel:GetBlueprintID() == cpu_manager.stats:GetBuildingID("daemon_daemon_pit")) or
			   (build_channel:CanDeepStrike() and not build_channel:CanOnlyDeepStrikeToEntity() and 
				build_channel:GetBlueprintID() == cpu_manager.stats:GetBuildingID("daemon_sacrificial_circle")) then

			 -- Now deepstrike em around HQ!
			    aitrace("Deepstriking miliary unit randomly around HQ")
				local pos = cpu_manager.start_pos
 				pos.x = pos.x + math.random(-20, 20)
				pos.z = pos.z + math.random(-10, 4)
				build_channel:DoDeepStrikeToPos(pos)
			end 
  	    	end
	end

	-- Compute tier 2 researches
	if (self.tierLevel >= 2) then

		-- Try to build no-limit defensive turrets
		self:DynamicBuild("daemon_turret_no_limit", 2, 3, 300, 0, 0, 0)
	end

	-- Compute tier 3 researches
	if (self.tierLevel >= 3) then

		-- Force build additional generators in late game if we can with enough requisition and when low on power
                local iReq = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Requisition )
                local iPow = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Power )
                if iReq > 400 and iReq/iPow > 1.6 then

                	-- Check if a plan exists
                	local iBuildingID = cpu_manager.stats:GetBuildingID(self:GetBuildingName("Generator"))
                    	if (self:PlanExists("Build Building Plan", iBuildingID)) then
                       		return
                    	end

             		-- Check if any generators are in production
                    	for oBuildChannel in build_manager:GetBuildChannelAIs() do
                        	-- Check building ID
                        	if (oBuildChannel:GetBlueprintID() == iBuildingID and not oBuildChannel:ConstructionDone()) then
                            		return
                        	end
                    	end

             		-- Build a Generator
                    	local tBuildType = CpuBuildType()
                    	tBuildType.btype = CpuPrerequisites.BT_Building
                    	tBuildType.name = self:GetBuildingName("Generator")
                    	if (self:TryBuild( tBuildType )) then
               			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			end
		end

		-- Try to build no-limit defensive turrets
		self:DynamicBuild("daemon_turret_no_limit", 4, 3, 400, 0, 0, 0)
	end

	-- Compute tier 4 researches
   	if (self.tierLevel >= 4) then

		local iRequisition = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Requisition )
		local iPower = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Power )

       		-- Compute HQ Tier2 Addons for future HQs
       		if (self:GetBuildingCountByName("daemon_hq") > 1 and (iRequisition >= 500 and iPower >= 200)) then
            		self:DynamicAddon("addon_daemons_hq_1", 100, 4, 250, 100, 0, 0, nil, nil, false)
        	end

        	-- Compute HQ Tier3 Addons for future HQs
        	if (self:GetBuildingCountByName("daemon_hq") > 1 and (iRequisition >= 750 and iPower >= 300)) then
            		self:DynamicAddon("addon_daemons_hq_2", 50, 4, 325, 150, 0, 0, nil, nil, false)
        	end

        	-- Compute HQ Tier4 Addons for future HQs
        	if (self:GetBuildingCountByName("daemon_hq") > 1 and (iRequisition >= 1000 and iPower >= 400)) then
            		self:DynamicAddon("addon_daemons_hq_3", 50, 4, 400, 200, 0, 0, nil, nil, false)
        	end

		-- Try to build no-limit defensive turrets
		self:DynamicBuild("daemon_turret_no_limit", 10, 4, 500, 0, 0, 0)
    	end

	-- Resource trading for high resources
	self:BuildResourceTrades()
		
	-- Random marky addony shizz
	self:BuildRandomMarkAddons()
end

-- Force AI to give priority to re-build HQ if lost and none are present
function DaemonsBuildBaseStrategy:BuildFirstHQ()

	-- Check if a plan exists
	local iBuildingID = cpu_manager.stats:GetBuildingID(self:GetBuildingName("HQ"))
	if (self:PlanExists("Build Building Plan", iBuildingID)) then
		return
	end

	-- Check if any HQ are in production
	for oBuildChannel in build_manager:GetBuildChannelAIs() do

		-- Check building ID
		if (oBuildChannel:GetBlueprintID() == iBuildingID and not oBuildChannel:ConstructionDone()) then
			return
		end
	end
		
	-- Build the HQ
	local sHQName = self:GetBuildingName("HQ")
	local tBuildType = CpuBuildType()
	tBuildType.btype = CpuPrerequisites.BT_Building
	tBuildType.name = sHQName
	if (self:TryBuild( tBuildType )) then
		aitrace("BuildController: Dynamic build of "..tBuildType.name)
	end
	return
end

-- Force AI to give priority to recruit a builder unit if none are present
function DaemonsBuildBaseStrategy:BuildFirstBuilder(iBuilderName)

	if self:CountSquads(iBuilderName) < 1 then

		-- Recruit a builder squad
		local tBuildType = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		tBuildType.name = iBuilderName
		if (self:TryBuild( tBuildType )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
		return
	end
end

function DaemonsBuildBaseStrategy:BuildResourceTrades()
	-- Check resources and try to produce Power, if requisition is in excess. This function covers the most common resource balancing,
	--  where we want to limit the requisition loss in order to balance power (preferably using the 1:1 exchange).
	local squadID
	local iRequisition = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Requisition )
	local iPower = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Power )
		
	if (iRequisition < (2*iPower)) or iRequisition < 400 then 
		return
	end

	if iRequisition >= 10000 then
		if cpu_manager.cpu_player:IsResearchComplete( "daemons_power_research_1" ) then
			squadID = "daemon_squad_trade_power2"
		else
			squadID = "daemon_squad_trade_power"
		end
		-- Check if a plan exists for a trade squad
		if (self:GetPlan("Build Unit Plan", cpu_manager.stats:GetSquadID(squadID)) ~= nil) then
			return
		end
		-- Try to build trade squad
		local tBuildType = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		tBuildType.name = squadID
		if (self:TryBuild( tBuildType )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
	elseif iRequisition >= 5000 then
		if cpu_manager.cpu_player:IsResearchComplete( "daemons_power_research_1" ) then
			squadID = "daemon_squad_trade_power2"
		else
			squadID = "daemon_squad_trade_power"
		end
		-- Check if a plan exists for a trade squad
		if (self:GetPlan("Build Unit Plan", cpu_manager.stats:GetSquadID(squadID)) ~= nil) then
			return
		end
		-- Try to build trade squad
		local tBuildType = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		tBuildType.name = squadID
		if (self:TryBuild( tBuildType )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
	elseif iRequisition >= 1000 then
		squadID = "daemon_squad_trade_power"
		-- Check if a plan exists for a trade squad
		if (self:GetPlan("Build Unit Plan", cpu_manager.stats:GetSquadID(squadID)) ~= nil) then
			return
		end
		-- Try to build trade squad
		local tBuildType = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		tBuildType.name = squadID
		if (self:TryBuild( tBuildType )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
	elseif iPower <= 50 then
		squadID = "daemon_squad_trade_power"
		-- Check if a plan exists for a trade squad
		if (self:GetPlan("Build Unit Plan", cpu_manager.stats:GetSquadID(squadID)) ~= nil) then
			return
		end
		-- Try to build trade squad
		local tBuildType = CpuBuildType()
		tBuildType.btype = CpuPrerequisites.BT_Squad
		tBuildType.name = squadID
		if (self:TryBuild( tBuildType )) then
			aitrace("BuildController: Dynamic build of "..tBuildType.name)
		end
	end

end

function DaemonsBuildBaseStrategy:BuildRandomMarkAddons()
	local iPower = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Power )
	local tierLevel = self:GetTierLevel()
	
	if iPower < 350 then 
		return
	end
	
	if ( tierLevel >= 4 ) then
		self:DynamicAddon( "addon_daemons_mark_khorne", math.random( 5, 8 ), 2, 0, 150, 0, 0, nil, nil, false)
		self:DynamicAddon( "addon_daemons_mark_nurgle", math.random( 5, 8 ), 2, 0, 150, 0, 0, nil, nil, false)
		self:DynamicAddon( "addon_daemons_mark_slaanesh", math.random( 5, 8 ), 2, 0, 150, 0, 0, nil, nil, false)
		self:DynamicAddon( "addon_daemons_mark_tzeentch", math.random( 5, 8 ), 2, 0, 150, 0, 0, nil, nil, false)
	elseif ( tierLevel >= 3 ) then
		self:DynamicAddon( "addon_daemons_mark_khorne", math.random( 3, 5 ), 2, 0, 150, 0, 0, nil, nil, false)
		self:DynamicAddon( "addon_daemons_mark_nurgle", math.random( 3, 5 ), 2, 0, 150, 0, 0, nil, nil, false)
		self:DynamicAddon( "addon_daemons_mark_slaanesh", math.random( 3, 5 ), 2, 0, 150, 0, 0, nil, nil, false)
		self:DynamicAddon( "addon_daemons_mark_tzeentch", math.random( 3, 5 ), 2, 0, 150, 0, 0, nil, nil, false)
	elseif ( tierLevel >= 2 ) then
		self:DynamicAddon( "addon_daemons_mark_khorne", math.random( 1, 3 ), 2, 0, 150, 0, 0, nil, nil, false)
		self:DynamicAddon( "addon_daemons_mark_nurgle", math.random( 1, 3 ), 2, 0, 150, 0, 0, nil, nil, false)
		self:DynamicAddon( "addon_daemons_mark_slaanesh", math.random( 1, 3 ), 2, 0, 150, 0, 0, nil, nil, false)
		self:DynamicAddon( "addon_daemons_mark_tzeentch", math.random( 1, 3 ), 2, 0, 150, 0, 0, nil, nil, false)
	end
end

--  Method to check if force tech should be computed
function DaemonsBuildBaseStrategy:ForceTech()

	-- Check time
	if (g_iGMT < 60 * CpuManager.ForceTech.StartTier1) then
		return false
	end
	
	-- Check resources
	local iRequisition = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Requisition )
	local iPower = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Power )

	-- Check tier
	local iTierLevel = self:GetTierLevel()
	if (iTierLevel == 1) then
	
		-- Check resources
		if (iRequisition > 600 and iPower > 3) then
			return false
		end
		return not self.m_bHQAddon1
		
	elseif (iTierLevel == 2) then

		-- Check current build program
		if (self.m_iCurrentBuildProgram == 1) then

			-- Check build channel for ability building
			if (self:GetBuildingCountByName("daemon_daemon_pit", false) < 1) then
				return true
			end		
		end
		
		-- Check time
		if (g_iGMT > 60 * CpuManager.ForceTech.StartTier2 and (iRequisition < 600 or iPower < 10)) then
			return true
		end
		
	elseif (iTierLevel == 3) then	

		-- Check time
		if (g_iGMT > 60 * CpuManager.ForceTech.StartTier3 and (iRequisition < 600 or iPower < 600)) then
			return true
		end
		
	end
	return false
end

-- Return placement type for buildings
function DaemonsBuildBaseStrategy:GetPlacementType(iBuildingID)
	
	-- Check building
	if (iBuildingID == cpu_manager.stats:GetBuildingID(self:GetBuildingName("HQ"))) then
        	local count = self:GetBuildingCountByName(self:GetBuildingName("HQ"), false)
		local friend = cpu_manager:FindClosestFriendPlayer()
		if friend == nil then
			-- Lone Player
                	if count == 0 and not cpu_manager:HQThreat() then
                    		return "HQ"
                	else
                    		return "Safeplace"
                	end
        	else
        		-- Has allies
                	if count > 0 or cpu_manager:HQThreat() then
 				return "HQ"
                	else
				return "Safeplace"
                	end
		end
	elseif (iBuildingID == cpu_manager.stats:GetBuildingID("daemon_sacrificial_circle") or iBuildingID == cpu_manager.stats:GetBuildingID("daemon_daemon_pit")) then
		return "Military"
	elseif (iBuildingID == cpu_manager.stats:GetBuildingID("daemon_icon") or iBuildingID == cpu_manager.stats:GetBuildingID("daemon_maledictum") or iBuildingID == cpu_manager.stats:GetBuildingID("daemon_doom_pit") or iBuildingID == cpu_manager.stats:GetBuildingID("daemon_gift_circle")) then	
		return "Safeplace"
	elseif (iBuildingID == cpu_manager.stats:GetBuildingID("daemon_turret") or iBuildingID == cpu_manager.stats:GetBuildingID("daemon_turret_no_limit")) then
		return "Front1"
	elseif (iBuildingID == cpu_manager.stats:GetBuildingID("daemon_eye_of_terror")) then
		return "Mine"
	else
		return "Front2"
	end
	return "Basic"
end

-- Virtual method for checking out relic units
function DaemonsBuildBaseStrategy:RelicRequired(sName)

	-- Check name
	if  (sName == "daemon_squad_hell_spawn" or sName == "daemon_squad_soul_grinder" or sName == "daemon_squad_lord_of_skulls" or sName == "daemon_squad_greater_brass_scorpion" or sName == "daemon_squad_greater_brass_scorpion_alt"
	or sName == "daemon_squad_greater_death_wheel" or sName == "daemon_squad_bloodthirster" or sName == "daemon_squad_guo" or sName == "daemon_squad_keeper_of_secrets" or sName == "daemon_squad_lord_of_change" or sName == "daemon_squad_primarch_angron") then
		return true
	end
	return false
end
