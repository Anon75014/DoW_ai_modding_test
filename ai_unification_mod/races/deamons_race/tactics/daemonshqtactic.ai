----------------------------------------
-- File: 'daemonshqtactic.ai'
-- Edited by Gambit @ 16.08.2016

class 'DaemonsHQTactic' (BaseTactic)

DaemonsHQ = {}

function DaemonsHQTactic:__init( base_ai ) super( base_ai )

	self:SetName("Daemons HQ Tactic")

	-- Avoid casting the two portal types on the same spot...
	if DimPortalPosition == nil then
		DimPortalPosition = self.base_ai:GetPosition()
	end
end


function DaemonsHQTactic:InitAbilities()
	
	-- Init abilities
	if (DaemonsHQ.warp_portal == nil) then
		DaemonsHQ.warp_portal = cpu_manager.stats:GetAbilityID( "daemons_warp_portal" )
	end
	if (DaemonsHQ.dimensional_rift == nil) then
		DaemonsHQ.dimensional_rift = cpu_manager.stats:GetAbilityID( "daemons_dimension_rift_fuggles" )
	end
end


function DaemonsHQTactic:DoAbilities()

	local iPower = resource_manager:GetResourceAmount():Get( ResourceAmount.RT_Power )

	if iPower >= 200 and self.base_ai:CanDoAbility(DaemonsHQ.warp_portal) then
		oSquad = cpu_manager.cpu_player:FindFirstHurtSquad( self.base_ai:GetPosition(), 256 )
		if oSquad ~= nil and distance_sqr(oSquad:GetPosition(), DimPortalPosition) > 225 then
			self.base_ai:DoSpecialAbilitySquad(DaemonsHQ.warp_portal, oSquad:GetSquad())
			DimPortalPosition = oSquad:GetPosition()
		end
	end
	if iPower >= 3400 and self.base_ai:CanDoAbility(DaemonsHQ.dimensional_rift) then
		local oSquad = cpu_manager.cpu_player:FindFirstHurtSquad( self.base_ai:GetPosition(), 1024 )
		if oSquad ~= nil and distance_sqr(oSquad:GetPosition(), DimPortalPosition) > 225 then
			self.base_ai:DoSpecialAbilitySquad(DaemonsHQ.dimensional_rift, oSquad:GetSquad())
			DimPortalPosition = oSquad:GetPosition()
		end
	end
end

