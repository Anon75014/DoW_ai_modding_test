----------------------------------------
-- File: 'salamanderlightningtactic.ai'
-- Edited by Thudmeizer		@ 08.02.2025

class 'SalamanderLightningTactic' (SalamanderVehicleTactic)

SalamanderLightning = {}

function SalamanderLightningTactic:__init( squad_ai ) super( squad_ai )

	self:SetName("Salamander Lightning Fighter Tactic")
end

function SalamanderLightningTactic:AutoBuildAddOn( addonSlot )
	for e in self.squad_ai:GetEntities() do
		local buildChannel = build_manager:GetBuildChannelFromID(e:GetID())
		if (buildChannel ~= nil) then
			local addOnID = buildChannel:GetItemIDAt(BuildChannelAI.PQ_AddOn, addonSlot)
			if (buildChannel:IsBuilding() == 0 and buildChannel:CanAddToQueue(BuildChannelAI.PQ_AddOn, addOnID) == BuildChannelAI.CANBUILD_Ok) then			
				buildChannel:BuildAddOn(addOnID)
				return
			end
		end
	end
	return
end

function SalamanderLightningTactic:InitAbilities()
end

function SalamanderLightningTactic:DoAbilities()

	-- New code to unstuck units with pathing issues, that can jump.
	-- Call it with [true], only for multi-membered squads.
	self:SolveStuckCase(false)

	-- Call standard method
	SalamanderVehicleTactic.DoAbilities(self)
end

function SalamanderLightningTactic:Upgrade()

	-- If there are no resources available, don't upgrade!
	if (not Tactic.Options.can_reinforce) then
		return
	end

	-- Figure out my enemy's favourite class
	local enemy = cpu_manager:FindClosestEnemyPlayer()
	if (enemy == nil) then
		return
	end
	
	local class_type = enemy:GetMajorityClassType()
	
	if (class_type == UnitStatsAI.UC_LightInfantryLow) or 
		(class_type == UnitStatsAI.UC_LightInfantryMed) or 
		(class_type == UnitStatsAI.UC_LightInfantryHigh) or
		(class_type == UnitStatsAI.UC_HeavyInfantryMed) or
		(class_type == UnitStatsAI.UC_HeavyInfantryHigh) or
		(class_type == UnitStatsAI.UC_MonsterMed) then 
		self:AutoBuildAddOn(0) -- Missile Fusion Addon
	end
end
